<html>
  <head>
    <!--Countly script-->
    <script type="text/javascript" src="../lib/countly.js"></script>
    <script type="text/javascript">
      //initializing Countly with params and passing require_consent config as true
      Countly.init({
        app_key: "YOUR_APP_KEY_HERE",
        url: "https://try.count.ly", //your server goes here
        debug: true, //to read the logs
        max_key_length: 10, //set maximum key length here
        max_value_size: 5, //set maximum value length here
        max_segmentation_values: 5, //set maximum segmentation number here
        max_breadcrumb_count: 5, //set maximum number of logs that will be stored before erasing old ones
        max_stack_trace_lines_per_thread: 5, //set maximum number of lines for stack trace
        max_stack_trace_line_length: 5, //set maximum length of a line for stack trace
        require_consent: true, //this true means consent is required
      });

      //(optionally) provide custom feature tree if needed
      Countly.group_features({
        activity: ["sessions", "events", "views"],
      });

      //we can call all the helper methods we want, they won't record until consent is provided for specific features
      Countly.track_sessions();
      //we can check event key, value lengths and segmentation numbers with view event logs here too
      Countly.track_pageview();

      //Consent Management logic should be implemented and controlled by developer
      //this is just a simply example of what logic it could have
      if (typeof localStorage !== "undefined") {
        var consents = localStorage.getItem("consents");
        //checking if user already provided consent
        if (consents) {
          //we already have array with consents from previous visit, let's just pass them to Countly
          Countly.add_consent(JSON.parse(consents));
        } else {
          //user have not yet provided us a consent
          //we need to display popup and ask user to give consent for specific features we want to track
          //for example purposes, we will wait till user clicks "Give Consent" button
          //to allow consent for "activity", "crashes"
        }
      } else {
        // Sorry! No Web Storage support..
        // we can fallback to cookie
      }

      //first give consent for features to work
      function giveConsent() {
        //give consent to necessary features
        var response = ["activity", "crashes", "users"];
        Countly.add_consent(response);
        localStorage.setItem("consents", JSON.stringify(response));
      }
      //then you can test stack trace related limits here (line length and line per line)
      function recordError() {
        //create new error object with stack key
        var error = {
          stack: "Enter your\n error here\n separated\n with newlines\n",
        };
        Countly.recordError(error, true);
      }
      //you can add logs and check breadcrumb limits here (present crashLogs limit at a time)
      function addLog() {
        //add new log into crashLogs
        var log = "Enter your log here";
        Countly.add_log(log);
      }

      //add user details
      function addUserDetails() {
        Countly.user_details({
          name: "Arturs Sosins",
          username: "ar2rsawseen",
          email: "test@test.com",
          organization: "Countly",
          phone: "+37112345678",
          //Web URL pointing to user picture
          picture:
            "https://pbs.twimg.com/profile_images/1442562237/012_n_400x400.jpg",
          gender: "M",
          byear: 1987, //birth year
          custom: {
            key1: "value1",
            key2: "value2",
          },
        });
      }
      //modify user data
      function set() {
        Countly.userData.set("name", "Boba Fett"); //set custom property
        Countly.userData.save();
      }
      function setOnce() {
        Countly.userData.set_once("galaxy", "B48FF"); //set custom property only if property does not exist
        Countly.userData.save();
      }
      function incrementBig() {
        Countly.userData.increment_by("byear", 10); //increment value in key by provided value
        Countly.userData.save();
      }
      function increment() {
        Countly.userData.increment_by("byear"); //increment value in key by one
        Countly.userData.save();
      }
      function multiply() {
        Countly.userData.multiply("byear", 2); //multiply value in key by provided value
        Countly.userData.save();
      }
      function max() {
        Countly.userData.max("byear", 1); //save max value between current and provided
        Countly.userData.save();
      }
      function min() {
        Countly.userData.min("byear", 5); //save min value between current and provided
        Countly.userData.save();
      }
      function push() {
        Countly.userData.push("gender", "F"); //add value to key as array element
        Countly.userData.save();
      }
      function pushU() {
        Countly.userData.push_unique("gender", "F"); //add value to key as array element, but only store unique values in array
        Countly.userData.save();
      }
      function pull() {
        Countly.userData.pull("gender", "F"); //remove value from array under property with key as name
        Countly.userData.save();
      }
      //add custom event
      function add() {
        Countly.add_event({
          key: "Enter your key here",
          count: 1,
          segmentation: {
            "key1": "Value1",
            "key2 ": "Value2",
          },
        });
      }
    </script>
  </head>
  <body>
    <p><a href="http://count.ly/">Count.ly</a></p>
    <h3>Give Consent First</h3>

    <p><button onclick="giveConsent()">Give Consent</button></p>
    <h3>Check Stack Trace Limits</h3>

    <p><button onclick="recordError()">Record Error</button></p>
    <h3>Check Breadcrumb Limits</h3>
    <p><button onclick="addLog()">Add Log</button></p>
    <h3>Check Key/Value/Segmentation Limits</h3>
    <p><button onclick="addUserDetails()">Add User Details</button></p>
    <p><button onclick="set()">Set User Details</button></p>
    <p><button onclick="setOnce()">Set Once User Details</button></p>
    <p><button onclick="incrementBig()">Increment User Details</button></p>
    <p><button onclick="increment()">Increment By One User Details</button></p>
    <p><button onclick="multiply()">Multiply User Details</button></p>
    <p><button onclick="max()">Max User Details</button></p>
    <p><button onclick="min()">Min User Details</button></p>
    <p><button onclick="push()">Push User Details</button></p>
    <p><button onclick="pushU()">Push Unique User Details</button></p>
    <p><button onclick="pull()">Pull User Details</button></p>
    <p><button onclick="add()">Add Custom Event</button></p>
  </body>
</html>
