<!doctype html>
<html>
<head>
    <title>
        Countly Web Demo
    </title>
    <!--
		//Content security policy
		<meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'"></meta>
	-->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <!-- <script src="'https://cdn.jsdelivr.net/npm/countly-sdk-web@latest/lib/countly.min.js'"></script> -->
    <script src="./boomerang/boomerang-1.0.0.js"></script>
    <!-- <script src="./boomerang/countly_boomerang.js"></script> -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" name="viewport">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- Page styling here -->
    <style>
        :root {
            --tag-size: 12px;
            --tag-height: 2px;
            --tag-width: 80%;
        }

        * {
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: "Lucida Sans Unicode", "Lucida Grande", sans-serif;
            box-sizing: border-box;
        }
        
        a {
            text-decoration: none;
            color: #000;
            padding: 20px;
        }

        #form-div {
            display: none;
            position: fixed;
            z-index: 8;
            width: 100%;
            height: 100%;
            overflow: auto;
        }

        #form-container {
            display: block;
            padding: 1em;
            width:  30%;
            position: fixed;
            left: 35%;
            top: 0%;
            box-shadow: 0px 0px 5px 5px rgba(0, 0, 0, 0.2);
            background-color: white;
            border-radius: 2% 2% 2% 2%;
        }

        #id-input {
            border: 0.5px solid #adadad;
            width: 90%;
        }

        #id-input:focus-within {
            border: 3px solid  #5185f6;
            outline-color: #5185f6;
        }
        
        #accept-btn {
            background-color: #3573ea;
            border-radius: 10% 10% 10% 10%;
            border-color: white;
            color: white;
            padding: 10px 25px 10px 25px;
            opacity: 1;
            width: 80px;
            position: relative;
            right: 6px;
        }
        
        #cancel-btn {
            background-color: white;
            border-radius: 10% 10% 10% 10%;
            border: 0.5px solid #adadad;
            color: #3573ea;
            padding: 10px 20px 10px 20px;
            opacity: 1;
            width: 80px;
        }

        #check-box {
            display: flex;
            align-items: center;
            padding: 12px 0px 0px 0px;
        }

        #accept-btn:hover {
        opacity: 0.8;
        }
        
        #cancel-btn:hover {
            background-color:#ecf3fd;
        }

        #form-btn {
            display: flex;
            float: right;

        }

        #mormons {
            display: none;
        }
        
        #header p {
            padding: 20px;
            cursor: pointer;
        }

        #buttons {
            display: grid;
            justify-items: center;
            grid-gap: 12px;
        }

        #new-ratings {
            width: max-content;
            border: 1px solid #AC777F;
            padding:0.5rem;
        }        
        #galactic-conquest {
            display: flex;
            gap: 5px;
            align-items: stretch;
            flex-wrap: wrap;
        } 

        #old-ratings {
            width: 80%;
            border: 1px solid #AC777F;
            padding:0.5rem;
            width: max-content;
        }      


        #miscellaneous-buttons {
            width: 80%;
            border: 1px solid #AC777F;
            padding:0.5rem;
            width: max-content;
        }      

        .mormon-father {
        background-color: #AC777F;
        border: none;
        color: white;
        padding: 5px;
        font-size: 19px;
        cursor: pointer;
        }

        .mormon-father:hover {
        background-color: #755056;
        }

        input {
            padding: 8px;
            font-size: 15px;
        }
        
        @media only screen and (max-width: 900px) {
            body {
                background-color: grey;
            }
        }
    </style>
    <!-- Async Countly init logic here -->
    <script type='text/javascript'>
        var Countly = Countly || {};
        Countly.q = Countly.q || [];
        //Countly config
        Countly.app_key = 'a18585abc2b4635ca909455892c07c6e2aaf3fd4';
        Countly.url = 'https://ui.count.ly';
        Countly.session_update = 10; //Time interval for session extend
        Countly.use_session_cookie = false; //if false, begin_session on every app open, be it in new tab
        Countly.debug = true;
        Countly.require_consent = true;
        Countly.namespace = "demo";
        Countly.inactivity_time = 1; //User will marked inactive after 1 min, i.e. stop_time and no extend session or end session
        Countly.offline_mode = false;
        Countly.force_post = false;
        //Example usage of remote config to fetch remote configurations 
        // Countly.remote_config = function(err, rc) {
        //     if (err) {
        //         return;
        //     }
        //     console.log(rc);
        //     //DO SOMETHING
        //     //...
        // };
        //(optionally) provide custom feature tree if needed
        Countly.q.push(['group_features', {
            activity: ["sessions", "events", "views", "location", "remote-config", "apm"],
            interaction: ["scrolls", "clicks", "feedback", "star-rating", "attribution"],
            whereabouts: ["users", "forms"]
        }]);
        //handling consent here
        if (typeof (localStorage) !== "undefined") {
            //check if consent is stored
            var consents = localStorage.getItem("consents");

            if (consents) {
                Countly.q.push(['add_consent', JSON.parse(consents)]);
            }
    else {
                //prompt user for consent
                var consent = confirm("We are going to track you. Do you give your consent ?");
                consents = ["activity", "interaction", "whereabouts"];
                if (consent) {
                    Countly.q.push(['add_consent', consents]);
                    localStorage.setItem("consents", JSON.stringify(consents));
                }
        else {
                    Countly.q.push(['remove_consent', consents]);
                    localStorage.removeItem("consents");
                }
            }
        }
        //tracking user actions
        Countly.q.push(['track_sessions']);
        Countly.q.push(['track_pageview']);
        //For heatmaps record scrolls and clicks
        Countly.q.push(['track_scrolls']);
        Countly.q.push(['track_clicks']);
        Countly.q.push(['track_links', '']);
        Countly.q.push(['track_forms']);
        Countly.q.push(['recordDirectAttribution']);
        Countly.q.push(["track_performance", {
            RT: {
                enabled: true
            },
            instrument_xhr: true,
            AutoXHR: {
                enabled: true,
                alwaysSendXhr: true,
                monitorFetch: true,
                captureXhrRequestResponse: true
            },
            Continuity: {
                enabled: true,
                monitorLongTasks: true,
                monitorPageBusy: true,
                monitorFrameRate: true,
                monitorInteractions: true,
                afterOnload: true
            },
            NavigationTiming: {
                enabled: true
            },
            ResourceTiming: {
                enabled: true,
                clearOnBeacon: true,
                urlLimit: 2000,
                splitAtPath: true
            }
        }]);

        //init countly
        (function() {
            var cly = document.createElement('script');
            cly.type = 'text/javascript';
            cly.async = true;
            cly.src = '../../lib/countly.js';
            cly.onload = function() {
                Countly.init();
            };
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(cly, s);
        })();
        //Uncomment to change device id randomly
        // Countly.change_id(Countly._internals.generateUUID());

        setTimeout(function() {
            Countly.q.push(['track_forms', $("#mynewform-form")[0]]);
        }, 1000);
    </script>
</head>

<body>
    <div id="form-div">
        <form action="" id="form-container">
          <h3>Change device ID:</h3>
        <div>
          <p>Please enter a valid device ID</p>
          <input type="text" id="id-input" value="" required>
        </div>
          <div id="check-box">
          <label for="merge" style="padding-right: 5px;">Merge</label>
          <input type="checkbox" name="merge" id="merge-checkbox">
        </div>
        <span id="form-btn">
            <button type="submit" id="accept-btn">OK</button>
            <button type="button" id="cancel-btn">Cancel</button>
        </span>
        </form>
      </div>

    <div id="header" style="z-index: 100000; width: 100%; height: 100px; display: flex; justify-content: space-between; align-items: center; background-color: #cff96b;">
        <div style="float: left;">
            <a style="font-size: 26px;" href="/">Home</a>
        </div>
        <div>
            <h1 style="text-transform: uppercase;">Countly Demo App</h1>
        </div>
        <div style="float: left;">
            <div style="display: inline-block;">
                <p id="user-state"></p>
            </div>
        </div>
    </div>
    <div style="width: 100%; display:flex; justify-content: center; align-items: center;">
        <img src="./team_countly.jpg" />
    </div>
    <center>
        <h1 id="welcome-user" style="text-transform: capitalize;">Welcome</h1>
        <br />
        <div id="buttons">
            <div id="new-ratings">
                <div style="text-align: right;padding-right: 5%;" id="mormons">
                    <div style="padding-bottom: 6px;">
                        <label for="tags" style="font-size: var(--tag-size);">Tags</label>
                        <input id="tags-m8" value="" style="font-size: var(--tag-size);overflow-y: scroll; width: var(--tag-width); height: var(--tag-height); scroll-behavior: auto; background-color: rgb(187, 187, 187);" type="text" name="tags" readonly/>
                    </div>
                    <div style="padding-bottom: 6px;">
                        <label for="name"style="font-size: var(--tag-size);">Name</label>
                        <input id="name-m8" value="" style="font-size: var(--tag-size);overflow-y: scroll; width:var(--tag-width); height: var(--tag-height); scroll-behavior: auto; background-color: rgb(187, 187, 187);" type="text" name="name" readonly/>
                    </div>    
                    <div style="padding-bottom: 6px;">
                        <label for="show-policy"style="font-size: var(--tag-size);">Show Policy</label>
                        <input id="show-policy-m8" value="" style="font-size: var(--tag-size);overflow-y: scroll; width: var(--tag-width); height: var(--tag-height); scroll-behavior: auto; background-color: rgb(187, 187, 187);" type="text" name="show-policy" readonly/>
                    </div>
                    <div style="padding-bottom: 6px;">
                        <label for="widget-id"style="font-size: var(--tag-size);">ID</label>
                        <input id="widget-id-m8" value="" style="font-size: var(--tag-size);overflow-y: scroll; width: var(--tag-width); height: var(--tag-height); scroll-behavior: auto; background-color: rgb(187, 187, 187);" type="text" name="widget-id" readonly/>
                    </div>
                </div>
                <div id="galactic-conquest">
                    <button class="mormon-father" style="border-radius: 2px;border: none; padding: 5px;"><i class="fa fa-arrows-v" aria-hidden="true"></i></button>
                    <button id="nps" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                        Show NPS
                    </button>
                    <button id="survey" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                        Show Survey
                    </button>
                    <button id="rating" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                        Show Rating Widget
                    </button>
                    <button id="random" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                        Show Random Feedback Widget
                    </button>
                </div>
            </div>
            <div id="old-ratings">
                <button id="rating-enable" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                    Show Old Rating Widget
                </button>
                <button id="rating-multi" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                    Show Old Rating Widget (Multi)
                </button>
            </div>
            <div id="miscellaneous-buttons">
                <button id="call-remote-config" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                    Fetch Remote Config (Header Color)
                </button>
                <button id="send-custom-event" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                    Send Custom Event
                </button>
                <button id="change-device-id" style="color: #000; border: none; padding: 5px; border-radius: 2px; cursor: pointer; font-family: 'Lucida Sans Unicode', 'Lucida Grande', sans-serif; font-size: 14px; background-color: #bed3da;">
                    Change Device ID
                </button>
            </div>
        </div>
        <br />
        <div id="mynewform">
            <form id="mynewform-form">
                <input type="text" placeholder="Enter your email" />
                <input type="submit" />
            </form>
        </div>
        <!-- Some empty elements to append feedback widgets -->
        <ol id="nullMen"></ol>
    </center>

    <script>
        //some dummy user details 
    var users = [{
            "device_id": "mrsparkles-new-3",
            "name": "mrsparkles",
            "username": "mrsparkles",
            "email": "mrsparkles@cly.com",
            "organization": "Countly",
            "phone": "+919882201994",
            "gender": "M",
            "byear": "1994"
        }, {
            "device_id": "alex-new-3",
            "name": "Alex",
            "username": "alex",
            "email": "alex@cly.com",
            "organization": "Amazoom",
            "phone": "+919882202010",
            "gender": "M",
            "byear": "2010"
        }, {
            "device_id": "hannah-new-3",
            "name": "Hannah",
            "username": "hannah",
            "email": "hannah@cly.com",
            "organization": "Pacebook",
            "phone": "+919882202000",
            "gender": "F",
            "byear": "2000"
        }, {
            "device_id": "jarvis-new-3",
            "name": "Jarvis",
            "username": "jarvis",
            "email": "jarvis@cly.com",
            "organization": "Toby Stark corp",
            "phone": "+919882202013",
            "gender": "F",
            "byear": "2013"
        }, {
            "device_id": "dummy-jarvis-new-3",
            "name": "Jarvis dummy",
            "username": "jarvis",
            "email": "jarvis@cly.com",
            "organization": "Toby Stark corp",
            "phone": "+919882202013",
            "gender": "F",
            "byear": "2013"
        }, {
            "device_id": "new-dummy-jarvis-new-3",
            "name": "New Jarvis dummy",
            "username": "jarvis",
            "email": "jarvis@cly.com",
            "organization": "Toby Stark corp",
            "phone": "+919882202013",
            "gender": "F",
            "byear": "2013"
        }, {
            "device_id": "jarvis-new",
            "name": "Jarvis new",
            "username": "jarvis",
            "email": "jarvis@cly.com",
            "organization": "Toby Stark corp",
            "phone": "+919882202013",
            "gender": "F",
            "byear": "2013"
        }, {
            "device_id": "sid-new-3",
            "name": "Sid",
            "username": "sid",
            "email": "sid@cly.com",
            "organization": "Cavenger",
            "phone": "+919882202018",
            "gender": "M",
            "byear": "2018"
        }, {
            "device_id": "harry-new-3",
            "name": "Harry",
            "username": "harry",
            "email": "harry@cly.com",
            "organization": "Adventure",
            "phone": "+919882102018",
            "gender": "M",
            "byear": "2005"
        }, ];
        //add custom events by clicking subscription
        $("#subscription-button").on("click", function() {
            Countly.q.push(['add_event', {
                "key": "subscription-clicked",
                "count": 1,
                "segmentation": {
                    "click_by": "mouse",
                    "click_on": "august"
                }
            }]);
            
            var subscribe = confirm("Do you want to subscribe ?");
            
            if (subscribe) {
                Countly.q.push(['add_event', {
                    "key": "subscribed",
                    "count": 1
                }]);
            } else {
                Countly.q.push(['add_event', {
                    "key": "not-subscribed",
                    "count": 1
                }]);
            }
        });
        const tagManagerText = "No feedback widget requested yet";
        document.getElementById("tags-m8").value = tagManagerText;
        document.getElementById("name-m8").value = tagManagerText;
        document.getElementById("show-policy-m8").value = tagManagerText;
        document.getElementById("widget-id-m8").value = tagManagerText;
        //Accept button for change ID form
        $("#accept-btn").on("click", function() {
            let merge = document.getElementById("merge-checkbox").checked;  
            let ID = document.getElementById("id-input").value;
            if (!ID) {
                alert("Please provide a valid ID!!");
                return;
            } else {
                Countly.q.push(['change_id', ID, merge]);
                document.getElementById("form-div").style.display = "block";
            }
            
        });
        //cancel button for change ID form
        $("#cancel-btn").on("click", function() {
            document.getElementById("form-div").style.display = "none";
        });
        //change device ID button logic
        $("#change-device-id").on("click", function() {
            var id = Countly._internals.generateUUID();
            document.getElementById("id-input").value = id;
            document.getElementById("form-div").style.display = "block";
        });
        //fetch nps widgets
        $("#nps").on("click", function() {
            Countly.q.push(["get_available_feedback_widgets", allWidgetsCallbackNPS]);
        });
        //fetch survey widgets
        $("#survey").on("click", function() {
            Countly.q.push(["get_available_feedback_widgets", allWidgetsCallbackSurvey]);
        });
         //fetch rating widgets
         $("#rating").on("click", function() {
            Countly.q.push(["get_available_feedback_widgets", allWidgetsCallbackRating]);
        });
         //fetch random feedback widgets
         $("#random").on("click", function() {
            const callbacks = [allWidgetsCallbackNPS,allWidgetsCallbackSurvey, allWidgetsCallbackRating];
            var widget = getRandomNumber(0, callbacks.length-1);
            Countly.q.push(["get_available_feedback_widgets", callbacks[widget]]);
        });
        //display a rating widget with ID
        $("#rating-enable").on("click", function() {
            let id = prompt("Please enter widget ID");
            if (!id) {
                return;
            } else {
                Countly.enableRatingWidgets({
                    'popups': [id.trim()]
                });
            }
        });
        //display multiple rating widgets with IDs
        $("#rating-multi").on("click", function() {
            let ids = prompt("Please enter widget IDs separated with commas");
            if (!ids) {
                return;
            } else {
                //trim whitespace
                const idArray = ids.split(',').map(a=>a.trim());
                Countly.initializeRatingWidgets(idArray);
            }
        });
        //fetch, display and use the remote configuration
        $("#call-remote-config").on("click", function() {
            Countly.fetch_remote_config(function(err, remoteConfigs){
                if (err) {
                    return;
                }
                console.log(remoteConfigs);
                if (remoteConfigs.header_background_color !== undefined) {
                    $("#header").css({'background-color': remoteConfigs.header_background_color});
                }
            });
        });
        //send custom events to your hearts content
        $("#send-custom-event").on("click", function() {
            let eventName = prompt("Please enter event name", "new-header-is-cool");
            if (!eventName) {
                alert("Please provide a valid event name!!");
                return;
            } else {
                Countly.q.push(['add_event', {
                    "key": eventName,
                    "count": 1
                }]);
            }
        });

        //log in logic here
        $("#user-state").on("click", function() {
            var loginState = localStorage.getItem("ptsdemo-login-state");

            if (loginState) {
                //User logout
                localStorage.removeItem("ptsdemo-login-state");
                localStorage.removeItem("ptsdemo-user");
                $("#welcome-user").text("Welcome");
                $("#user-state").text("Sign in");
                // $("#subscription").hide();

                Countly.q.push(['change_id', Countly._internals.generateUUID()]);

                //When in offline mode of user management
                // Countly.q.push(['enable_offline_mode']);
            } else {
                //User logins
                var login = confirm("Do you want to login ?");
                if (login) {
                    var userIndex = getRandomUserIndex();
                    var user = users[userIndex];
                    $("#welcome-user").text("Welcome " + user.name);
                    $("#user-state").text("Sign out");
                    // $("#subscription").show();
                    localStorage.setItem("ptsdemo-user", userIndex);
                    localStorage.setItem("ptsdemo-login-state", true);

                    //Change user's device on login - He is now an identified user
                    Countly.q.push(['change_id', user.device_id]);

                    //When in offline mode of user management
                    //In offline mode of user management its better to use manual session management
                    // Countly.q.push(['disable_offline_mode', user.device_id]);

                    setUserData(user);
                }
            }

            setTimeout(function() {
                location.reload();
            }, 1000);
        });
		var loginState = localStorage.getItem("ptsdemo-login-state");
		if(loginState) {
			//User can signout
			var userIndex = localStorage.getItem("ptsdemo-user");
			var user = users[userIndex];
			$("#welcome-user").text("Welcome " + user.name);
			$("#user-state").text("Sign out");
			// $("#subscription").show();
		}
		else {
			//User can sign in
			$("#user-state").text("Sign in");
			// $("#subscription").hide();
		}

        function getRandomUserIndex() {
            return getRandomNumber(0, users.length - 1);
        }

        function setUserData(user) {
            Countly.q.push(['user_details', {
                "name": user.name,
                "username": user.username,
                "email": user.email,
                "organization": user.organization,
                "phone": user.phone,
                "gender": user.gender,
                "byear": user.byear,
                "custom": {
                    "emailLogin": ["false"],
                    "accountType": "premium"
                }
            }]);
        }
        //tag manager
        function evaluateFeedbackWidgetProperties(widget) {
            const tags = widget.tg;
            const name = widget.name;
            const policy = widget.showPolicy;
            const id = widget._id;
            if (tags !== undefined && tags !== null && Array.isArray(tags)) {
                if (tags.length === 0) {
                    document.getElementById("tags-m8").value = '[No tags returned for this widget]';
                } else {
                    document.getElementById("tags-m8").value = tags.join(' ');
                }
                document.getElementById("tags-m8").style.backgroundColor = '#93BD2C';
            } 
            else {
                document.getElementById("tags-m8").value = "Tags are not returned for this widget";
                document.getElementById("tags-m8").style.backgroundColor = '#DE1903';
            }
            if (!id) {
                document.getElementById("widget-id-m8").value = "No ID returned returned for this widget";
                document.getElementById("widget-id-m8").style.backgroundColor = '#DE1903';
            } 
            else {
                document.getElementById("widget-id-m8").value = id;
                document.getElementById("widget-id-m8").style.backgroundColor = '#93BD2C';
            }
            if (!name) {
                document.getElementById("name-m8").value = "No name returned returned for this widget";
                document.getElementById("name-m8").style.backgroundColor = '#DE1903';
            } 
            else {
                document.getElementById("name-m8").value = name;
                document.getElementById("name-m8").style.backgroundColor = '#93BD2C';
            }
            if (!policy) {
                document.getElementById("show-policy-m8").value = "No showPolicy returned returned for this widget";
                document.getElementById("show-policy-m8").style.backgroundColor = '#DE1903';
            } 
            else {
                document.getElementById("show-policy-m8").value = policy;
                document.getElementById("show-policy-m8").style.backgroundColor = '#93BD2C';
            }

        }
        function getRandomNumber(min, max) {
            return parseInt(Math.random() * (max - min) + min);
        }
        $(".mormon-father").on("click", function() {
            var current = document.getElementById("mormons").style.display;
            if (current === 'none' ) {
                document.getElementById("mormons").style.display = "block";
            } 
            else {
                document.getElementById("mormons").style.display = "none";
            }
        });
        function deleteOldFeedbackWidget(widget, type) {
            const id = widget._id;
            try {
                var anchor = document.getElementById(`csbg`);
                var wrapper = document.getElementsByClassName('countly-ratings-wrapper')[0];
                var overlay = document.getElementsByClassName('countly-ratings-overlay')[0];
                var iframeR = document.getElementById('countly-ratings-iframe');
                var iframeS = document.getElementById('countly-surveys-iframe');
                if(anchor&&wrapper) {
                    iframeR.remove();
                    overlay.remove();
                    wrapper.nextSibling.remove();
                    wrapper.remove();
                    anchor.remove();
                } else {
                    anchor.style.zIndex = 5;
                    iframeS.remove();
                    anchor.nextSibling.remove();
                    anchor.remove();
                }
            } catch (error) {
                console.log(error);
            }
        }
        //callback to choose an nps widget from the fetched widget list, widget is the index of the desired widget in the widget list
        function allWidgetsCallbackNPS(feedbacks, err) {
            if (err) {
                return console.log("error ", err);
            }
            //first nps widget to fetch
            var i = 0;
            while(i < feedbacks.length) {
                if (feedbacks[i].type === 'nps') {
                    deleteOldFeedbackWidget(feedbacks[i], 'nps');
                    setTimeout(() => {
                        Countly.present_feedback_widget(feedbacks[i], "", "");
                        evaluateFeedbackWidgetProperties(feedbacks[i]);
                    }, 250);
                    break;
                }
                i++;
            }
        }
        //callback to choose a survey widget from the fetched widget list, widget is the index of the desired widget in the widget list
        function allWidgetsCallbackSurvey(feedbacks, err) {
            if (err) {
                return console.log("error ", err);
            }
            //first survey widget to fetch
            var i = 0;
            while(i < feedbacks.length) {
                if (feedbacks[i].type === 'survey') {
                    deleteOldFeedbackWidget(feedbacks[i], 'survey');
                    setTimeout(() => {
                        Countly.present_feedback_widget(feedbacks[i], "", "");
                        evaluateFeedbackWidgetProperties(feedbacks[i]);
                    }, 250);
                    break;
                }
                i++;
            }
        }
        
        //callback to choose rating widget from the fetched widget list, widget is the index of the desired widget in the widget list
        function allWidgetsCallbackRating(feedbacks, err) {
            if (err) {
                return console.log("error ", err);
            }
			console.log(feedbacks);
            //first rating widget to fetch
            var i = 0;
            while(i < feedbacks.length) {
                if (feedbacks[i].type === 'rating') {
                    deleteOldFeedbackWidget(feedbacks[i], 'rating');
                    setTimeout(() => {
                        Countly.present_feedback_widget(feedbacks[i], "", "");
                        evaluateFeedbackWidgetProperties(feedbacks[i]);
                    }, 250);
                    break;
                }
            i++;
            }
        }
    </script>
</body>