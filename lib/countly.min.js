(function(b,r){"function"===typeof define&&define.amd?define([],function(){return r(b.Countly)}):"object"===typeof module&&module.exports?module.exports=r(b.Countly):b.Countly=r(b.Countly)})("undefined"!==typeof window?window:this,function(b){function r(a){if(!b.ignore_visitor)if(a.key){a.count||(a.count=1);var c=Q(a,["key","count","sum","dur","segmentation"]);c.timestamp=R();var f=new Date;c.hour=f.getHours();c.dow=f.getDay();q.push(c);j("cly_event",q);i("Adding event: ",a)}else i("Event must have key property")}
function ga(){b.ignore_prefetch&&("undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState)&&(b.ignore_visitor=!0);b.ignore_bots&&Ea.test(navigator.userAgent)&&(b.ignore_visitor=!0)}function ha(a){var c=[];if("undefined"!==typeof a.options)for(var b=0;b<a.options.length;b++)a.options[b].selected&&c.push(a.options[b].value);return c.join(", ")}function ia(){var a;if("undefined"!==typeof b.onload&&0<b.onload.length){for(a=0;a<b.onload.length;a++)if("function"===typeof b.onload[a])b.onload[a]();
b.onload=[]}}function ja(a,c){try{var f=document.createElement("div");f.className="countly-iframe-wrapper";f.id="countly-iframe-wrapper-"+a._id;var e=document.createElement("span");e.className="countly-feedback-close-icon";e.id="countly-feedback-close-icon-"+a._id;e.innerHTML="x";var g=document.createElement("iframe");g.name="countly-feedback-iframe";g.id="countly-feedback-iframe";g.src=b.url+"/feedback?widget_id="+a._id+"&app_key="+b.app_key+"&device_id="+b.device_id+"&sdk_version="+ka;document.body.appendChild(f);
f.appendChild(e);f.appendChild(g);l(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(c){var d=document.createElement("div");d.style.color=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color;d.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;d.className="countly-feedback-sticker "+
a.trigger_position;d.id="countly-feedback-sticker-"+a._id;d.innerHTML='<svg id="feedback-sticker-svg" aria-hidden="true" data-prefix="far" data-icon="grin" class="svg-inline--fa fa-grin fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path id="smileyPathInStickerSvg" fill="white" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z"></path></svg> '+
a.trigger_button_text;document.body.appendChild(d);var h=document.getElementById("smileyPathInStickerSvg");h&&(h.style.fill=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color);l(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display=
"block"}catch(k){i("Somethings went wrong while element injecting process: "+k)}}function S(){if(C){var a={name:C,segment:Fa};b.check_consent("views")&&r({key:"[CLY]_view",dur:n()-G,segmentation:a});C=null}}function p(a){if(!b.ignore_visitor)if(!b.app_key||!b.device_id)i("app_key or device_id is missing");else{a.app_key=b.app_key;a.device_id=b.device_id;a.sdk_name=Ga;a.sdk_version=ka;b.check_consent("location")?(b.country_code&&(a.country_code=b.country_code),b.city&&(a.city=b.city),null!==b.ip_address&&
(a.ip_address=b.ip_address)):a.location="";a.timestamp=R();var c=new Date;a.hour=c.getHours();a.dow=c.getDay();u.length>T&&u.shift();u.push(a);j("cly_queue",u,!0)}}function H(){if(b.ignore_visitor)U=!1;else{U=!0;ia();var a=0;if("undefined"!==typeof b.q&&0<b.q.length){var c,f=b.q;b.q=[];for(a=0;a<f.length;a++)if(c=f[a],i("Processing queued call",c),"function"===typeof c)c();else if(c.constructor===Array&&0<c.length)if("undefined"!==typeof b[c[0]])b[c[0]].apply(null,c.slice(1));else{var e=c[0].replace("userData.",
"");"undefined"!==typeof b.userData[e]&&b.userData[e].apply(null,c.slice(1))}}D&&(V&&F)&&(a=n(),a-x>W&&(b.session_duration(a-x),x=a));0<q.length&&(q.length<=I?(p({events:JSON.stringify(q)}),q=[]):(a=q.splice(0,I),p({events:JSON.stringify(a)})),j("cly_event",q));0<u.length&&(X&&n()>la)&&(X=!1,a=u.shift(),ma(w)&&(y&&(clearTimeout(y),y=null),a.consent=JSON.stringify(w),w={}),i("Processing request",a),J(b.url+Ha,a,function(a,c){i("Request Finished",c,a);a&&(u.unshift(c),la=n()+Y);j("cly_queue",u,!0);
X=!0}));setTimeout(H,Z)}}function na(){return j("cly_id")||oa()}function oa(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var b=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===c?b:b&3|8).toString(16)})}function $(){var a={};a._app_version=b.app_version;a._ua=navigator.userAgent;if(screen.width){var c=screen.width?parseInt(screen.width):0,f=screen.height?parseInt(screen.height):0;if(0!==c&&0!==f){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&
window.devicePixelRatio)c=Math.round(c*window.devicePixelRatio),f=Math.round(f*window.devicePixelRatio);else if(90===Math.abs(window.orientation))var e=c,c=f,f=e;a._resolution=""+c+"x"+f}}window.devicePixelRatio&&(a._density=window.devicePixelRatio);c=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof c&&(a._locale=c);if("undefined"!==typeof document.referrer&&document.referrer.length&&(c=pa.exec(document.referrer))&&c[11]&&c[11]!==
window.location.hostname){c=!1;if(z&&z.length)for(f=0;f<z.length;f++)try{if(RegExp(z[f]).test(document.referrer)){i("Ignored:",document.referrer);c=!0;break}}catch(g){i("Problem with regex",z[f])}c||(a._store=document.referrer)}i("Got metrics",a);return a}function i(){b.debug&&"undefined"!==typeof console&&(arguments[1]&&"object"==typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),console.log(Array.prototype.slice.call(arguments).join("\n")))}function n(){return Math.floor((new Date).getTime()/
1E3)}function R(){var a=(new Date).getTime();K>=a?K++:K=a;return K}function L(a,c,f){if(b.check_consent("crashes")&&a){var f=f||qa,e="";"object"===typeof a?"undefined"!==typeof a.stack?e=a.stack:("undefined"!==typeof a.name&&(e+=a.name+":"),"undefined"!==typeof a.message&&(e+=a.message+"\n"),"undefined"!==typeof a.fileName&&(e+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(e+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(e+=":"+a.columnNumber)):e=a+"";c=c?!0:!1;a=$();e={_resolution:a._resolution,
_error:e,_app_version:a._app_version,_run:n()-ra,_not_os_specific:!0};if(a=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)e._bat=Math.floor(100*a.level);"undefined"!==typeof navigator.onLine&&(e._online=navigator.onLine?!0:!1);e._background=document.hasFocus()?!1:!0;0<E.length&&(e._logs=E.join("\n"));E=[];e._nonfatal=c;e._view=(window.location.pathname||"")+(window.location.search||"")+(window.location.hash||"");"undefined"!==typeof f&&(e._custom=f);try{var g=
document.createElement("canvas").getContext("experimental-webgl");e._opengl=g.getParameter(g.VERSION)}catch(d){}p({crash:JSON.stringify(e)})}}function J(a,c,f){try{i("Sending XML HTTP request");var e=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,c=c||{},g=sa(c),d="GET";if(b.force_post||2E3<=g.length)d="POST";"GET"===d?e.open("GET",a+"?"+g,!0):(e.open("POST",a,!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"));
e.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"===typeof f&&f(!1,c,this.responseText):4===this.readyState&&(i("Failed Server XML HTTP request",this.status),"function"===typeof f&&f(!0,c))};"GET"===d?e.send():e.send(g)}catch(h){i("Failed XML HTTP request",h),"function"===typeof f&&f(!0,c)}}function sa(a){var c=[],b;for(b in a)c.push(b+"="+encodeURIComponent(a[b]));return c.join("&")}function ta(a){return"/"===a.substr(a.length-1)?a.substr(0,a.length-
1):a}function Q(a,b){for(var f={},e,g=0;g<b.length;g++)e=b[g],"undefined"!==typeof a[e]&&(f[e]=a[e]);return f}function aa(a){"undefined"==typeof a.pageY&&("number"==typeof a.clientX&&document.documentElement)&&(a.pageX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.pageY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);return a}function ba(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,
a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function ca(){var a=document;return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function ua(){var a=document;return Math.min(Math.min(a.body.clientHeight,a.documentElement.clientHeight),Math.min(a.body.offsetHeight,a.documentElement.offsetHeight),window.innerHeight)}
function va(a){j("cly_token",a)}function ma(a){if(a)for(var b in a)return!0;return!1}function wa(a,b,f,e,g,d){var a=document.createElement(a),h;a.setAttribute(b,f);a.setAttribute(e,g);d&&(a.onreadystatechange=a.onload=function(){h||d();h=!0});document.getElementsByTagName("head")[0].appendChild(a)}function xa(a,b){wa("script","type","text/javascript","src",a,b)}function ya(a,b){wa("link","rel","stylesheet","href",a,b)}function za(){var a=document.getElementById("cly-loader");if(!a){i("setting up loader");
var a=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
b.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
a.appendChild(b);a=document.createElement("div");a.setAttribute("id","cly-loader");document.body.appendChild(a)}a.style.display="block"}function Aa(){var a=document.getElementById("cly-loader");a&&(a.style.display="none")}var b=b||{},ka="18.04",Ga="javascript_native_web",Ba=!1,D=!1,Ha="/i",Z=500,T=1E3,u=[],q=[],E=[],A={},z=[],qa=null,V=!0,x,Ca=0,C=null,G=0,da=0,la=0,Y=60,M=20,N=0,W=60,I=10,ea=100,K=0,X=!0,Fa,U=!1,w={},s={},pa=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
Ea=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO)/,F=!0,ra;b.features="sessions events views scrolls clicks forms crashes attribution users star-rating location".split(" ");
for(var m={},B=0;B<b.features.length;B++)m[b.features[B]]={};b.init=function(a){if(!Ba){ra=n();Ba=!0;u=j("cly_queue")||[];A={};q=j("cly_event")||[];a=a||{};Z=a.interval||b.interval||Z;T=a.queue_size||b.queue_size||T;Y=a.fail_timeout||b.fail_timeout||Y;M=a.inactivity_time||b.inactivity_time||M;W=a.session_update||b.session_update||W;I=a.max_events||b.max_events||I;ea=a.max_logs||b.max_logs||ea;b.ignore_prefetch=a.ignore_prefetch||b.ignore_prefetch||!0;b.debug=a.debug||b.debug||!1;b.app_key=a.app_key||
b.app_key||null;b.device_id=a.device_id||b.device_id||na();b.url=ta(a.url||b.url||"");b.app_version=a.app_version||b.app_version||"0.0";b.country_code=a.country_code||b.country_code||null;b.city=a.city||b.city||null;b.ip_address=a.ip_address||b.ip_address||null;b.ignore_bots=a.ignore_bots||b.ignore_bots||!0;b.force_post=a.force_post||b.force_post||!1;b.q=b.q||[];b.onload=b.onload||[];b.ignore_visitor=a.ignore_visitor||b.ignore_visitor||!1;b.require_consent=a.require_consent||b.require_consent||!1;
a.ignore_referrers&&a.ignore_referrers.constructor===Array?z=a.ignore_referrers:b.ignore_referrers&&b.ignore_referrers.constructor===Array&&(z=b.ignore_referrers);""===b.url&&(i("Please provide server URL"),b.ignore_visitor=!0);j("cly_ignore")&&(b.ignore_visitor=!0);ga();if(window.name&&0===window.name.indexOf("cly:"))try{b.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(c){i("Could not parse name",window.name)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{b.passed_data=
JSON.parse(location.hash.replace("#cly:",""))}catch(f){i("Could not parse hash",location.hash)}b.passed_data&&(b.passed_data.token&&b.passed_data.purpose)&&(b.passed_data.token!==j("cly_old_token")&&(va(b.passed_data.token),j("cly_old_token",b.passed_data.token)),"heatmap"===b.passed_data.purpose&&(b.ignore_visitor=!0,za(),xa(b.url+"/views/heatmap.js",Aa)));if(!b.ignore_visitor){i("Countly initialized");b.onload.constructor!==Array&&(b.onload=[]);b.q.constructor!==Array&&(b.q=[]);H();j("cly_id",b.device_id);
a=0;b.utm=b.utm||{source:!0,medium:!0,campaign:!0,term:!0,content:!0};if(location.search){for(var e=location.search.substring(1).split("&"),g={},d=!1,a=0;a<e.length;a++){var h=e[a].split("=");"cly_id"===h[0]?j("cly_cmp_id",h[1]):"cly_uid"===h[0]?j("cly_cmp_uid",h[1]):0===(h[0]+"").indexOf("utm_")&&b.utm[h[0].replace("utm_","")]&&(g[h[0].replace("utm_","")]=h[1],d=!0)}if(d){for(var k in b.utm)g[k]?b.userData.set("utm_"+k,g[k]):b.userData.unset("utm_"+k);b.userData.save()}}ia()}}};b.group_features=
function(a){if(a)for(var b in a)m[b]?i("Feature name "+b+" is already reserved"):"string"===typeof a[b]?m[b]={features:[a[b]]}:a[b]&&a[b].constructor===Array&&a[b].length?m[b]={features:a[b]}:i("Incorrect feature list for "+b+" value: "+a[b]);else i("Incorrect features: "+a)};b.check_consent=function(a){if(!b.require_consent)return!0;if(m[a])return m[a]&&m[a].optin?!0:!1;i("No feature available for "+a);return!1};b.check_any_consent=function(){if(!b.require_consent)return!0;for(var a in m)if(m[a]&&
m[a].optin)return!0;return!1};b.add_consent=function(a){i("Adding consent for "+a);if(a.constructor===Array)for(var c=0;c<a.length;c++)b.add_consent(a[c]);else m[a]?m[a].features?(m[a].optin=!0,b.add_consent(m[a].features)):!0!==m[a].optin&&(w[a]=!0,m[a].optin=!0,Da(),setTimeout(function(){"sessions"===a&&s.begin_session?(b.begin_session.apply(b,s.begin_session),s.begin_session=null):"views"===a&&s.track_pageview&&(C=null,b.track_pageview.apply(b,s.track_pageview),s.track_pageview=null);s.change_id&&
(b.change_id.apply(b,s.change_id),s.change_id=null)},1)):i("No feature available for "+a)};b.remove_consent=function(a){i("Removing consent for "+a);if(a.constructor===Array)for(var c=0;c<a.length;c++)b.remove_consent(a[c]);else m[a]?(m[a].features?b.remove_consent(m[a].features):!1!==m[a].optin&&(w[a]=!1,Da()),m[a].optin=!1):i("No feature available for "+a)};var y,Da=function(){y&&(clearTimeout(y),y=null);y=setTimeout(function(){ma(w)&&(p({consent:JSON.stringify(w)}),w={})},1E3)};b.begin_session=
function(a){if(b.check_consent("sessions")){if(!D){i("Session started");x=n();D=!0;V=a?!1:!0;var c={begin_session:1};c.metrics=JSON.stringify($());p(c)}}else s.begin_session=arguments};b.session_duration=function(a){b.check_consent("sessions")&&D&&(i("Session extended",a),p({session_duration:a}))};b.end_session=function(a){b.check_consent("sessions")&&D&&(a=a||n()-x,i("Ending session"),S(),D=!1,p({end_session:1,session_duration:a}))};b.change_id=function(a,c){if(b.device_id!==a){c||(0<q.length&&(p({events:JSON.stringify(q)}),
q=[],j("cly_event",q)),b.end_session(),A={});var f=b.device_id;b.device_id=a;j("cly_id",b.device_id);i("Changing id");c?b.check_any_consent()?p({old_device_id:f}):s.change_id=arguments:b.begin_session(!V)}};b.add_event=function(a){b.check_consent("events")&&r(a)};b.start_event=function(a){A[a]?i("Timed event with key "+a+" already started"):A[a]=n()};b.end_event=function(a){"string"==typeof a&&(a={key:a});a.key?A[a.key]?(a.dur=n()-A[a.key],b.add_event(a),delete A[a.key]):i("Timed event with key "+
a.key+" was not started"):i("Event must have key property")};b.user_details=function(a){b.check_consent("users")&&(i("Adding userdetails: ",a),p({user_details:JSON.stringify(Q(a,"name username email organization phone picture gender byear custom".split(" ")))}))};b.report_conversion=function(a,c){b.check_consent("attribution")&&(a=a||j("cly_cmp_id")||"cly_organic",c=c||j("cly_cmp_uid"),a&&c?p({campaign_id:a,campaign_user:c}):a&&p({campaign_id:a}))};var t={},v=function(a,c,f){b.check_consent("users")&&
(t[a]||(t[a]={}),"$push"===f||"$pull"===f||"$addToSet"===f?(t[a][f]||(t[a][f]=[]),t[a][f].push(c)):t[a][f]=c)};b.userData={set:function(a,b){t[a]=b},unset:function(a){t[a]=""},set_once:function(a){v(a,1,"$setOnce")},increment:function(a){v(a,1,"$inc")},increment_by:function(a,b){v(a,b,"$inc")},multiply:function(a,b){v(a,b,"$mul")},max:function(a,b){v(a,b,"$max")},min:function(a,b){v(a,b,"$min")},push:function(a,b){v(a,b,"$push")},push_unique:function(a,b){v(a,b,"$addToSet")},pull:function(a,b){v(a,
b,"$pull")},save:function(){b.check_consent("users")&&p({user_details:JSON.stringify({custom:t})});t={}}};b.track_errors=function(a){qa=a;window.onerror=function(a,b,e,g,d){if("undefined"!==typeof d)L(d,!1);else{var g=g||window.event&&window.event.errorCharacter,h="";"undefined"!==typeof a&&(h+=a+"\n");"undefined"!==typeof b&&(h+="at "+b);"undefined"!==typeof e&&(h+=":"+e);"undefined"!==typeof g&&(h+=":"+g);h+="\n";try{for(var i=[],j=arguments.callee.caller;j;)i.push(j.name),j=j.caller;h+=i.join("\n")}catch(l){}L(h,
!1)}}};b.log_error=function(a,b){L(a,!0,b)};b.add_log=function(a){b.check_consent("crashes")&&(E.length>ea&&E.shift(),E.push(a))};b.stop_time=function(){F&&(F=!1,Ca=n()-x,da=n()-G)};b.start_time=function(){F||(F=!0,x=n()-Ca,G=n()-da,da=0)};b.track_sessions=function(){function a(){document[f]?b.stop_time():b.start_time()}function c(){N>=M&&b.start_time();N=0}b.begin_session();b.start_time();l(window,"beforeunload",function(){b.end_session()});l(window,"unload",function(){b.end_session()});var f="hidden";
f in document?document.addEventListener("visibilitychange",a):(f="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(f="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(f="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?(l(window,"focusin",function(){b.start_time()}),l(window,"focusout",function(){b.stop_time()})):(l(window,"focus",function(){b.start_time()}),l(window,"blur",function(){b.stop_time()}),
l(window,"pageshow",function(){b.start_time()}),l(window,"pagehide",function(){b.stop_time()}));l(window,"mousemove",c);l(window,"click",c);l(window,"keydown",c);l(window,"scroll",c);setInterval(function(){N++;N>=M&&b.stop_time()},6E4)};b.track_pageview=function(a,c){S();a&&a.constructor===Array&&(c=a,a=null);a=a||window.location.pathname;if(c&&c.length)for(var f=0;f<c.length;f++)try{if(RegExp(c[f]).test(a)){i("Ignored:",a);return}}catch(e){i("Problem with regex",c[f])}C=a;G=n();f={name:a,visit:1,
domain:window.location.hostname};if("undefined"!==typeof document.referrer&&document.referrer.length){var g=pa.exec(document.referrer);g&&(g[11]&&g[11]!==window.location.hostname)&&(f.start=1)}b.check_consent("views")?r({key:"[CLY]_view",segmentation:f}):s.track_pageview=arguments};b.track_view=function(a,c){b.track_pageview(a,c)};b.track_clicks=function(a){var a=a||document,c=!0;l(a,"click",function(a){if(c){c=!1;aa(a);if("undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY){var e=ba(),g=ca();
b.check_consent("clicks")&&r({key:"[CLY]_action",segmentation:{type:"click",x:a.pageX,y:a.pageY,width:g,height:e,domain:window.location.hostname,view:window.location.pathname}})}setTimeout(function(){c=!0},1E3)}})};b.track_scrolls=function(a){function c(){if(f){f=!1;var a=ba(),c=ca(),h=ua();b.check_consent("scrolls")&&r({key:"[CLY]_action",segmentation:{type:"scroll",y:e+h,width:c,height:a,domain:window.location.hostname,view:window.location.pathname}})}}var a=a||window,f=!0,e=0;l(a,"scroll",function(){e=
Math.max(e,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)});l(a,"beforeunload",c);l(a,"unload",c)};b.track_links=function(a){a=a||document;l(a,"click",function(a){var f=O(a).closest("a");f&&(aa(a),b.check_consent("clicks")&&r({key:"linkClick",segmentation:{href:f.href,text:f.innerText,id:f.id,x:a.pageX,y:a.pageY,view:window.location.pathname}}))})};b.track_forms=function(a){function c(a){return a.name||a.id||a.type||a.nodeName}a=a||document;l(a,"submit",function(a){var a=
O(a),e={id:a.id,name:a.name,action:a.action,method:a.method,view:window.location.pathname},g;if("undefined"!==typeof a.elements){for(var d=0;d<a.elements.length;d++)if((g=a.elements[d])&&"password"!==g.type)"undefined"===typeof e["input:"+c(g)]&&(e["input:"+c(g)]=[]),"select"===g.nodeName.toLowerCase()?"undefined"!==typeof g.multiple?e["input:"+c(g)].push(ha(g)):e["input:"+c(g)].push(g.options[g.selectedIndex].value):"input"===g.nodeName.toLowerCase()?"undefined"!==typeof g.type?"checkbox"===g.type.toLowerCase()||
"radio"===g.type.toLowerCase()?g.checked&&e["input:"+c(g)].push(g.value):e["input:"+c(g)].push(g.value):e["input:"+c(g)].push(g.value):"textarea"===g.nodeName.toLowerCase()?e["input:"+c(g)].push(g.value):"undefined"!==typeof g.value&&e["input:"+c(g)].push(g.value);for(var h in e)"undefined"!=typeof e[h].join&&(e[h]=e[h].join(", "))}b.check_consent("forms")&&r({key:"formSubmit",segmentation:e})})};b.collect_from_forms=function(a,c){a=a||document;l(a,"submit",function(f){var f=O(f),e={},g=!1,d;if("undefined"!==
typeof f.elements){var h={},k=a.getElementsByTagName("LABEL"),j;for(j=0;j<k.length;j++)k[j].htmlFor&&""!==k[j].htmlFor&&(h[k[j].htmlFor]=k[j].innerText||k[j].textContent||k[j].innerHTML);for(j=0;j<f.elements.length;j++)if((d=f.elements[j])&&"password"!==d.type&&-1===d.className.indexOf("cly_user_ignore"))if(k="","select"===d.nodeName.toLowerCase()?k="undefined"!==typeof d.multiple?ha(d):d.options[d.selectedIndex].value:"input"===d.nodeName.toLowerCase()?"undefined"!==typeof d.type?"checkbox"===d.type.toLowerCase()||
"radio"===d.type.toLowerCase()?d.checked&&(k=d.value):k=d.value:k=d.value:"textarea"===d.nodeName.toLowerCase()?k=d.value:"undefined"!==typeof d.value&&(k=d.value),d.className&&-1!==d.className.indexOf("cly_user_")){var l=d.className.split(" ");for(d=0;d<l.length;d++)if(0===l[d].indexOf("cly_user_")){e[l[d].replace("cly_user_","")]=k;g=!0;break}}else if(d.type&&"email"===d.type.toLowerCase()||d.name&&-1!==d.name.toLowerCase().indexOf("email")||d.id&&-1!==d.id.toLowerCase().indexOf("email")||d.id&&
h[d.id]&&-1!==h[d.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(k))e.email||(e.email=k),g=!0;else if(d.name&&-1!==d.name.toLowerCase().indexOf("username")||d.id&&-1!==d.id.toLowerCase().indexOf("username")||d.id&&h[d.id]&&-1!==h[d.id].toLowerCase().indexOf("username"))e.username||(e.username=k),g=!0;else if(d.name&&(-1!==d.name.toLowerCase().indexOf("tel")||-1!==d.name.toLowerCase().indexOf("phone")||-1!==d.name.toLowerCase().indexOf("number"))||d.id&&(-1!==d.id.toLowerCase().indexOf("tel")||
-1!==d.id.toLowerCase().indexOf("phone")||-1!==d.id.toLowerCase().indexOf("number"))||d.id&&h[d.id]&&(-1!==h[d.id].toLowerCase().indexOf("tel")||-1!==h[d.id].toLowerCase().indexOf("phone")||-1!==h[d.id].toLowerCase().indexOf("number")))e.phone||(e.phone=k),g=!0;else if(d.name&&(-1!==d.name.toLowerCase().indexOf("org")||-1!==d.name.toLowerCase().indexOf("company"))||d.id&&(-1!==d.id.toLowerCase().indexOf("org")||-1!==d.id.toLowerCase().indexOf("company"))||d.id&&h[d.id]&&(-1!==h[d.id].toLowerCase().indexOf("org")||
-1!==h[d.id].toLowerCase().indexOf("company")))e.organization||(e.organization=k),g=!0;else if(d.name&&-1!==d.name.toLowerCase().indexOf("name")||d.id&&-1!==d.id.toLowerCase().indexOf("name")||d.id&&h[d.id]&&-1!==h[d.id].toLowerCase().indexOf("name"))e.name||(e.name=""),e.name+=k+" ",g=!0}g&&(i("Gathered user data",e),c?b.user_details({custom:e}):b.user_details(e))})};b.collect_from_facebook=function(a){FB&&FB.api&&FB.api("/me",function(c){var f={};c.name&&(f.name=c.name);c.email&&(f.email=c.email);
"male"===c.gender?f.gender="M":"female"===c.gender&&(f.gender="F");if(c.birthday){var e=c.birthday.split("/").pop();e&&4===e.length&&(f.byear=e)}c.work&&(c.work[0]&&c.work[0].employer&&c.work[0].employer.name)&&(f.organization=c.work[0].employer.name);if(a){f.custom={};for(var g in a){for(var e=a[g].split("."),d=c,h=0;h<e.length&&!(d=d[e[h]],"undefined"===typeof d);h++);"undefined"!==typeof d&&(f.custom[g]=d)}}b.user_details(f)})};b.opt_out=function(){b.ignore_visitor=!0;j("cly_ignore",!0)};b.opt_in=
function(){j("cly_ignore",!1);b.ignore_visitor=!1;ga();!b.ignore_visitor&&!U&&H()};b.show_feedback_popup=function(a){J(b.url+"/o/feedback/widget",{widget_id:a},function(a,b,e){a&&i("Error occurred",a);try{var g=JSON.parse(e);ja(g,!1)}catch(d){i("JSON parse failed: "+d)}})};b.enable_feedback=function(a){ya(b.url+"/star-rating/stylesheets/countly-feedback-web.css");0<a.widgets.length?(document.body.innerHTML+='<div id="cfbg"></div>',J(b.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a.widgets)},
function(a,b,e){a&&i("Errors occurred:",a);try{for(var g=JSON.parse(e),a=0;a<g.length;a++)if(g[a].target_devices[fa.device])for(var d=g[a].target_pages,b=0;b<d.length;b++)g[a].hide_sticker="true"===g[a].hide_sticker?!0:!1,d[b]===window.location.pathname&&!g[a].hide_sticker&&ja(g[a],!0)}catch(h){i("JSON parse error: "+h)}})):i("You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")};Element.prototype.closest||(Element.prototype.closest=
function(a){for(var b=this,a=a.toUpperCase();b;){if(b.nodeName.toUpperCase()===a)return b;b=b.parentElement}});var l=function(a,b,f){"undefined"!==typeof a.addEventListener?a.addEventListener(b,f,!1):a.attachEvent("on"+b,f)},O=function(a){return a?"undefined"!==typeof a.target?a.target:a.srcElement:window.event.srcElement},fa,P=navigator.userAgent.toLowerCase(),B=function(a){a&&(P=(a+"").toLowerCase());return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(P)?
"tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(P)?"phone":"desktop"};fa={device:B(),detect:B,isMobile:"desktop"!==B()?!0:!1,userAgent:P};var j=function(a,b,f){function e(a,b,c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var f=f||!1,g=!1,d,g=!0;try{"undefined"!==typeof localStorage&&localStorage.setItem("testLocal",
!0)}catch(h){g=!1}"undefined"!==typeof b&&null!==b&&("object"===typeof b&&(b=JSON.stringify(b)),g?localStorage.setItem(a,b):f||e(a,b,30));if("undefined"===typeof b){if(g)d=localStorage.getItem(a);else if(!f)a:{a+="=";b=document.cookie.split(";");f=0;for(g=b.length;f<g;f++){for(d=b[f];" "===d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a)){d=d.substring(a.length,d.length);break a}}d=null}try{d=JSON.parse(d)}catch(i){d=null}return d}null===b&&(g?localStorage.removeItem(a):f||e(a,"",-1))};
b._internals={store:j,getDocWidth:ca,getDocHeight:ba,getViewportHeight:ua,get_page_coord:aa,get_event_target:O,add_event:l,getProperties:Q,stripTrailingSlash:ta,prepareParams:sa,sendXmlHttpRequest:J,recordError:L,getMsTimestamp:R,getTimestamp:n,log:i,getMetrics:$,generateUUID:oa,getId:na,heartBeat:H,toRequestQueue:p,reportViewDuration:S,loadJS:xa,loadCSS:ya,getLastView:function(){return C},setToken:va,getToken:function(){var a=j("cly_token");j("cly_token",null);return a},showLoader:za,hideLoader:Aa,
add_cly_events:r,detect_device:fa};return b});
