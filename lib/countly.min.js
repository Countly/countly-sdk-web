(function(la,L){"object"===typeof exports&&"undefined"!==typeof module?L(exports):"function"===typeof define&&define.amd?define(["exports"],L):(la="undefined"!==typeof globalThis?globalThis:la||self,L(la.Countly=la.Countly||{}))})(this,function(la){function L(l){"@babel/helpers - typeof";return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(k){return typeof k}:function(k){return k&&"function"==typeof Symbol&&k.constructor===Symbol&&k!==Symbol.prototype?"symbol":typeof k},L(l)}
function vb(l,k){for(var q=0;q<k.length;q++){var v=k[q];v.enumerable=v.enumerable||!1;v.configurable=!0;"value"in v&&(v.writable=!0);Object.defineProperty(l,Rb(v.key),v)}}function Rb(l){a:if("object"===typeof l&&null!==l){var k=l[Symbol.toPrimitive];if(void 0!==k){l=k.call(l,"string");if("object"!==typeof l)break a;throw new TypeError("@@toPrimitive must return a primitive value.");}l=String(l)}return"symbol"===typeof l?l:String(l)}function Sb(l){var k=document.createElement("script"),q=document.createElement("script");
k.async=!0;q.async=!0;k.src=p.customSourceBoomerang||wb.BOOMERANG_SRC;q.src=p.customSourceCountlyBoomerang||wb.CLY_BOOMERANG_SRC;document.getElementsByTagName("head")[0].appendChild(k);document.getElementsByTagName("head")[0].appendChild(q);var v=!1,G=!1;k.onload=function(){v=!0};q.onload=function(){G=!0};var Q=0,O=setInterval(function(){Q+=50;if(v&&G||1500<=Q){if(p.debug){var U="BoomerangJS loaded:["+v+"], countly_boomerang loaded:["+G+"].";v&&G?console.log("[DEBUG] "+U):console.warn("[WARNING] "+
U+" Initializing without APM.")}p.init(l);clearInterval(O)}},50)}function xb(l){var k=[];if("undefined"!==typeof l.options)for(var q=0;q<l.options.length;q++)l.options[q].selected&&k.push(l.options[q].value);return k.join(", ")}function db(){var l=yb("xxxxxxxx","[x]");var k=Date.now().toString();return l+k}function eb(){return yb("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx","[xy]")}function yb(l,k){var q=(new Date).getTime();return l.replace(new RegExp(k,"g"),function(v){var G=(q+16*Math.random())%16|0;
return("x"===v?G:G&3|8).toString(16)})}function F(){return Math.floor((new Date).getTime()/1E3)}function fb(){var l=(new Date).getTime();Na>=l?Na++:Na=l;return Na}function u(l,k,q){if(k&&Object.keys(k).length){if("undefined"!==typeof k[l])return k[l]}else if("undefined"!==typeof p[l])return p[l];return q}function gb(l,k,q){for(var v in p.i)p.i[v].tracking_crashes&&p.i[v].recordError(l,k,q)}function wa(l){var k=[],q;for(q in l)k.push(q+"="+encodeURIComponent(l[q]));return k.join("&")}function sa(l){return"string"===
typeof l&&"/"===l.substring(l.length-1)?l.substring(0,l.length-1):l}function xa(l,k){for(var q={},v,G=0,Q=k.length;G<Q;G++)v=k[G],"undefined"!==typeof l[v]&&(q[v]=l[v]);return q}function aa(l,k,q,v,G,Q){var O={};if(l){if(Object.keys(l).length>v){var U={},ya=0,ma;for(ma in l)ya<v&&(U[ma]=l[ma],ya++);l=U}for(var za in l)v=z(za,k,G,Q),U=z(l[za],q,G,Q),O[v]=U}return O}function z(l,k,q,v){var G=l;"number"===typeof l&&(l=l.toString());"string"===typeof l&&l.length>k&&(G=l.substring(0,k),v(d.DEBUG,q+", Key: [ "+
l+" ] is longer than accepted length. It will be truncated."));return G}function A(l,k,q){x&&(null===l||"undefined"===typeof l?Aa()&&console.warn("[WARNING] [Countly] add_event_listener, Can't bind ["+k+"] event to nonexisting element"):"undefined"!==typeof l.addEventListener?l.addEventListener(k,q,!1):l.attachEvent("on"+k,q))}function Oa(l){return l?"undefined"!==typeof l.target?l.target:l.srcElement:window.event.srcElement}function ta(l){if(l)return l;l=navigator.userAgent;!l&&navigator.userAgentData&&
(l=navigator.userAgentData.brands.map(function(k){return k.brand+":"+k.version}).join(),l+=navigator.userAgentData.mobile?" mobi ":" ",l+=navigator.userAgentData.platform);return l}function zb(l){if(!l){if(navigator.userAgentData.mobile)return"phone";l=ta()}l=l.toLowerCase();var k="desktop",q=/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/;/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(l)?
k="tablet":q.test(l)&&(k="phone");return k}function Ab(l){return/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome|Chrome-Lighthouse)/.test(l||
ta())}function hb(l){"undefined"===typeof l.pageY&&"number"===typeof l.clientX&&document.documentElement&&(l.pageX=l.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,l.pageY=l.clientY+document.body.scrollTop+document.documentElement.scrollTop);return l}function Pa(){var l=document;return Math.max(Math.max(l.body.scrollHeight,l.documentElement.scrollHeight),Math.max(l.body.offsetHeight,l.documentElement.offsetHeight),Math.max(l.body.clientHeight,l.documentElement.clientHeight))}
function ib(){var l=document;return Math.max(Math.max(l.body.scrollWidth,l.documentElement.scrollWidth),Math.max(l.body.offsetWidth,l.documentElement.offsetWidth),Math.max(l.body.clientWidth,l.documentElement.clientWidth))}function Bb(){var l=document;return Math.min(Math.min(l.body.clientHeight,l.documentElement.clientHeight),Math.min(l.body.offsetHeight,l.documentElement.offsetHeight),window.innerHeight)}function Cb(l,k,q,v,G,Q){l=document.createElement(l);var O;l.setAttribute(k,q);l.setAttribute(v,
G);k=function(){O||Q();O=!0};Q&&(l.onreadystatechange=k,l.onload=k);document.getElementsByTagName("head")[0].appendChild(l)}function Db(l,k){Cb("script","type","text/javascript","src",l,k)}function Qa(l,k){Cb("link","rel","stylesheet","href",l,k)}function Eb(){if(x){var l=document.getElementById("cly-loader");if(!l){var k=document.head||document.getElementsByTagName("head")[0],q=document.createElement("style");q.type="text/css";q.styleSheet?q.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
q.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
k.appendChild(q);l=document.createElement("div");l.setAttribute("id","cly-loader");document.body.onload=function(){if(p.showLoaderProtection)Aa()&&console.warn("[WARNING] [Countly] showloader, Loader is already on");else try{document.body.appendChild(l)}catch(v){Aa()&&console.error("[ERROR] [Countly] showLoader, Body is not loaded for loader to append: "+v)}}}l.style.display="block"}}function Aa(){return p&&p.debug&&"undefined"!==typeof console?!0:!1}function Fb(){if(x){p.showLoaderProtection=!0;
var l=document.getElementById("cly-loader");l&&(l.style.display="none")}}var x="undefined"!==typeof window,p=globalThis.Countly||{};p.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm feedback remote-config".split(" ");var M={NPS:"[CLY]_nps",SURVEY:"[CLY]_survey",STAR_RATING:"[CLY]_star_rating",VIEW:"[CLY]_view",ORIENTATION:"[CLY]_orientation",ACTION:"[CLY]_action"},Tb=Object.values(M),d={ERROR:"[ERROR] ",WARNING:"[WARNING] ",INFO:"[INFO] ",DEBUG:"[DEBUG] ",
VERBOSE:"[VERBOSE] "},wb={BOOMERANG_SRC:"https://cdn.jsdelivr.net/npm/countly-sdk-web@latest/plugin/boomerang/boomerang.min.js",CLY_BOOMERANG_SRC:"https://cdn.jsdelivr.net/npm/countly-sdk-web@latest/plugin/boomerang/countly_boomerang.js"},S=Object.freeze({errorCount:"cly_hc_error_count",warningCount:"cly_hc_warning_count",statusCode:"cly_hc_status_code",errorMessage:"cly_hc_error_message"});p.q=p.q||[];p.onload=p.onload||[];var Gb=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?::([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?::([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
Hb=!0,Qb=function(l,k,q){k&&vb(l.prototype,k);q&&vb(l,q);Object.defineProperty(l,"prototype",{writable:!1});return l}(function q(k){function v(a,c){if(f.ignore_visitor)b(d.ERROR,"Adding event failed. Possible bot or user opt out");else if(a.key){a.count||(a.count=1);Tb.includes(a.key)||(a.key=z(a.key,f.maxKeyLength,"add_cly_event",b));a.segmentation=aa(a.segmentation,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"add_cly_event",b);a=xa(a,["key","count","sum","dur","segmentation"]);a.timestamp=
fb();var e=new Date;a.hour=e.getHours();a.dow=e.getDay();a.id=c||db();a.key===M.VIEW?a.pvid=Ba||"":a.cvid=ha||"";J.push(a);w("cly_event",J);b(d.INFO,"With event ID: ["+a.id+"], successfully adding the last event:",a)}else b(d.ERROR,"Adding event failed. Event must have a key property")}function G(a,c,e,h,m){b(d.INFO,"fetch_remote_config_explicit, Fetching sequence initiated");var g={method:"rc",av:f.app_version};a&&(g.keys=JSON.stringify(a));c&&(g.omit_keys=JSON.stringify(c));var n;"legacy"===h&&
(g.method="fetch_remote_config");0===e&&(g.oi=0);1===e&&(g.oi=1);"function"===typeof m&&(n=m);f.check_consent("sessions")&&(g.metrics=JSON.stringify(Ra()));f.check_consent("remote-config")?(Ca(g),ba("fetch_remote_config_explicit",f.url+Sa,g,function(r,t,I){if(!r){try{var C=JSON.parse(I);if(g.keys||g.omit_keys)for(var na in C)R[na]=C[na];else R=C;w("cly_remote_configs",R)}catch(Da){b(d.ERROR,"fetch_remote_config_explicit, Had an issue while parsing the response: "+Da)}n&&(b(d.INFO,"fetch_remote_config_explicit, Callback function is provided"),
n(r,R))}},!0)):(b(d.ERROR,"fetch_remote_config_explicit, Remote config requires explicit consent"),n&&n(Error("Remote config requires explicit consent"),R))}function Q(){f.ignore_prefetch&&x&&"undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState&&(f.ignore_visitor=!0);f.ignore_bots&&Ab()&&(f.ignore_visitor=!0)}function O(){0<J.length&&(b(d.DEBUG,"Flushing events"),N({events:JSON.stringify(J)}),J=[],w("cly_event",J))}function U(a,c){if(x)if(document.getElementById("countly-feedback-sticker-"+
a._id))b(d.ERROR,"Widget with same ID exists");else try{var e=document.createElement("div");e.className="countly-iframe-wrapper";e.id="countly-iframe-wrapper-"+a._id;var h=document.createElement("span");h.className="countly-feedback-close-icon";h.id="countly-feedback-close-icon-"+a._id;h.innerText="x";var m=document.createElement("iframe");m.name="countly-feedback-iframe";m.id="countly-feedback-iframe";m.src=f.url+"/feedback?widget_id="+a._id+"&app_key="+f.app_key+"&device_id="+f.device_id+"&sdk_version=23.12.0";
document.body.appendChild(e);e.appendChild(h);e.appendChild(m);A(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(c){var g=document.createElementNS("http://www.w3.org/2000/svg","svg");g.id="feedback-sticker-svg";g.setAttribute("aria-hidden","true");g.setAttribute("data-prefix","far");g.setAttribute("data-icon","grin");g.setAttribute("class",
"svg-inline--fa fa-grin fa-w-16");g.setAttribute("role","img");g.setAttribute("xmlns","http://www.w3.org/2000/svg");g.setAttribute("viewBox","0 0 496 512");var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.id="smileyPathInStickerSvg";n.setAttribute("fill","white");n.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");
var r=document.createElement("span");r.innerText=a.trigger_button_text;var t=document.createElement("div");t.style.color=7>a.trigger_font_color.length?"#"+a.trigger_font_color:a.trigger_font_color;t.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;t.className="countly-feedback-sticker  "+a.trigger_position+"-"+a.trigger_size;t.id="countly-feedback-sticker-"+a._id;g.appendChild(n);t.appendChild(g);t.appendChild(r);document.body.appendChild(t);var I=document.getElementById("smileyPathInStickerSvg");
I&&(I.style.fill=7>a.trigger_font_color.length?"#"+a.trigger_font_color:a.trigger_font_color);A(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(C){b(d.ERROR,"Somethings went wrong while element injecting process: "+
C)}else b(d.WARNING,"processWidget, window object is not available. Not processing widget.")}function ya(){var a;if("undefined"!==typeof f.onload&&0<f.onload.length){for(a=0;a<f.onload.length;a++)if("function"===typeof f.onload[a])f.onload[a](f);f.onload=[]}}function ma(){if(W){var a={name:W};f.check_consent("views")&&(v({key:M.VIEW,dur:oa?F()-Ea:Fa,segmentation:a},ha),W=null)}}function za(){if(ia){var a=y("cly_session");if(!a||parseInt(a)<=F())V=!1,f.begin_session(!Ga);w("cly_session",F()+60*Ha)}}
function Ca(a){a.app_key=f.app_key;a.device_id=f.device_id;a.sdk_name="javascript_native_web";a.sdk_version="23.12.0";a.t=D;a.av=f.app_version;var c=Ib();if(a.metrics){var e=JSON.parse(a.metrics);e._ua||(e._ua=c,a.metrics=JSON.stringify(e))}else a.metrics=JSON.stringify({_ua:c});f.check_consent("location")?(f.country_code&&(a.country_code=f.country_code),f.city&&(a.city=f.city),null!==f.ip_address&&(a.ip_address=f.ip_address)):a.location="";a.timestamp=fb();c=new Date;a.hour=c.getHours();a.dow=c.getDay()}
function N(a){f.ignore_visitor?b(d.WARNING,"User is opt_out will ignore the request: "+a):f.app_key&&f.device_id?(Ca(a),H.length>Ta&&H.shift(),H.push(a),w("cly_queue",H,!0)):b(d.ERROR,"app_key or device_id is missing ",f.app_key,f.device_id)}function Ua(){ya();if(f.ignore_visitor)Va=!1,b(d.WARNING,"User opt_out, no heartbeat");else{Va=!0;var a=0;if(Wa&&"undefined"!==typeof p.q&&0<p.q.length){var c=p.q;p.q=[];for(a=0;a<c.length;a++){var e=c[a];b(d.DEBUG,"Processing queued call",e);if("function"===
typeof e)e();else if(Array.isArray(e)&&0<e.length){var h=f,m=0;p.i[e[m]]&&(h=p.i[e[m]],m++);if("function"===typeof h[e[m]])h[e[m]].apply(h,e.slice(m+1));else if(0===e[m].indexOf("userData.")){var g=e[m].replace("userData.","");"function"===typeof h.userData[g]&&h.userData[g].apply(h,e.slice(m+1))}else"function"===typeof p[e[m]]&&p[e[m]].apply(p,e.slice(m+1))}}}V&&Ga&&oa&&(a=F(),a-ja>Xa&&(f.session_duration(a-ja),ja=a,0<f.hcErrorCount&&w(S.errorCount,f.hcErrorCount),0<f.hcWarningCount&&w(S.warningCount,
f.hcWarningCount)));0<J.length&&!f.test_mode_eq&&(J.length<=Ia?(N({events:JSON.stringify(J)}),J=[]):(a=J.splice(0,Ia),N({events:JSON.stringify(a)})),w("cly_event",J));!K&&0<H.length&&Ya&&F()>jb&&(Ya=!1,a=H[0],a.rr=H.length,b(d.DEBUG,"Processing request",a),w("cly_queue",H,!0),f.test_mode||ba("send_request_queue",f.url+kb,a,function(n,r){n?jb=F()+Za:H.shift();w("cly_queue",H,!0);Ya=!0},!1));setTimeout(Ua,$a)}}function lb(){var a=y("cly_id");return a?(D=y("cly_id_type"),a):eb()}function Ib(){return f.metrics._ua||
ta()}function Ra(){var a=JSON.parse(JSON.stringify(f.metrics||{}));a._app_version=a._app_version||f.app_version;a._ua=a._ua||ta();if(x&&screen.width){var c=screen.width?parseInt(screen.width):0,e=screen.height?parseInt(screen.height):0;if(0!==c&&0!==e){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)c=Math.round(c*window.devicePixelRatio),e=Math.round(e*window.devicePixelRatio);else if(90===Math.abs(window.orientation)){var h=c;c=e;e=h}a._resolution=a._resolution||
""+c+"x"+e}}x&&window.devicePixelRatio&&(a._density=a._density||window.devicePixelRatio);c=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof c&&(a._locale=a._locale||c);mb()&&(a._store=a._store||document.referrer);b(d.DEBUG,"Got metrics",a);return a}function mb(a){if(!x)return!1;a=a||document.referrer;var c=!1;if("undefined"===typeof a||0===a.length)b(d.DEBUG,"Invalid referrer:["+a+"], ignoring.");else{var e=Gb.exec(a);if(e)if(e[11])if(e[11]===
window.location.hostname)b(d.DEBUG,"Referrer is current host:["+a+"], ignoring.");else if(ca&&ca.length)for(c=!0,e=0;e<ca.length;e++){if(0<=a.indexOf(ca[e])){b(d.DEBUG,"Referrer in ignore list:["+a+"], ignoring.");c=!1;break}}else b(d.DEBUG,"Valid referrer:["+a+"]"),c=!0;else b(d.DEBUG,"No path found in referrer:["+a+"], ignoring.");else b(d.DEBUG,"Referrer is corrupt:["+a+"], ignoring.")}return c}function b(a,c){if(f.debug&&"undefined"!==typeof console){arguments[2]&&"object"===L(arguments[2])&&
(arguments[2]=JSON.stringify(arguments[2]));Wa||(c="["+f.app_key+"] "+c);a||(a=d.DEBUG);for(var e="",h=2;h<arguments.length;h++)e+=arguments[h];e=a+"[Countly] "+c+e;a===d.ERROR?(console.error(e),pa.incrementErrorCount()):a===d.WARNING?(console.warn(e),pa.incrementWarningCount()):a===d.INFO?console.info(e):a===d.VERBOSE?console.log(e):console.debug(e)}}function ba(a,c,e,h,m){x?Jb(a,c,e,h,m):Kb(a,c,e,h,m)}function Jb(a,c,e,h,m){m=m||!1;try{b(d.DEBUG,"Sending XML HTTP request");var g=new XMLHttpRequest;
e=e||{};var n=wa(e),r="GET";if(f.force_post||2E3<=n.length)r="POST";"GET"===r?g.open("GET",c+"?"+n,!0):(g.open("POST",c,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"));for(var t in f.headers)g.setRequestHeader(t,f.headers[t]);g.onreadystatechange=function(){4===this.readyState&&(b(d.DEBUG,a+" HTTP request completed with status code: ["+this.status+"] and response: ["+this.responseText+"]"),(m?nb(this.status,this.responseText):ob(this.status,this.responseText))?"function"===
typeof h&&h(!1,e,this.responseText):(b(d.ERROR,a+" Invalid response from server"),"send_request_queue"===a&&pa.saveRequestCounters(this.status,this.responseText),"function"===typeof h&&h(!0,e,this.status,this.responseText)))};"GET"===r?g.send():g.send(n)}catch(I){b(d.ERROR,a+" Something went wrong while making an XML HTTP request: "+I),"function"===typeof h&&h(!0,e)}}function Kb(a,c,e,h,m){m=m||!1;var g;try{b(d.DEBUG,"Sending Fetch request");var n="GET",r={"Content-type":"application/x-www-form-urlencoded"},
t=null;e=e||{};f.force_post||2E3<=wa(e).length?(n="POST",t=wa(e)):c+="?"+wa(e);for(var I in f.headers)r[I]=f.headers[I];fetch(c,{method:n,headers:r,body:t}).then(function(C){g=C;return g.text()}).then(function(C){b(d.DEBUG,a+" Fetch request completed wit status code: ["+g.status+"] and response: ["+C+"]");(m?nb(g.status,C):ob(g.status,C))?"function"===typeof h&&h(!1,e,C):(b(d.ERROR,a+" Invalid response from server"),"send_request_queue"===a&&pa.saveRequestCounters(g.status,C),"function"===typeof h&&
h(!0,e,g.status,C))})["catch"](function(C){b(d.ERROR,a+" Failed Fetch request: "+C);"function"===typeof h&&h(!0,e)})}catch(C){b(d.ERROR,a+" Something went wrong with the Fetch request attempt: "+C),"function"===typeof h&&h(!0,e)}}function ob(a,c){if(!(200<=a&&300>a))return b(d.ERROR,"Http response status code:["+a+"] is not within the expected range"),!1;try{var e=JSON.parse(c);return"[object Object]"!==Object.prototype.toString.call(e)?(b(d.ERROR,"Http response is not JSON Object"),!1):!!e.result}catch(h){return b(d.ERROR,
"Http response is not JSON: "+h),!1}}function nb(a,c){if(!(200<=a&&300>a))return b(d.ERROR,"Http response status code:["+a+"] is not within the expected range"),!1;try{var e=JSON.parse(c);return"[object Object]"===Object.prototype.toString.call(e)||Array.isArray(e)?!0:(b(d.ERROR,"Http response is not JSON Object nor JSON Array"),!1)}catch(h){return b(d.ERROR,"Http response is not JSON: "+h),!1}}function Lb(){x?Ja=Math.max(Ja,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop):
b(d.WARNING,"processScroll, window object is not available. Not processing scroll.")}function pb(){if(!x)b(d.WARNING,"processScrollView, window object is not available. Not processing scroll view.");else if(Ka){Ka=!1;var a=Pa(),c=ib(),e=Bb();f.check_consent("scrolls")&&(a={type:"scroll",y:Ja+e,width:c,height:a,view:f.getViewUrl()},a=aa(a,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"processScrollView",b),f.track_domains&&(a.domain=window.location.hostname),v({key:M.ACTION,segmentation:a}))}}
function Mb(a){w("cly_token",a)}function Nb(a,c,e){var h=new Date;h.setTime(h.getTime()+864E5*e);e="; expires="+h.toGMTString();document.cookie=a+"="+c+e+"; path=/"}function y(a,c,e){if("none"===f.storage||"object"!==L(f.storage)&&!x)b(d.DEBUG,"Storage is disabled. Value with key: ["+a+"] won't be retrieved");else{e||(a=f.app_key+"/"+a,f.namespace&&(a=sa(f.namespace)+"/"+a));if("object"===L(f.storage)&&"function"===typeof f.storage.getItem){var h=f.storage.getItem(a);return a.endsWith("cly_id")?h:
f.deserialize(h)}void 0===c&&(c=qa);if(c)h=localStorage.getItem(a);else if("localstorage"!==f.storage)a:{c=a+"=";e=document.cookie.split(";");h=0;for(var m=e.length;h<m;h++){for(var g=e[h];" "===g.charAt(0);)g=g.substring(1,g.length);if(0===g.indexOf(c)){h=g.substring(c.length,g.length);break a}}h=null}return a.endsWith("cly_id")?h:f.deserialize(h)}}function w(a,c,e,h){"none"===f.storage||"object"!==L(f.storage)&&!x?b(d.DEBUG,"Storage is disabled. Value with key: "+a+" won't be stored"):(h||(a=f.app_key+
"/"+a,f.namespace&&(a=sa(f.namespace)+"/"+a)),"undefined"!==typeof c&&null!==c&&("object"===L(f.storage)&&"function"===typeof f.storage.setItem?f.storage.setItem(a,c):(void 0===e&&(e=qa),c=f.serialize(c),e?localStorage.setItem(a,c):"localstorage"!==f.storage&&Nb(a,c,30))))}function X(a,c,e){"none"===f.storage||"object"!==L(f.storage)&&!x?b(d.DEBUG,"Storage is disabled. Value with key: "+a+" won't be removed"):(e||(a=f.app_key+"/"+a,f.namespace&&(a=sa(f.namespace)+"/"+a)),"object"===L(f.storage)&&
"function"===typeof f.storage.removeItem?f.storage.removeItem(a):(void 0===c&&(c=qa),c?localStorage.removeItem(a):"localstorage"!==f.storage&&Nb(a,"",-1)))}function Ub(){if(y(f.namespace+"cly_id",!1,!0)){w("cly_id",y(f.namespace+"cly_id",!1,!0));w("cly_id_type",y(f.namespace+"cly_id_type",!1,!0));w("cly_event",y(f.namespace+"cly_event",!1,!0));w("cly_session",y(f.namespace+"cly_session",!1,!0));var a=y(f.namespace+"cly_queue",!1,!0);Array.isArray(a)&&(a=a.filter(function(c){return c.app_key===f.app_key}),
w("cly_queue",a));y(f.namespace+"cly_cmp_id",!1,!0)&&(w("cly_cmp_id",y(f.namespace+"cly_cmp_id",!1,!0)),w("cly_cmp_uid",y(f.namespace+"cly_cmp_uid",!1,!0)));y(f.namespace+"cly_ignore",!1,!0)&&w("cly_ignore",y(f.namespace+"cly_ignore",!1,!0));X("cly_id",!1,!0);X("cly_id_type",!1,!0);X("cly_event",!1,!0);X("cly_session",!1,!0);X("cly_queue",!1,!0);X("cly_cmp_id",!1,!0);X("cly_cmp_uid",!1,!0);X("cly_ignore",!1,!0)}}if(!(this instanceof q))throw new TypeError("Cannot call a class as a function");var f=
this,Wa=!p.i,V=!1,kb="/i",Sa="/o/sdk",$a=u("interval",k,500),Ta=u("queue_size",k,1E3),H=[],J=[],R={},ra=[],da={},ca=u("ignore_referrers",k,[]),qb=null,Ga=!0,ja,rb=0,W=null,Ea=0,Fa=0,jb=0,Za=u("fail_timeout",k,60),La=u("inactivity_time",k,20),Ma=0,Xa=u("session_update",k,60),Ia=u("max_events",k,100),ua=u("max_logs",k,null),ia=u("use_session_cookie",k,!0),Ha=u("session_cookie_timeout",k,30),Ya=!0,Va=!1,K=u("offline_mode",k,!1),ea={},oa=!0,Ob=F(),qa=!0,va=null,D=1,Ka=!1,Ja=0,sb=!1,ha=null,Ba=null,ka=
null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(a){b(d.ERROR,"Local storage test failed, Halting local storage support: "+a),qa=!1}for(var E={},tb=0;tb<p.features.length;tb++)E[p.features[tb]]={};this.initialize=function(){this.serialize=u("serialize",k,p.serialize);this.deserialize=u("deserialize",k,p.deserialize);this.getViewName=u("getViewName",k,p.getViewName);this.getViewUrl=u("getViewUrl",k,p.getViewUrl);this.getSearchQuery=u("getSearchQuery",
k,p.getSearchQuery);this.DeviceIdType=p.DeviceIdType;this.namespace=u("namespace",k,"");this.clearStoredId=x?u("clear_stored_id",k,!1):void 0;this.app_key=u("app_key",k,null);this.onload=u("onload",k,[]);this.utm=u("utm",k,{source:!0,medium:!0,campaign:!0,term:!0,content:!0});this.ignore_prefetch=u("ignore_prefetch",k,!0);this.rcAutoOptinAb=u("rc_automatic_optin_for_ab",k,!0);this.useExplicitRcApi=u("use_explicit_rc_api",k,!1);this.debug=u("debug",k,!1);this.test_mode=u("test_mode",k,!1);this.test_mode_eq=
u("test_mode_eq",k,!1);this.metrics=u("metrics",k,{});this.headers=u("headers",k,{});this.url=sa(u("url",k,""));this.app_version=u("app_version",k,"0.0");this.country_code=u("country_code",k,null);this.city=u("city",k,null);this.ip_address=u("ip_address",k,null);this.ignore_bots=x?u("ignore_bots",k,!0):void 0;this.force_post=u("force_post",k,!1);this.remote_config=u("remote_config",k,!1);this.ignore_visitor=u("ignore_visitor",k,!1);this.require_consent=u("require_consent",k,!1);this.track_domains=
x?u("track_domains",k,!0):void 0;this.storage=u("storage",k,"default");this.enableOrientationTracking=x?u("enable_orientation_tracking",k,!0):void 0;this.maxKeyLength=u("max_key_length",k,128);this.maxValueSize=u("max_value_size",k,256);this.maxSegmentationValues=u("max_segmentation_values",k,100);this.maxBreadcrumbCount=u("max_breadcrumb_count",k,null);this.maxStackTraceLinesPerThread=u("max_stack_trace_lines_per_thread",k,30);this.maxStackTraceLineLength=u("max_stack_trace_line_length",k,200);this.heatmapWhitelist=
u("heatmap_whitelist",k,[]);f.hcErrorCount=y(S.errorCount)||0;f.hcWarningCount=y(S.warningCount)||0;f.hcStatusCode=y(S.statusCode)||-1;f.hcErrorMessage=y(S.errorMessage)||"";ua&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=ua,b(d.WARNING,"initialize, 'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):ua||this.maxBreadcrumbCount||(this.maxBreadcrumbCount=100);"cookie"===this.storage&&(qa=!1);this.rcAutoOptinAb||this.useExplicitRcApi||(b(d.WARNING,"initialize, Auto opting is disabled, switching to explicit RC API"),
this.useExplicitRcApi=!0);Array.isArray(ca)||(ca=[]);""===this.url&&(b(d.ERROR,"initialize, Please provide server URL"),this.ignore_visitor=!0);y("cly_ignore")&&(this.ignore_visitor=!0);Ub();H=y("cly_queue")||[];J=y("cly_event")||[];R=y("cly_remote_configs")||{};this.clearStoredId&&(y("cly_id")&&!g&&(this.device_id=y("cly_id"),b(d.DEBUG,"initialize, temporarily using the previous device ID to flush existing events"),D=y("cly_id_type"),D||(b(d.DEBUG,"initialize, No device ID type info from the previous session, falling back to DEVELOPER_SUPPLIED, for event flushing"),
D=0),O(),this.device_id=void 0,D=1),b(d.INFO,"initialize, Clearing the device ID storage"),localStorage.removeItem(this.app_key+"/cly_id"),localStorage.removeItem(this.app_key+"/cly_id_type"),localStorage.removeItem(this.app_key+"/cly_session"));Q();if(x)if(window.name&&0===window.name.indexOf("cly:"))try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(r){b(d.ERROR,"initialize, Could not parse name: "+window.name+", error: "+r)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{this.passed_data=
JSON.parse(location.hash.replace("#cly:",""))}catch(r){b(d.ERROR,"initialize, Could not parse hash: "+location.hash+", error: "+r)}if((this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&Wa)&&this.passed_data.token&&this.passed_data.purpose){this.passed_data.token!==y("cly_old_token")&&(Mb(this.passed_data.token),w("cly_old_token",this.passed_data.token));var a=[];Array.isArray(this.heatmapWhitelist)?(this.heatmapWhitelist.push(this.url),
a=this.heatmapWhitelist.map(function(r){return sa(r)})):a=[this.url];a.includes(this.passed_data.url)&&"heatmap"===this.passed_data.purpose&&(this.ignore_visitor=!0,Eb(),Db(this.passed_data.url+"/views/heatmap.js",Fb))}if(this.ignore_visitor)b(d.WARNING,"initialize, ignore_visitor:["+this.ignore_visitor+"], this user will not be tracked");else{b(d.DEBUG,"initialize, app_key:["+this.app_key+"], url:["+this.url+"]");b(d.DEBUG,"initialize, device_id:["+u("device_id",k,void 0)+"]");b(d.DEBUG,"initialize, require_consent is enabled:["+
this.require_consent+"]");try{b(d.DEBUG,"initialize, metric override:["+JSON.stringify(this.metrics)+"]"),b(d.DEBUG,"initialize, header override:["+JSON.stringify(this.headers)+"]"),b(d.DEBUG,"initialize, number of onload callbacks provided:["+this.onload.length+"]"),b(d.DEBUG,"initialize, utm tags:["+JSON.stringify(this.utm)+"]"),ca&&b(d.DEBUG,"initialize, referrers to ignore :["+JSON.stringify(ca)+"]")}catch(r){b(d.ERROR,"initialize, Could not stringify some config object values")}b(d.DEBUG,"initialize, app_version:["+
this.app_version+"]");b(d.DEBUG,"initialize, provided location info; country_code:["+this.country_code+"], city:["+this.city+"], ip_address:["+this.ip_address+"]");""!==this.namespace&&b(d.DEBUG,"initialize, namespace given:["+this.namespace+"]");this.clearStoredId&&b(d.DEBUG,"initialize, clearStoredId flag set to:["+this.clearStoredId+"]");this.ignore_prefetch&&b(d.DEBUG,"initialize, ignoring pre-fetching and pre-rendering from counting as real website visits :["+this.ignore_prefetch+"]");this.test_mode&&
b(d.WARNING,"initialize, test_mode:["+this.test_mode+"], request queue won't be processed");this.test_mode_eq&&b(d.WARNING,"initialize, test_mode_eq:["+this.test_mode_eq+"], event queue won't be processed");this.heatmapWhitelist&&b(d.DEBUG,"initialize, heatmap whitelist:["+JSON.stringify(this.heatmapWhitelist)+"], these domains will be whitelisted");"default"!==this.storage&&b(d.DEBUG,"initialize, storage is set to:["+this.storage+"]");this.ignore_bots&&b(d.DEBUG,"initialize, ignore traffic from bots :["+
this.ignore_bots+"]");this.force_post&&b(d.DEBUG,"initialize, forced post method for all requests:["+this.force_post+"]");this.remote_config&&b(d.DEBUG,"initialize, remote_config callback provided:["+!!this.remote_config+"]");"boolean"===typeof this.rcAutoOptinAb&&b(d.DEBUG,"initialize, automatic RC optin is enabled:["+this.rcAutoOptinAb+"]");this.useExplicitRcApi||b(d.WARNING,"initialize, will use legacy RC API. Consider enabling new API during init with use_explicit_rc_api flag");this.track_domains&&
b(d.DEBUG,"initialize, tracking domain info:["+this.track_domains+"]");this.enableOrientationTracking&&b(d.DEBUG,"initialize, enableOrientationTracking:["+this.enableOrientationTracking+"]");ia||b(d.WARNING,"initialize, use_session_cookie is enabled:["+ia+"]");K&&b(d.DEBUG,"initialize, offline_mode:["+K+"], user info won't be send to the servers");K&&b(d.DEBUG,"initialize, stored remote configs:["+JSON.stringify(R)+"]");b(d.DEBUG,"initialize, 'getViewName' callback override provided:["+(this.getViewName!==
p.getViewName)+"]");b(d.DEBUG,"initialize, 'getSearchQuery' callback override provided:["+(this.getSearchQuery!==p.getSearchQuery)+"]");128!==this.maxKeyLength&&b(d.DEBUG,"initialize, maxKeyLength set to:["+this.maxKeyLength+"] characters");256!==this.maxValueSize&&b(d.DEBUG,"initialize, maxValueSize set to:["+this.maxValueSize+"] characters");100!==this.maxSegmentationValues&&b(d.DEBUG,"initialize, maxSegmentationValues set to:["+this.maxSegmentationValues+"] key/value pairs");100!==this.maxBreadcrumbCount&&
b(d.DEBUG,"initialize, maxBreadcrumbCount for custom logs set to:["+this.maxBreadcrumbCount+"] entries");30!==this.maxStackTraceLinesPerThread&&b(d.DEBUG,"initialize, maxStackTraceLinesPerThread set to:["+this.maxStackTraceLinesPerThread+"] lines");200!==this.maxStackTraceLineLength&&b(d.DEBUG,"initialize, maxStackTraceLineLength set to:["+this.maxStackTraceLineLength+"] characters");500!==$a&&b(d.DEBUG,"initialize, interval for heartbeats set to:["+$a+"] milliseconds");1E3!==Ta&&b(d.DEBUG,"initialize, queue_size set to:["+
Ta+"] items max");60!==Za&&b(d.DEBUG,"initialize, fail_timeout set to:["+Za+"] seconds of wait time after a failed connection to server");20!==La&&b(d.DEBUG,"initialize, inactivity_time set to:["+La+"] minutes to consider a user as inactive after no observable action");60!==Xa&&b(d.DEBUG,"initialize, session_update set to:["+Xa+"] seconds to check if extending a session is needed while the user is active");100!==Ia&&b(d.DEBUG,"initialize, max_events set to:["+Ia+"] events to send in one batch");ua&&
b(d.WARNING,"initialize, max_logs set to:["+ua+"] breadcrumbs to store for crash logs max, deprecated ");30!==Ha&&b(d.DEBUG,"initialize, session_cookie_timeout set to:["+Ha+"] minutes to expire a cookies session");b(d.INFO,"initialize, Countly initialized");a=null;g=f.getSearchQuery();var c=!1,e={};if(g){g=g.substring(1).split("&");for(var h=0;h<g.length;h++){var m=g[h].split("=");"cly_id"===m[0]?w("cly_cmp_id",m[1]):"cly_uid"===m[0]?w("cly_cmp_uid",m[1]):"cly_device_id"===m[0]?a=m[1]:0===(m[0]+"").indexOf("utm_")&&
this.utm[m[0].replace("utm_","")]&&(e[m[0].replace("utm_","")]=m[1],c=!0)}}var g="[CLY]_temp_id"===y("cly_id");h=u("device_id",k,void 0);"number"===typeof h&&(h=h.toString());y("cly_id")&&!g?(this.device_id=y("cly_id"),b(d.INFO,"initialize, Set the stored device ID"),D=y("cly_id_type"),D||(b(d.INFO,"initialize, No device ID type info from the previous session, falling back to DEVELOPER_SUPPLIED"),D=0)):null!==a?(b(d.INFO,"initialize, Device ID set by URL"),this.device_id=a,D=3):h?(b(d.INFO,"initialize, Device ID set by developer"),
this.device_id=h,k&&Object.keys(k).length?void 0!==k.device_id&&(D=0):void 0!==p.device_id&&(D=0)):K||g?(this.device_id="[CLY]_temp_id",D=2,K&&g?b(d.INFO,"initialize, Temp ID set, continuing offline mode from previous app session"):K&&!g?b(d.INFO,"initialize, Temp ID set, entering offline mode"):(K=!0,b(d.INFO,"initialize, Temp ID set, enabling offline mode"))):(b(d.INFO,"initialize, Generating the device ID"),this.device_id=u("device_id",k,lb()),k&&Object.keys(k).length?void 0!==k.device_id&&(D=
0):void 0!==p.device_id&&(D=0));w("cly_id",this.device_id);w("cly_id_type",D);if(c){ka={};for(var n in this.utm)e[n]?(this.userData.set("utm_"+n,e[n]),ka[n]=e[n]):this.userData.unset("utm_"+n);this.userData.save()}ya();setTimeout(function(){Ua();f.remote_config&&f.fetch_remote_config(f.remote_config)},1);x&&document.documentElement.setAttribute("data-countly-useragent",ta());pa.sendInstantHCRequest()}};this.halt=function(){b(d.WARNING,"halt, Resetting Countly");p.i=void 0;Wa=!p.i;V=!1;kb="/i";Sa=
"/o/sdk";$a=500;Ta=1E3;H=[];J=[];R={};ra=[];da={};ca=[];qb=null;Ga=!0;rb=0;W=null;jb=Fa=Ea=0;Za=60;La=20;Ma=0;Xa=60;Ia=100;ua=null;ia=!0;Ha=30;Ya=!0;K=Va=!1;ea={};oa=!0;Ob=F();qa=!0;va=null;D=1;Ka=!1;Ja=0;sb=!1;ka=Ba=ha=null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(c){b(d.ERROR,"halt, Local storage test failed, will fallback to cookies"),qa=!1}p.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm feedback remote-config".split(" ");
E={};for(var a=0;a<p.features.length;a++)E[p.features[a]]={};f.app_key=void 0;f.device_id=void 0;f.onload=void 0;f.utm=void 0;f.ignore_prefetch=void 0;f.debug=void 0;f.test_mode=void 0;f.test_mode_eq=void 0;f.metrics=void 0;f.headers=void 0;f.url=void 0;f.app_version=void 0;f.country_code=void 0;f.city=void 0;f.ip_address=void 0;f.ignore_bots=void 0;f.force_post=void 0;f.rcAutoOptinAb=void 0;f.useExplicitRcApi=void 0;f.remote_config=void 0;f.ignore_visitor=void 0;f.require_consent=void 0;f.track_domains=
void 0;f.storage=void 0;f.enableOrientationTracking=void 0;f.maxKeyLength=void 0;f.maxValueSize=void 0;f.maxSegmentationValues=void 0;f.maxBreadcrumbCount=void 0;f.maxStackTraceLinesPerThread=void 0;f.maxStackTraceLineLength=void 0};this.group_features=function(a){b(d.INFO,"group_features, Grouping features");if(a)for(var c in a)E[c]?b(d.WARNING,"group_features, Feature name ["+c+"] is already reserved"):"string"===typeof a[c]?E[c]={features:[a[c]]}:a[c]&&Array.isArray(a[c])&&a[c].length?E[c]={features:a[c]}:
b(d.ERROR,"group_features, Incorrect feature list for ["+c+"] value: ["+a[c]+"]");else b(d.ERROR,"group_features, Incorrect features:["+a+"]")};this.check_consent=function(a){b(d.INFO,"check_consent, Checking if consent is given for specific feature:["+a+"]");if(!this.require_consent)return b(d.INFO,"check_consent, require_consent is off, no consent is necessary"),!0;if(E[a])return!(!E[a]||!E[a].optin);b(d.ERROR,"check_consent, No feature available for ["+a+"]");return!1};this.get_device_id_type=
function(){b(d.INFO,"check_device_id_type, Retrieving the current device id type.["+D+"]");switch(D){case 1:var a=f.DeviceIdType.SDK_GENERATED;break;case 3:case 0:a=f.DeviceIdType.DEVELOPER_SUPPLIED;break;case 2:a=f.DeviceIdType.TEMPORARY_ID;break;default:a=-1}return a};this.get_device_id=function(){b(d.INFO,"get_device_id, Retrieving the device id: ["+f.device_id+"]");return f.device_id};this.check_any_consent=function(){b(d.INFO,"check_any_consent, Checking if any consent is given");if(!this.require_consent)return b(d.INFO,
"check_any_consent, require_consent is off, no consent is necessary"),!0;for(var a in E)if(E[a]&&E[a].optin)return!0;b(d.INFO,"check_any_consent, No consents given");return!1};this.add_consent=function(a){b(d.INFO,"add_consent, Adding consent for ["+a+"]");if(Array.isArray(a))for(var c=0;c<a.length;c++)this.add_consent(a[c]);else E[a]?E[a].features?(E[a].optin=!0,this.add_consent(E[a].features)):!0!==E[a].optin&&(E[a].optin=!0,Pb(),setTimeout(function(){"sessions"===a&&ea.begin_session?(f.begin_session.apply(f,
ea.begin_session),ea.begin_session=null):"views"===a&&ea.track_pageview&&(W=null,f.track_pageview.apply(f,ea.track_pageview),ea.track_pageview=null)},1)):b(d.ERROR,"add_consent, No feature available for ["+a+"]")};this.remove_consent=function(a){b(d.INFO,"remove_consent, Removing consent for ["+a+"]");this.remove_consent_internal(a,!0)};this.remove_consent_internal=function(a,c){c=c||!1;if(Array.isArray(a))for(var e=0;e<a.length;e++)this.remove_consent_internal(a[e],c);else E[a]?E[a].features?this.remove_consent_internal(E[a].features,
c):(E[a].optin=!1,c&&!1!==E[a].optin&&Pb()):b(d.WARNING,"remove_consent, No feature available for ["+a+"]")};var ab,Pb=function(){ab&&(clearTimeout(ab),ab=null);ab=setTimeout(function(){for(var a={},c=0;c<p.features.length;c++)a[p.features[c]]=!0===E[p.features[c]].optin?!0:!1;N({consent:JSON.stringify(a)});b(d.DEBUG,"Consent update request has been sent to the queue.")},1E3)};this.enable_offline_mode=function(){b(d.INFO,"enable_offline_mode, Enabling offline mode");this.remove_consent_internal(p.features,
!1);K=!0;this.device_id="[CLY]_temp_id";f.device_id=this.device_id;D=2};this.disable_offline_mode=function(a){if(K){b(d.INFO,"disable_offline_mode, Disabling offline mode");K=!1;a&&this.device_id!==a?(this.device_id=a,f.device_id=this.device_id,D=0,w("cly_id",this.device_id),w("cly_id_type",0),b(d.INFO,"disable_offline_mode, Changing id to: "+this.device_id)):(this.device_id=lb(),"[CLY]_temp_id"===this.device_id&&(this.device_id=eb()),f.device_id=this.device_id,this.device_id!==y("cly_id")&&(w("cly_id",
this.device_id),w("cly_id_type",1)));a=!1;if(0<H.length)for(var c=0;c<H.length;c++)"[CLY]_temp_id"===H[c].device_id&&(H[c].device_id=this.device_id,a=!0);a&&w("cly_queue",H,!0)}else b(d.WARNING,"disable_offline_mode, Countly was not in offline mode.")};this.begin_session=function(a,c){b(d.INFO,"begin_session, Starting the session. There was an ongoing session: ["+V+"]");a&&b(d.INFO,"begin_session, Heartbeats are disabled");c&&b(d.INFO,"begin_session, Session starts irrespective of session cookie");
if(this.check_consent("sessions")){if(!V){this.enableOrientationTracking&&(this.report_orientation(),A(window,"resize",function(){f.report_orientation()}));ja=F();V=!0;Ga=!a;var e=y("cly_session");b(d.VERBOSE,"begin_session, Session state, forced: ["+c+"], useSessionCookie: ["+ia+"], seconds to expire: ["+(e-ja)+"], expired: ["+(parseInt(e)<=F())+"] ");if(c||!ia||!e||parseInt(e)<=F())b(d.INFO,"begin_session, Session started"),null===va&&(va=!0),e={begin_session:1},e.metrics=JSON.stringify(Ra()),N(e);
w("cly_session",F()+60*Ha)}}else ea.begin_session=arguments};this.session_duration=function(a){b(d.INFO,"session_duration, Reporting session duration");this.check_consent("sessions")&&V&&(b(d.INFO,"session_duration, Session extended: ",a),N({session_duration:a}),za())};this.end_session=function(a,c){b(d.INFO,"end_session, Ending the current session. There was an on going session:["+V+"]");this.check_consent("sessions")&&V&&(a=a||F()-ja,ma(),!ia||c?(b(d.INFO,"end_session, Session ended"),N({end_session:1,
session_duration:a})):this.session_duration(a),V=!1)};this.change_id=function(a,c){b(d.INFO,"change_id, Changing the ID");c&&b(d.INFO,"change_id, Will merge the IDs");if(!a||"string"!==typeof a||0===a.length)b(d.ERROR,"change_id, The provided ID: ["+a+"] is not a valid ID");else if(K)b(d.WARNING,"change_id, Offline mode was on, initiating disabling sequence instead."),this.disable_offline_mode(a);else if(this.device_id!=a){c||(O(),this.end_session(null,!0),da={},this.remove_consent_internal(p.features,
!1));var e=this.device_id;this.device_id=a;f.device_id=this.device_id;D=0;w("cly_id",this.device_id);w("cly_id_type",0);b(d.INFO,"change_id, Changing ID from:["+e+"] to ["+a+"]");c?N({old_device_id:e}):this.begin_session(!Ga,!0);this.remote_config&&(R={},w("cly_remote_configs",R),this.fetch_remote_config(this.remote_config))}};this.add_event=function(a){b(d.INFO,"add_event, Adding event: ",a);switch(a.key){case M.NPS:var c=this.check_consent("feedback");break;case M.SURVEY:c=this.check_consent("feedback");
break;case M.STAR_RATING:c=this.check_consent("star-rating");break;case M.VIEW:c=this.check_consent("views");break;case M.ORIENTATION:c=this.check_consent("users");break;case M.ACTION:c=this.check_consent("clicks")||this.check_consent("scrolls");break;default:c=this.check_consent("events")}c&&v(a)};this.start_event=function(a){a&&"string"===typeof a?(b(d.INFO,"start_event, Starting timed event with key: ["+a+"]"),a=z(a,f.maxKeyLength,"start_event",b),da[a]?b(d.WARNING,"start_event, Timed event with key: ["+
a+"] already started"):da[a]=F()):b(d.WARNING,"start_event, you have to provide a valid string key instead of: ["+a+"]")};this.cancel_event=function(a){if(!a||"string"!==typeof a)return b(d.WARNING,"cancel_event, you have to provide a valid string key instead of: ["+a+"]"),!1;b(d.INFO,"cancel_event, Canceling timed event with key: ["+a+"]");a=z(a,f.maxKeyLength,"cancel_event",b);if(da[a])return delete da[a],b(d.INFO,"cancel_event, Timed event with key: ["+a+"] is canceled"),!0;b(d.WARNING,"cancel_event, Timed event with key: ["+
a+"] was not found");return!1};this.end_event=function(a){a?(b(d.INFO,"end_event, Ending timed event"),"string"===typeof a&&(a=z(a,f.maxKeyLength,"end_event",b),a={key:a}),a.key?da[a.key]?(a.dur=F()-da[a.key],this.add_event(a),delete da[a.key]):b(d.ERROR,"end_event, Timed event with key: ["+a.key+"] was not started"):b(d.ERROR,"end_event, Timed event must have a key property")):b(d.WARNING,"end_event, you have to provide a valid string key or event object instead of: ["+a+"]")};this.report_orientation=
function(a){b(d.INFO,"report_orientation, Reporting orientation");this.check_consent("users")&&v({key:M.ORIENTATION,segmentation:{mode:a||(window.innerWidth>window.innerHeight?"landscape":"portrait")}})};this.report_conversion=function(a,c){b(d.WARNING,"report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!");this.recordDirectAttribution(a,c)};this.recordDirectAttribution=function(a,c){b(d.INFO,"recordDirectAttribution, Recording the attribution for campaign ID: ["+
a+"] and the user ID: ["+c+"]");this.check_consent("attribution")&&(a=a||y("cly_cmp_id")||"cly_organic",(c=c||y("cly_cmp_uid"))?N({campaign_id:a,campaign_user:c}):N({campaign_id:a}))};this.user_details=function(a){b(d.INFO,"user_details, Trying to add user details: ",a);this.check_consent("users")&&(O(),b(d.INFO,"user_details, flushed the event queue"),a.name=z(a.name,f.maxValueSize,"user_details",b),a.username=z(a.username,f.maxValueSize,"user_details",b),a.email=z(a.email,f.maxValueSize,"user_details",
b),a.organization=z(a.organization,f.maxValueSize,"user_details",b),a.phone=z(a.phone,f.maxValueSize,"user_details",b),a.picture=z(a.picture,4096,"user_details",b),a.gender=z(a.gender,f.maxValueSize,"user_details",b),a.byear=z(a.byear,f.maxValueSize,"user_details",b),a.custom=aa(a.custom,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"user_details",b),N({user_details:JSON.stringify(xa(a,"name username email organization phone picture gender byear custom".split(" ")))}))};var Y={},fa=function(a,
c,e){f.check_consent("users")&&(Y[a]||(Y[a]={}),"$push"===e||"$pull"===e||"$addToSet"===e?(Y[a][e]||(Y[a][e]=[]),Y[a][e].push(c)):Y[a][e]=c)};this.userData={set:function(a,c){b(d.INFO,"[userData] set, Setting user's custom property value: ["+c+"] under the key: ["+a+"]");a=z(a,f.maxKeyLength,"userData set",b);c=z(c,f.maxValueSize,"userData set",b);Y[a]=c},unset:function(a){b(d.INFO,"[userData] unset, Resetting user's custom property with key: ["+a+"] ");Y[a]=""},set_once:function(a,c){b(d.INFO,"[userData] set_once, Setting user's unique custom property value: ["+
c+"] under the key: ["+a+"] ");a=z(a,f.maxKeyLength,"userData set_once",b);c=z(c,f.maxValueSize,"userData set_once",b);fa(a,c,"$setOnce")},increment:function(a){b(d.INFO,"[userData] increment, Increasing user's custom property value under the key: ["+a+"] by one");a=z(a,f.maxKeyLength,"userData increment",b);fa(a,1,"$inc")},increment_by:function(a,c){b(d.INFO,"[userData] increment_by, Increasing user's custom property value under the key: ["+a+"] by: ["+c+"]");a=z(a,f.maxKeyLength,"userData increment_by",
b);c=z(c,f.maxValueSize,"userData increment_by",b);fa(a,c,"$inc")},multiply:function(a,c){b(d.INFO,"[userData] multiply, Multiplying user's custom property value under the key: ["+a+"] by: ["+c+"]");a=z(a,f.maxKeyLength,"userData multiply",b);c=z(c,f.maxValueSize,"userData multiply",b);fa(a,c,"$mul")},max:function(a,c){b(d.INFO,"[userData] max, Saving user's maximum custom property value compared to the value: ["+c+"] under the key: ["+a+"]");a=z(a,f.maxKeyLength,"userData max",b);c=z(c,f.maxValueSize,
"userData max",b);fa(a,c,"$max")},min:function(a,c){b(d.INFO,"[userData] min, Saving user's minimum custom property value compared to the value: ["+c+"] under the key: ["+a+"]");a=z(a,f.maxKeyLength,"userData min",b);c=z(c,f.maxValueSize,"userData min",b);fa(a,c,"$min")},push:function(a,c){b(d.INFO,"[userData] push, Pushing a value: ["+c+"] under the key: ["+a+"] to user's custom property array");a=z(a,f.maxKeyLength,"userData push",b);c=z(c,f.maxValueSize,"userData push",b);fa(a,c,"$push")},push_unique:function(a,
c){b(d.INFO,"[userData] push_unique, Pushing a unique value: ["+c+"] under the key: ["+a+"] to user's custom property array");a=z(a,f.maxKeyLength,"userData push_unique",b);c=z(c,f.maxValueSize,"userData push_unique",b);fa(a,c,"$addToSet")},pull:function(a,c){b(d.INFO,"[userData] pull, Removing the value: ["+c+"] under the key: ["+a+"] from user's custom property array");fa(a,c,"$pull")},save:function(){b(d.INFO,"[userData] save, Saving changes to user's custom property");f.check_consent("users")&&
(O(),b(d.INFO,"user_details, flushed the event queue"),N({user_details:JSON.stringify({custom:Y})}));Y={}}};this.report_trace=function(a){b(d.INFO,"report_trace, Reporting performance trace");if(this.check_consent("apm")){for(var c="type name stz etz apm_metrics apm_attr".split(" "),e=0;e<c.length;e++)if("apm_attr"!==c[e]&&"undefined"===typeof a[c[e]]){b(d.WARNING,"report_trace, APM trace don't have the property: "+c[e]);return}a.name=z(a.name,f.maxKeyLength,"report_trace",b);a.app_metrics=aa(a.app_metrics,
f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"report_trace",b);c=xa(a,c);c.timestamp=a.stz;a=new Date;c.hour=a.getHours();c.dow=a.getDay();N({apm:JSON.stringify(c)});b(d.INFO,"report_trace, Successfully adding APM trace: ",c)}};this.track_errors=function(a){x?(b(d.INFO,"track_errors, Started tracking errors"),p.i[this.app_key].tracking_crashes=!0,window.cly_crashes||(window.cly_crashes=!0,qb=a,window.onerror=function r(e,h,m,g,n){if(void 0!==n&&null!==n)gb(n,!1);else{g=g||window.event&&window.event.errorCharacter;
n="";"undefined"!==typeof e&&(n+=e+"\n");"undefined"!==typeof h&&(n+="at "+h);"undefined"!==typeof m&&(n+=":"+m);"undefined"!==typeof g&&(n+=":"+g);n+="\n";try{e=[];for(var t=r.caller;t;)e.push(t.name),t=t.caller;n+=e.join("\n")}catch(I){b(d.ERROR,"track_errors, Call stack generation experienced a problem: "+I)}gb(n,!1)}},window.addEventListener("unhandledrejection",function(e){gb(Error("Unhandled rejection (reason: "+(e.reason&&e.reason.stack?e.reason.stack:e.reason)+")."),!0)}))):b(d.WARNING,"track_errors, window object is not available. Not tracking errors.")};
this.log_error=function(a,c){b(d.INFO,"log_error, Logging errors");this.recordError(a,!0,c)};this.add_log=function(a){b(d.INFO,"add_log, Adding a new log of breadcrumbs: [ "+a+" ]");if(this.check_consent("crashes")){for(a=z(a,f.maxValueSize,"add_log",b);ra.length>=f.maxBreadcrumbCount;)ra.shift(),b(d.WARNING,"add_log, Reached maximum crashLogs size. Will erase the oldest one.");ra.push(a)}};this.fetch_remote_config=function(a,c,e){var h=null,m=null,g=null;a&&(e||"function"!==typeof a?Array.isArray(a)&&
(h=a):g=a);c&&(e||"function"!==typeof c?Array.isArray(c)&&(m=c):g=c);g||"function"!==typeof e||(g=e);this.useExplicitRcApi?(b(d.INFO,"fetch_remote_config, Fetching remote config"),G(h,m,this.rcAutoOptinAb?1:0,null,g)):(b(d.WARNING,"fetch_remote_config, Fetching remote config, with legacy API"),G(h,m,null,"legacy",g))};this.enrollUserToAb=function(a){b(d.INFO,"enrollUserToAb, Providing AB test keys to opt in for");a&&Array.isArray(a)&&0!==a.length?(a={method:"ab",keys:JSON.stringify(a),av:f.app_version},
Ca(a),ba("enrollUserToAb",this.url+Sa,a,function(c,e,h){if(!c)try{var m=JSON.parse(h);b(d.DEBUG,"enrollUserToAb, Parsed the response's result: ["+m.result+"]")}catch(g){b(d.ERROR,"enrollUserToAb, Had an issue while parsing the response: "+g)}},!0)):b(d.ERROR,"enrollUserToAb, No keys provided")};this.get_remote_config=function(a){b(d.INFO,"get_remote_config, Getting remote config from storage");return"undefined"!==typeof a?R[a]:R};this.stop_time=function(){b(d.INFO,"stop_time, Stopping tracking duration");
oa&&(oa=!1,rb=F()-ja,Fa=F()-Ea)};this.start_time=function(){b(d.INFO,"start_time, Starting tracking duration");oa||(oa=!0,ja=F()-rb,Ea=F()-Fa,Fa=0,za())};this.track_sessions=function(){function a(){document[e]||!document.hasFocus()?f.stop_time():f.start_time()}function c(){Ma>=La&&f.start_time();Ma=0}if(x){b(d.INFO,"track_session, Starting tracking user session");this.begin_session();this.start_time();A(window,"beforeunload",function(){O();f.end_session()});var e="hidden";A(window,"focus",a);A(window,
"blur",a);A(window,"pageshow",a);A(window,"pagehide",a);"onfocusin"in document&&(A(window,"focusin",a),A(window,"focusout",a));e in document?document.addEventListener("visibilitychange",a):"mozHidden"in document?(e="mozHidden",document.addEventListener("mozvisibilitychange",a)):"webkitHidden"in document?(e="webkitHidden",document.addEventListener("webkitvisibilitychange",a)):"msHidden"in document&&(e="msHidden",document.addEventListener("msvisibilitychange",a));A(window,"mousemove",c);A(window,"click",
c);A(window,"keydown",c);A(window,"scroll",c);setInterval(function(){Ma++;Ma>=La&&f.stop_time()},6E4)}else b(d.WARNING,"track_sessions, window object is not available. Not tracking sessions.")};this.track_pageview=function(a,c,e){if(x||a)if(b(d.INFO,"track_pageview, Tracking page views"),b(d.VERBOSE,"track_pageview, last view is:["+W+"], current view ID is:["+ha+"], previous view ID is:["+Ba+"]"),W&&sb&&(b(d.DEBUG,"track_pageview, Scroll registry triggered"),pb(),Ka=!0,Ja=0),ma(),Ba=ha,ha=db(),(a=
z(a,f.maxKeyLength,"track_pageview",b))&&Array.isArray(a)&&(c=a,a=null),a||(a=this.getViewName()),void 0===a||""===a)b(d.ERROR,"track_pageview, No page name to track (it is either undefined or empty string). No page view can be tracked.");else if(null===a)b(d.ERROR,"track_pageview, View name returned as null. Page view will be ignored.");else{if(c&&c.length)for(var h=0;h<c.length;h++)try{if((new RegExp(c[h])).test(a)){b(d.INFO,"track_pageview, Ignoring the page: "+a);return}}catch(r){b(d.ERROR,"track_pageview, Problem with finding ignore list item: "+
c[h]+", error: "+r)}W=a;Ea=F();b(d.VERBOSE,"track_pageview, last view is assigned:["+W+"], current view ID is:["+ha+"], previous view ID is:["+Ba+"]");h={name:a,visit:1,view:f.getViewUrl()};h=aa(h,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"track_pageview",b);this.track_domains&&(h.domain=window.location.hostname);if(ia)if(V)va&&(va=!1,h.start=1);else{var m=y("cly_session");if(!m||parseInt(m)<=F())va=!1,h.start=1}else x&&"undefined"!==typeof document.referrer&&document.referrer.length&&
(m=Gb.exec(document.referrer))&&m[11]&&m[11]!==window.location.hostname&&(h.start=1);if(ka&&Object.keys(ka).length){b(d.INFO,"track_pageview, Adding fresh utm tags to segmentation:["+JSON.stringify(ka)+"]");for(var g in ka)"undefined"===typeof h["utm_"+g]&&(h["utm_"+g]=ka[g])}x&&mb()&&(b(d.INFO,"track_pageview, Adding referrer to segmentation:["+document.referrer+"]"),h.referrer=document.referrer);if(e){e=aa(e,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"track_pageview",b);for(var n in e)"undefined"===
typeof h[n]&&(h[n]=e[n])}this.check_consent("views")?v({key:M.VIEW,segmentation:h},ha):ea.track_pageview=arguments}else b(d.WARNING,"track_pageview, window object is not available. Not tracking page views is page is not provided.")};this.track_view=function(a,c,e){b(d.INFO,"track_view, Initiating tracking page views");this.track_pageview(a,c,e)};this.track_clicks=function(a){if(x){b(d.INFO,"track_clicks, Starting to track clicks");a&&b(d.INFO,"track_clicks, Tracking the specified children:["+a+"]");
a=a||document;var c=!0;A(a,"click",function(e){if(c){c=!1;hb(e);if("undefined"!==typeof e.pageX&&"undefined"!==typeof e.pageY){var h=Pa(),m=ib();f.check_consent("clicks")&&(e={type:"click",x:e.pageX,y:e.pageY,width:m,height:h,view:f.getViewUrl()},e=aa(e,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"processClick",b),f.track_domains&&(e.domain=window.location.hostname),v({key:M.ACTION,segmentation:e}))}setTimeout(function(){c=!0},1E3)}})}else b(d.WARNING,"track_clicks, window object is not available. Not tracking clicks.")};
this.track_scrolls=function(a){x?(b(d.INFO,"track_scrolls, Starting to track scrolls"),a&&b(d.INFO,"track_scrolls, Tracking the specified children"),a=a||window,sb=Ka=!0,A(a,"scroll",Lb),A(a,"beforeunload",pb)):b(d.WARNING,"track_scrolls, window object is not available. Not tracking scrolls.")};this.track_links=function(a){x?(b(d.INFO,"track_links, Starting to track clicks to links"),a&&b(d.INFO,"track_links, Tracking the specified children"),a=a||document,A(a,"click",function(c){a:{var e=Oa(c);var h;
for(h="A";e;){if(e.nodeName.toUpperCase()===h)break a;e=e.parentElement}e=void 0}e&&(hb(c),f.check_consent("clicks")&&v({key:"linkClick",segmentation:{href:e.href,text:e.innerText,id:e.id,view:f.getViewUrl()}}))})):b(d.WARNING,"track_links, window object is not available. Not tracking links.")};this.track_forms=function(a,c){function e(h){return h.name||h.id||h.type||h.nodeName}x?(b(d.INFO,"track_forms, Starting to track form submissions. DOM object provided:["+!!a+"] Tracking hidden inputs :["+!!c+
"]"),a=a||document,A(a,"submit",function(h){h=Oa(h);var m={id:h.attributes.id&&h.attributes.id.nodeValue,name:h.attributes.name&&h.attributes.name.nodeValue,action:h.attributes.action&&h.attributes.action.nodeValue,method:h.attributes.method&&h.attributes.method.nodeValue,view:f.getViewUrl()},g;if("undefined"!==typeof h.elements){for(var n=0;n<h.elements.length;n++)(g=h.elements[n])&&"password"!==g.type&&-1===g.className.indexOf("cly_user_ignore")&&("undefined"===typeof m["input:"+e(g)]&&(m["input:"+
e(g)]=[]),"select"===g.nodeName.toLowerCase()?"undefined"!==typeof g.multiple?m["input:"+e(g)].push(xb(g)):m["input:"+e(g)].push(g.options[g.selectedIndex].value):"input"===g.nodeName.toLowerCase()?"undefined"!==typeof g.type?"checkbox"===g.type.toLowerCase()||"radio"===g.type.toLowerCase()?g.checked&&m["input:"+e(g)].push(g.value):("hidden"!==g.type.toLowerCase()||c)&&m["input:"+e(g)].push(g.value):m["input:"+e(g)].push(g.value):"textarea"===g.nodeName.toLowerCase()?m["input:"+e(g)].push(g.value):
"undefined"!==typeof g.value&&m["input:"+e(g)].push(g.value));for(var r in m)m[r]&&"function"===typeof m[r].join&&(m[r]=m[r].join(", "))}f.check_consent("forms")&&v({key:"formSubmit",segmentation:m})})):b(d.WARNING,"track_forms, window object is not available. Not tracking forms.")};this.collect_from_forms=function(a,c){x?(b(d.INFO,"collect_from_forms, Starting to collect possible user data. DOM object provided:["+!!a+"] Submitting custom user property:["+!!c+"]"),a=a||document,A(a,"submit",function(e){e=
Oa(e);var h={},m=!1,g;if("undefined"!==typeof e.elements){var n={},r=a.getElementsByTagName("LABEL"),t;for(t=0;t<r.length;t++)r[t].htmlFor&&""!==r[t].htmlFor&&(n[r[t].htmlFor]=r[t].innerText||r[t].textContent||r[t].innerHTML);for(t=0;t<e.elements.length;t++)if((g=e.elements[t])&&"password"!==g.type&&-1===g.className.indexOf("cly_user_ignore"))if(r="","select"===g.nodeName.toLowerCase()?r="undefined"!==typeof g.multiple?xb(g):g.options[g.selectedIndex].value:"input"===g.nodeName.toLowerCase()?"undefined"!==
typeof g.type?"checkbox"===g.type.toLowerCase()||"radio"===g.type.toLowerCase()?g.checked&&(r=g.value):r=g.value:r=g.value:"textarea"===g.nodeName.toLowerCase()?r=g.value:"undefined"!==typeof g.value&&(r=g.value),g.className&&-1!==g.className.indexOf("cly_user_")){var I=g.className.split(" ");for(g=0;g<I.length;g++)if(0===I[g].indexOf("cly_user_")){h[I[g].replace("cly_user_","")]=r;m=!0;break}}else if(g.type&&"email"===g.type.toLowerCase()||g.name&&-1!==g.name.toLowerCase().indexOf("email")||g.id&&
-1!==g.id.toLowerCase().indexOf("email")||g.id&&n[g.id]&&-1!==n[g.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(r))h.email||(h.email=r),m=!0;else if(g.name&&-1!==g.name.toLowerCase().indexOf("username")||g.id&&-1!==g.id.toLowerCase().indexOf("username")||g.id&&n[g.id]&&-1!==n[g.id].toLowerCase().indexOf("username"))h.username||(h.username=r),m=!0;else if(g.name&&(-1!==g.name.toLowerCase().indexOf("tel")||-1!==g.name.toLowerCase().indexOf("phone")||-1!==g.name.toLowerCase().indexOf("number"))||
g.id&&(-1!==g.id.toLowerCase().indexOf("tel")||-1!==g.id.toLowerCase().indexOf("phone")||-1!==g.id.toLowerCase().indexOf("number"))||g.id&&n[g.id]&&(-1!==n[g.id].toLowerCase().indexOf("tel")||-1!==n[g.id].toLowerCase().indexOf("phone")||-1!==n[g.id].toLowerCase().indexOf("number")))h.phone||(h.phone=r),m=!0;else if(g.name&&(-1!==g.name.toLowerCase().indexOf("org")||-1!==g.name.toLowerCase().indexOf("company"))||g.id&&(-1!==g.id.toLowerCase().indexOf("org")||-1!==g.id.toLowerCase().indexOf("company"))||
g.id&&n[g.id]&&(-1!==n[g.id].toLowerCase().indexOf("org")||-1!==n[g.id].toLowerCase().indexOf("company")))h.organization||(h.organization=r),m=!0;else if(g.name&&-1!==g.name.toLowerCase().indexOf("name")||g.id&&-1!==g.id.toLowerCase().indexOf("name")||g.id&&n[g.id]&&-1!==n[g.id].toLowerCase().indexOf("name"))h.name||(h.name=""),h.name+=r+" ",m=!0}m&&(b(d.INFO,"collect_from_forms, Gathered user data",h),c?f.user_details({custom:h}):f.user_details(h))})):b(d.WARNING,"collect_from_forms, window object is not available. Not collecting from forms.")};
this.collect_from_facebook=function(a){x?"undefined"!==typeof FB&&FB&&FB.api?(b(d.INFO,"collect_from_facebook, Starting to collect possible user data"),FB.api("/me",function(c){var e={};c.name&&(e.name=c.name);c.email&&(e.email=c.email);"male"===c.gender?e.gender="M":"female"===c.gender&&(e.gender="F");if(c.birthday){var h=c.birthday.split("/").pop();h&&4===h.length&&(e.byear=h)}c.work&&c.work[0]&&c.work[0].employer&&c.work[0].employer.name&&(e.organization=c.work[0].employer.name);if(a){e.custom=
{};for(var m in a){h=a[m].split(".");for(var g=c,n=0;n<h.length&&(g=g[h[n]],"undefined"!==typeof g);n++);"undefined"!==typeof g&&(e.custom[m]=g)}}f.user_details(e)})):b(d.ERROR,"collect_from_facebook, Facebook SDK is not available"):b(d.WARNING,"collect_from_facebook, window object is not available. Not collecting from Facebook.")};this.opt_out=function(){b(d.INFO,"opt_out, Opting out the user");this.ignore_visitor=!0;w("cly_ignore",!0)};this.opt_in=function(){b(d.INFO,"opt_in, Opting in the user");
w("cly_ignore",!1);this.ignore_visitor=!1;Q();this.ignore_visitor||Va||Ua()};this.report_feedback=function(a){b(d.WARNING,"report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' or 'reportFeedbackWidgetManually' in place of this call. Call will be redirected to 'recordRatingWidgetWithID' now!");this.recordRatingWidgetWithID(a)};this.recordRatingWidgetWithID=function(a){b(d.INFO,"recordRatingWidgetWithID, Providing information about user with ID: [ "+a.widget_id+" ]");if(this.check_consent("star-rating"))if(a.widget_id)if(a.rating){var c=
{key:M.STAR_RATING,count:1,segmentation:{}};c.segmentation=xa(a,"widget_id contactMe platform app_version rating email comment".split(" "));c.segmentation.app_version||(c.segmentation.app_version=this.metrics._app_version||this.app_version);5<c.segmentation.rating?(b(d.WARNING,"recordRatingWidgetWithID, You have entered a rating higher than 5. Changing it back to 5 now."),c.segmentation.rating=5):1>c.segmentation.rating&&(b(d.WARNING,"recordRatingWidgetWithID, You have entered a rating lower than 1. Changing it back to 1 now."),
c.segmentation.rating=1);b(d.INFO,"recordRatingWidgetWithID, Reporting Rating Widget: ",c);v(c)}else b(d.ERROR,"recordRatingWidgetWithID, Rating Widget must contain rating property");else b(d.ERROR,"recordRatingWidgetWithID, Rating Widget must contain widget_id property")};this.reportFeedbackWidgetManually=function(a,c,e){if(this.check_consent("feedback"))if(a&&c)if(a._id)if(K)b(d.ERROR,"reportFeedbackWidgetManually, Feedback Widgets can not be reported in offline mode");else{b(d.INFO,"reportFeedbackWidgetManually, Providing information about user with, provided result of the widget with  ID: [ "+
a._id+" ] and type: ["+a.type+"]");var h=[];c=a.type;if("nps"===c){if(e){if(!e.rating){b(d.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");return}e.rating=Math.round(e.rating);10<e.rating?(b(d.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 10. Changing it back to 10 now."),e.rating=10):0>e.rating&&(b(d.WARNING,"reportFeedbackWidgetManually, You have entered a rating lower than 0. Changing it back to 0 now."),e.rating=0);h=["rating","comment"]}var m=
M.NPS}else if("survey"===c){if(e){if(1>Object.keys(e).length){b(d.ERROR,"reportFeedbackWidgetManually, Widget should have answers to be reported");return}h=Object.keys(e)}m=M.SURVEY}else if("rating"===c){if(e){if(!e.rating){b(d.ERROR,"reportFeedbackWidgetManually, Widget must contain rating property");return}e.rating=Math.round(e.rating);5<e.rating?(b(d.WARNING,"reportFeedbackWidgetManually, You have entered a rating higher than 5. Changing it back to 5 now."),e.rating=5):1>e.rating&&(b(d.WARNING,
"reportFeedbackWidgetManually, You have entered a rating lower than 1. Changing it back to 1 now."),e.rating=1);h=["rating","comment","email","contactMe"]}m=M.STAR_RATING}else{b(d.ERROR,"reportFeedbackWidgetManually, Widget has an unacceptable type");return}a={key:m,count:1,segmentation:{widget_id:a._id,platform:this.platform,app_version:this.metrics._app_version||this.app_version}};if(null===e)a.segmentation.closed=1;else{m=a.segmentation;if(h){for(var g,n=0,r=h.length;n<r;n++)g=h[n],"undefined"!==
typeof e[g]&&(m[g]=e[g]);e=m}else e=void 0;a.segmentation=e}b(d.INFO,"reportFeedbackWidgetManually, Reporting "+c+": ",a);v(a)}else b(d.ERROR,"reportFeedbackWidgetManually, Feedback Widgets must contain _id property");else b(d.ERROR,"reportFeedbackWidgetManually, Widget data and/or Widget object not provided. Aborting.")};this.show_feedback_popup=function(a){x?(b(d.WARNING,"show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!"),
this.presentRatingWidgetWithID(a)):b(d.WARNING,"show_feedback_popup, window object is not available. Not showing feedback popup.")};this.presentRatingWidgetWithID=function(a){x?(b(d.INFO,"presentRatingWidgetWithID, Showing rating widget popup for the widget with ID: [ "+a+" ]"),this.check_consent("star-rating")&&(K?b(d.ERROR,"presentRatingWidgetWithID, Cannot show ratingWidget popup in offline mode"):ba("presentRatingWidgetWithID,",this.url+"/o/feedback/widget",{widget_id:a,av:f.app_version},function(c,
e,h){if(!c)try{var m=JSON.parse(h);U(m,!1)}catch(g){b(d.ERROR,"presentRatingWidgetWithID, JSON parse failed: "+g)}},!0))):b(d.WARNING,"presentRatingWidgetWithID, window object is not available. Not showing rating widget popup.")};this.initialize_feedback_popups=function(a){x?(b(d.WARNING,"initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!"),this.initializeRatingWidgets(a)):b(d.WARNING,"initialize_feedback_popups, window object is not available. Not initializing feedback popups.")};
this.initializeRatingWidgets=function(a){if(x){if(b(d.INFO,"initializeRatingWidgets, Initializing rating widget with provided widget IDs:[ "+a+"]"),this.check_consent("star-rating")){a||(a=y("cly_fb_widgets"));for(var c=document.getElementsByClassName("countly-feedback-sticker");0<c.length;)c[0].remove();ba("initializeRatingWidgets,",this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a),av:f.app_version},function(e,h,m){if(!e)try{var g=JSON.parse(m);for(e=0;e<g.length;e++)if("true"===
g[e].is_active){var n=g[e].target_devices,r=zb();if(n[r])if("string"===typeof g[e].hide_sticker&&(g[e].hide_sticker="true"===g[e].hide_sticker),"all"!==g[e].target_page||g[e].hide_sticker){var t=g[e].target_pages;for(h=0;h<t.length;h++){var I=t[h].substr(0,t[h].length-1)===window.location.pathname.substr(0,t[h].length-1),C=t[h]===window.location.pathname;(t[h].includes("*")&&I||C)&&!g[e].hide_sticker&&U(g[e],!0)}}else U(g[e],!0)}}catch(na){b(d.ERROR,"initializeRatingWidgets, JSON parse error: "+na)}},
!0)}}else b(d.WARNING,"initializeRatingWidgets, window object is not available. Not initializing rating widgets.")};this.enable_feedback=function(a){x?(b(d.WARNING,"enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!"),this.enableRatingWidgets(a)):b(d.WARNING,"enable_feedback, window object is not available. Not enabling feedback.")};this.enableRatingWidgets=function(a){x?(b(d.INFO,"enableRatingWidgets, Enabling rating widget with params:",
a),this.check_consent("star-rating")&&(K?b(d.ERROR,"enableRatingWidgets, Cannot enable rating widgets in offline mode"):(w("cly_fb_widgets",a.popups||a.widgets),Qa(this.url+"/star-rating/stylesheets/countly-feedback-web.css"),a=a.popups||a.widgets,0<a.length?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),this.initializeRatingWidgets(a)):b(d.ERROR,"enableRatingWidgets, You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")))):
b(d.WARNING,"enableRatingWidgets, window object is not available. Not enabling rating widgets.")};this.get_available_feedback_widgets=function(a){b(d.INFO,"get_available_feedback_widgets, Getting the feedback list, callback function is provided:["+!!a+"]");this.check_consent("feedback")?K?b(d.ERROR,"get_available_feedback_widgets, Cannot enable feedback widgets in offline mode."):ba("get_available_feedback_widgets,",this.url+Sa,{method:"feedback",device_id:this.device_id,app_key:this.app_key,av:f.app_version},
function(c,e,h){if(c)a&&a(null,c);else try{var m=JSON.parse(h).result||[];a&&a(m,null)}catch(g){b(d.ERROR,"get_available_feedback_widgets, Error while parsing feedback widgets list: "+g),a&&a(null,g)}},!1):a&&a(null,Error("Consent for feedback not provided."))};this.getFeedbackWidgetData=function(a,c){if(a.type)if(b(d.INFO,"getFeedbackWidgetData, Retrieving data for: ["+JSON.stringify(a)+"], callback function is provided:["+!!c+"]"),this.check_consent("feedback"))if(K)b(d.ERROR,"getFeedbackWidgetData, Cannot enable feedback widgets in offline mode.");
else{var e=this.url,h={widget_id:a._id,shown:1,sdk_version:"23.12.0",sdk_name:"javascript_native_web",platform:this.platform,app_version:this.app_version};if("nps"===a.type)e+="/o/surveys/nps/widget";else if("survey"===a.type)e+="/o/surveys/survey/widget";else if("rating"===a.type)e+="/o/surveys/rating/widget";else{b(d.ERROR,"getFeedbackWidgetData, Unknown type info: ["+a.type+"]");return}ba("getFeedbackWidgetData,",e,h,function(m,g,n){if(m)c&&c(null,m);else try{var r=JSON.parse(n);c&&c(r,null)}catch(t){b(d.ERROR,
"getFeedbackWidgetData, Error while parsing feedback widgets list: "+t),c&&c(null,t)}},!0)}else c&&c(null,Error("Consent for feedback not provided."));else b(d.ERROR,"getFeedbackWidgetData, Expected the provided widget object to have a type but got: ["+JSON.stringify(a)+"], aborting.")};this.present_feedback_widget=function(a,c,e,h){function m(B){document.getElementById("countly-surveys-wrapper-"+B._id).style.display="block";document.getElementById("csbg").style.display="block"}function g(B){if(!B.appearance.hideS){b(d.DEBUG,
"present_feedback_widget, handling the sticker as it was not set to hidden");var T=document.createElement("div");T.innerText=B.appearance.text;T.style.color=7>B.appearance.text_color.length?"#"+B.appearance.text_color:B.appearance.text_color;T.style.backgroundColor=7>B.appearance.bg_color.length?"#"+B.appearance.bg_color:B.appearance.bg_color;T.className="countly-feedback-sticker  "+B.appearance.position+"-"+B.appearance.size;T.id="countly-feedback-sticker-"+B._id;document.body.appendChild(T);A(document.getElementById("countly-feedback-sticker-"+
B._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+B._id).style.display="flex";document.getElementById("csbg").style.display="block"})}A(document.getElementById("countly-feedback-close-icon-"+B._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+B._id).style.display="none";document.getElementById("csbg").style.display="none"})}if(x){if(b(d.INFO,"present_feedback_widget, Presenting the feedback widget by appending to the element with ID: [ "+c+" ] and className: [ "+
e+" ]"),this.check_consent("feedback"))if(!a||"object"!==L(a)||Array.isArray(a))b(d.ERROR,"present_feedback_widget, Please provide at least one feedback widget object.");else{b(d.INFO,"present_feedback_widget, Adding segmentation to feedback widgets:["+JSON.stringify(h)+"]");h&&"object"===L(h)&&0!==Object.keys(h).length||(b(d.DEBUG,"present_feedback_widget, Segmentation is not an object or empty"),h=null);try{var n=this.url;if("nps"===a.type)b(d.DEBUG,"present_feedback_widget, Widget type: nps."),
n+="/feedback/nps";else if("survey"===a.type)b(d.DEBUG,"present_feedback_widget, Widget type: survey."),n+="/feedback/survey";else if("rating"===a.type)b(d.DEBUG,"present_feedback_widget, Widget type: rating."),n+="/feedback/rating";else{b(d.ERROR,"present_feedback_widget, Feedback widget only accepts nps, rating and survey types.");return}var r=window.origin||window.location.origin;if("rating"===a.type){b(d.DEBUG,"present_feedback_widget, Loading css for rating widget.");var t="ratings";Qa(this.url+
"/star-rating/stylesheets/countly-feedback-web.css")}else b(d.DEBUG,"present_feedback_widget, Loading css for survey or nps."),Qa(this.url+"/surveys/stylesheets/countly-surveys.css"),t="surveys";n+="?widget_id="+a._id;n+="&app_key="+this.app_key;n+="&device_id="+this.device_id;n+="&sdk_name=javascript_native_web";n+="&platform="+this.platform;n+="&app_version="+this.app_version;n+="&sdk_version=23.12.0";if(h){var I={};I.sg=h;n+="&custom="+JSON.stringify(I)}n+="&origin="+r;n+="&widget_v=web";var C=
document.createElement("iframe");C.src=n;C.name="countly-"+t+"-iframe";C.id="countly-"+t+"-iframe";var na=!1;C.onload=function(){na&&(document.getElementById("countly-"+t+"-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none");na=!0;b(d.DEBUG,"present_feedback_widget, Loaded iframe.")};for(var Da=document.getElementById("csbg");Da;)Da.remove(),Da=document.getElementById("csbg"),b(d.DEBUG,"present_feedback_widget, Removing past overlay.");var Z=document.getElementsByClassName("countly-"+
t+"-wrapper");for(h=0;h<Z.length;h++)Z[h].remove(),b(d.DEBUG,"present_feedback_widget, Removed a wrapper.");Z=document.createElement("div");Z.className="countly-"+t+"-wrapper";Z.id="countly-"+t+"-wrapper-"+a._id;"survey"===a.type&&(Z.className=Z.className+" "+a.appearance.position);var bb=document.body;h=!1;c&&(document.getElementById(c)?(bb=document.getElementById(c),h=!0):b(d.ERROR,"present_feedback_widget, Provided ID not found."));h||e&&(document.getElementsByClassName(e)[0]?bb=document.getElementsByClassName(e)[0]:
b(d.ERROR,"present_feedback_widget, Provided class not found."));bb.insertAdjacentHTML("beforeend",'<div id="csbg"></div>');bb.appendChild(Z);if("rating"===a.type){var ub=document.createElement("div");ub.className="countly-ratings-overlay";ub.id="countly-ratings-overlay-"+a._id;Z.appendChild(ub);b(d.DEBUG,"present_feedback_widget, appended the rating overlay to wrapper");A(document.getElementById("countly-ratings-overlay-"+a._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+
a._id).style.display="none"})}Z.appendChild(C);b(d.DEBUG,"present_feedback_widget, Appended the iframe");A(window,"message",function(B){var T={};try{T=JSON.parse(B.data),b(d.DEBUG,"present_feedback_widget, Parsed response message "+T)}catch(Vb){b(d.ERROR,"present_feedback_widget, Error while parsing message body "+Vb)}T.close?(document.getElementById("countly-"+t+"-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none"):b(d.DEBUG,"present_feedback_widget, Closing signal not sent yet")});
if("survey"===a.type){var P=!1;switch(a.showPolicy){case "afterPageLoad":"complete"===document.readyState?P||(P=!0,m(a)):A(document,"readystatechange",function(B){"complete"!==B.target.readyState||P||(P=!0,m(a))});break;case "afterConstantDelay":setTimeout(function(){P||(P=!0,m(a))},1E4);break;case "onAbandon":"complete"===document.readyState?A(document,"mouseleave",function(){P||(P=!0,m(a))}):A(document,"readystatechange",function(B){"complete"===B.target.readyState&&A(document,"mouseleave",function(){P||
(P=!0,m(a))})});break;case "onScrollHalfwayDown":A(window,"scroll",function(){if(!P){var B=Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),T=Pa();B>=T/2&&(P=!0,m(a))}});break;default:P||(P=!0,m(a))}}else if("nps"===a.type)document.getElementById("countly-"+t+"-wrapper-"+a._id).style.display="block",document.getElementById("csbg").style.display="block";else if("rating"===a.type){var cb=!1;"complete"===document.readyState?cb||(cb=!0,g(a)):A(document,"readystatechange",
function(B){"complete"!==B.target.readyState||cb||(cb=!0,g(a))})}}catch(B){b(d.ERROR,"present_feedback_widget, Something went wrong while presenting the widget: "+B)}}}else b(d.WARNING,"present_feedback_widget, window object is not available. Not presenting feedback widget.")};this.recordError=function(a,c,e){b(d.INFO,"recordError, Recording error");if(this.check_consent("crashes")&&a){e=e||qb;var h="";"object"===L(a)?"undefined"!==typeof a.stack?h=a.stack:("undefined"!==typeof a.name&&(h+=a.name+
":"),"undefined"!==typeof a.message&&(h+=a.message+"\n"),"undefined"!==typeof a.fileName&&(h+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(h+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(h+=":"+a.columnNumber)):h=a+"";if(h.length>f.maxStackTraceLineLength*f.maxStackTraceLinesPerThread){b(d.DEBUG,"record_error, Error stack is too long will be truncated");a=h.split("\n");a.length>f.maxStackTraceLinesPerThread&&(a=a.splice(0,f.maxStackTraceLinesPerThread));h=0;for(var m=a.length;h<
m;h++)a[h].length>f.maxStackTraceLineLength&&(a[h]=a[h].substring(0,f.maxStackTraceLineLength));h=a.join("\n")}c=!!c;a=Ra();h={_resolution:a._resolution,_error:h,_app_version:a._app_version,_run:F()-Ob,_not_os_specific:!0,_javascript:!0};if(m=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)h._bat=Math.floor(100*m.level);"undefined"!==typeof navigator.onLine&&(h._online=!!navigator.onLine);x&&(h._background=!document.hasFocus());0<ra.length&&(h._logs=ra.join("\n"));
ra=[];h._nonfatal=c;h._view=this.getViewName();"undefined"!==typeof e&&(e=aa(e,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"record_error",b),h._custom=e);try{var g=document.createElement("canvas").getContext("experimental-webgl");h._opengl=g.getParameter(g.VERSION)}catch(n){b(d.ERROR,"Could not get the experimental-webgl context: "+n)}c={};c.crash=JSON.stringify(h);c.metrics=JSON.stringify({_ua:a._ua});N(c)}};this.onStorageChange=function(a,c){b(d.DEBUG,"onStorageChange, Applying storage changes for key:",
a);b(d.DEBUG,"onStorageChange, Applying storage changes for value:",c);switch(a){case "cly_queue":H=f.deserialize(c||"[]");break;case "cly_event":J=f.deserialize(c||"[]");break;case "cly_remote_configs":R=f.deserialize(c||"{}");break;case "cly_ignore":f.ignore_visitor=f.deserialize(c);break;case "cly_id":f.device_id=c;break;case "cly_id_type":D=f.deserialize(c)}};this._internals={store:w,getDocWidth:ib,getDocHeight:Pa,getViewportHeight:Bb,get_page_coord:hb,get_event_target:Oa,add_event_listener:A,
createNewObjectFromProperties:xa,truncateObject:aa,truncateSingleValue:z,stripTrailingSlash:sa,prepareParams:wa,sendXmlHttpRequest:Jb,isResponseValid:ob,getInternalDeviceIdType:function(){return D},getMsTimestamp:fb,getTimestamp:F,isResponseValidBroad:nb,secureRandom:db,log:b,checkIfLoggingIsOn:Aa,getMetrics:Ra,getUA:Ib,prepareRequest:Ca,generateUUID:eb,sendEventsForced:O,isUUID:function(a){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(a)},isReferrerUsable:mb,
getId:lb,heartBeat:Ua,toRequestQueue:N,reportViewDuration:ma,loadJS:Db,loadCSS:Qa,getLastView:function(){return W},setToken:Mb,getToken:function(){var a=y("cly_token");X("cly_token");return a},showLoader:Eb,hideLoader:Fb,setValueInStorage:w,getValueFromStorage:y,removeValueFromStorage:X,add_cly_events:v,processScrollView:pb,processScroll:Lb,currentUserAgentString:ta,userAgentDeviceDetection:zb,userAgentSearchBotDetection:Ab,getRequestQueue:function(){return H},getEventQueue:function(){return J},sendFetchRequest:Kb,
makeNetworkRequest:ba,clearQueue:function(){H=[];w("cly_queue",[]);J=[];w("cly_event",[])},getLocalQueues:function(){return{eventQ:J,requestQ:H}}};var pa={sendInstantHCRequest:function(){var a=z(f.hcErrorMessage,1E3,"healthCheck",b);a={el:f.hcErrorCount,wl:f.hcWarningCount,sc:f.hcStatusCode,em:JSON.stringify(a)};a={hc:JSON.stringify(a),metrics:JSON.stringify({_app_version:f.app_version})};Ca(a);ba("[healthCheck]",f.url+kb,a,function(c){c||pa.resetAndSaveCounters()},!0)},resetAndSaveCounters:function(){pa.resetCounters();
w(S.errorCount,f.hcErrorCount);w(S.warningCount,f.hcWarningCount);w(S.statusCode,f.hcStatusCode);w(S.errorMessage,f.hcErrorMessage)},incrementErrorCount:function(){f.hcErrorCount++},incrementWarningCount:function(){f.hcWarningCount++},resetCounters:function(){f.hcErrorCount=0;f.hcWarningCount=0;f.hcStatusCode=-1;f.hcErrorMessage=""},saveRequestCounters:function(a,c){f.hcStatusCode=a;f.hcErrorMessage=c;w(S.statusCode,f.hcStatusCode);w(S.errorMessage,f.hcErrorMessage)}};this.initialize()});p.CountlyClass=
Qb;p.init=function(k){k=k||{};if(p.loadAPMScriptsAsync&&Hb)Hb=!1,Sb(k);else{var q=k.app_key||p.app_key;if(!p.i||!p.i[q]){k=new Qb(k);if(!p.i){p.i={};for(var v in k)p[v]=k[v]}p.i[q]=k}return p.i[q]}};var Na=0;x&&window.addEventListener("storage",function(k){var q=(k.key+"").split("/"),v=q.pop();q=q.pop();if(p.i&&p.i[q])p.i[q].onStorageChange(v,k.newValue)});p.serialize=function(k){"object"===L(k)&&(k=JSON.stringify(k));return k};p.deserialize=function(k){if(""===k)return k;try{k=JSON.parse(k)}catch(q){Aa()&&
console.warn("[WARNING] [Countly] deserialize, Could not parse the file:["+k+"], error: "+q)}return k};p.getViewName=function(){return x?window.location.pathname:"web_worker"};p.getViewUrl=function(){return x?window.location.pathname:"web_worker"};p.getSearchQuery=function(){if(x)return window.location.search};p.DeviceIdType={DEVELOPER_SUPPLIED:0,SDK_GENERATED:1,TEMPORARY_ID:2};la.default=p;Object.defineProperty(la,"__esModule",{value:!0})});
