(function(m,da){"function"===typeof define&&define.amd?define([],function(){return da(m.Countly)}):"object"===typeof module&&module.exports?module.exports=da(m.Countly):m.Countly=da(m.Countly)})("undefined"!==typeof window?window:this,function(m){function da(h){var q=[];if("undefined"!==typeof h.options)for(var t=0;t<h.options.length;t++)h.options[t].selected&&q.push(h.options[t].value);return q.join(", ")}function Oa(){var h=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(q){var t=(h+16*Math.random())%16|0;h=Math.floor(h/16);return("x"===q?t:t&3|8).toString(16)})}function C(){return Math.floor((new Date).getTime()/1E3)}function Aa(){var h=(new Date).getTime();oa>=h?oa++:oa=h;return oa}function v(h,q,t){if(q&&Object.keys(q).length){if("undefined"!==typeof q[h])return q[h]}else if("undefined"!==typeof m[h])return m[h];return t}function Ba(h,q,t){for(var z in m.i)m.i[z].tracking_crashes&&m.i[z].recordError(h,q,t)}function Pa(h){var q=[],t;for(t in h)q.push(t+
"="+encodeURIComponent(h[t]));return q.join("&")}function Ca(h){return"/"===h.substr(h.length-1)?h.substr(0,h.length-1):h}function ia(h,q){for(var t={},z,H=0;H<q.length;H++)z=q[H],"undefined"!==typeof h[z]&&(t[z]=h[z]);return t}function P(h,q,t,z,H,Q){var K={};if(h){if(Object.keys(h).length>z){var N={},E=0,V;for(V in h)E<z&&(N[V]=h[V],E++);h=N}for(var ea in h)z=w(ea,q,H,Q),N=w(h[ea],t,H,Q),K[z]=N}return K}function w(h,q,t,z){var H=h;"number"===typeof h&&(h=h.toString());"string"===typeof h&&h.length>
q&&(H=h.substring(0,q),z(k.DEBUG,t+", Key: [ "+h+" ] is longer than accepted length. It will be truncated."));return H}function Da(h){"undefined"===typeof h.pageY&&"number"===typeof h.clientX&&document.documentElement&&(h.pageX=h.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,h.pageY=h.clientY+document.body.scrollTop+document.documentElement.scrollTop);return h}function pa(){var h=document;return Math.max(Math.max(h.body.scrollHeight,h.documentElement.scrollHeight),Math.max(h.body.offsetHeight,
h.documentElement.offsetHeight),Math.max(h.body.clientHeight,h.documentElement.clientHeight))}function Ea(){var h=document;return Math.max(Math.max(h.body.scrollWidth,h.documentElement.scrollWidth),Math.max(h.body.offsetWidth,h.documentElement.offsetWidth),Math.max(h.body.clientWidth,h.documentElement.clientWidth))}function Qa(){var h=document;return Math.min(Math.min(h.body.clientHeight,h.documentElement.clientHeight),Math.min(h.body.offsetHeight,h.documentElement.offsetHeight),window.innerHeight)}
function Ra(h,q,t,z,H,Q){var K=document.createElement(h),N;K.setAttribute(q,t);K.setAttribute(z,H);Q&&(K.onreadystatechange=function(){K.onload=function(){N||Q();N=!0}});document.getElementsByTagName("head")[0].appendChild(K)}function Sa(h,q){Ra("script","type","text/javascript","src",h,q)}function qa(h,q){Ra("link","rel","stylesheet","href",h,q)}function Ta(){var h=document.getElementById("cly-loader");if(!h){var q=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");
t.type="text/css";t.styleSheet?t.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
t.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
q.appendChild(t);h=document.createElement("div");h.setAttribute("id","cly-loader");document.body.onload=function(){if(!m.showLoaderProtection)try{document.body.appendChild(h)}catch(z){}}}h.style.display="block"}function Ua(){m.showLoaderProtection=!0;var h=document.getElementById("cly-loader");h&&(h.style.display="none")}if("undefined"!==typeof window){m=m||{};m.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm feedback remote-config".split(" ");
m.utm={source:!0,medium:!0,campaign:!0,term:!0,content:!0};var k={ERROR:"[ERROR] ",WARNING:"[WARNING] ",INFO:"[INFO] ",DEBUG:"[DEBUG] ",VERBOSE:"[VERBOSE] "};m.q=m.q||[];m.onload=m.onload||[];var Va=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?::([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?::([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,gb=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/;
m.CountlyClass=function(h){function q(a){if(!e.ignore_visitor)if(a.key){a.count||(a.count=1);a.key=w(a.key,e.maxKeyLength,"add_cly_event",f);a.segmentation=P(a.segmentation,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"add_cly_event",f);var b=ia(a,["key","count","sum","dur","segmentation"]);b.timestamp=Aa();var c=new Date;b.hour=c.getHours();b.dow=c.getDay();G.push(b);p("cly_event",G);f(k.INFO,"Successfully adding event: ",a)}else f(k.ERROR,"Adding event failed. Event must have a key property")}
function t(){e.ignore_prefetch&&"undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState&&(e.ignore_visitor=!0);e.ignore_bots&&gb.test(navigator.userAgent)&&(e.ignore_visitor=!0)}function z(a,b){if(!document.getElementById("countly-feedback-sticker-"+a._id))try{var c=document.createElement("div");c.className="countly-iframe-wrapper";c.id="countly-iframe-wrapper-"+a._id;var g=document.createElement("span");g.className="countly-feedback-close-icon";g.id="countly-feedback-close-icon-"+
a._id;g.innerText="x";var l=document.createElement("iframe");l.name="countly-feedback-iframe";l.id="countly-feedback-iframe";l.src=e.url+"/feedback?widget_id="+a._id+"&app_key="+e.app_key+"&device_id="+e.device_id+"&sdk_version=21.11.4";document.body.appendChild(c);c.appendChild(g);c.appendChild(l);x(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="none";document.getElementById("cfbg").style.display=
"none"});if(b){var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.id="feedback-sticker-svg";d.setAttribute("aria-hidden","true");d.setAttribute("data-prefix","far");d.setAttribute("data-icon","grin");d.setAttribute("class","svg-inline--fa fa-grin fa-w-16");d.setAttribute("role","img");d.setAttribute("xmlns","http://www.w3.org/2000/svg");d.setAttribute("viewBox","0 0 496 512");var n=document.createElementNS("http://www.w3.org/2000/svg","path");n.id="smileyPathInStickerSvg";n.setAttribute("fill",
"white");n.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");var r=document.createElement("span");
r.innerText=a.trigger_button_text;var u=document.createElement("div");u.style.color=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color;u.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;u.className="countly-feedback-sticker  "+a.trigger_position+"-"+a.trigger_size;u.id="countly-feedback-sticker-"+a._id;d.appendChild(n);u.appendChild(d);u.appendChild(r);document.body.appendChild(u);var B=document.getElementById("smileyPathInStickerSvg");
B&&(B.style.fill=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color);x(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(L){f(k.ERROR,"Somethings went wrong while element injecting process: "+
L)}}function H(){var a;if("undefined"!==typeof e.onload&&0<e.onload.length){for(a=0;a<e.onload.length;a++)if("function"===typeof e.onload[a])e.onload[a](e);e.onload=[]}}function Q(){if(X){var a={name:X};e.check_consent("views")&&q({key:"[CLY]_view",dur:Y?C()-ja:ka,segmentation:a});X=null}}function K(){if(la){var a=p("cly_session");if(!a||parseInt(a)<=C())R=!1,e.begin_session(!ma);p("cly_session",C()+60*Fa)}}function N(a){a.app_key=e.app_key;a.device_id=e.device_id;a.sdk_name="javascript_native_web";
a.sdk_version="21.11.4";e.check_consent("location")?(e.country_code&&(a.country_code=e.country_code),e.city&&(a.city=e.city),null!==e.ip_address&&(a.ip_address=e.ip_address)):a.location="";a.timestamp=Aa();var b=new Date;a.hour=b.getHours();a.dow=b.getDay()}function E(a){e.ignore_visitor||(e.app_key&&e.device_id?(N(a),D.length>Wa&&D.shift(),D.push(a),p("cly_queue",D,!0)):f(k.ERROR,"app_key or device_id is missing ",e.app_key,e.device_id))}function V(){H();if(e.test_mode||e.ignore_visitor)ra=!1;else{ra=
!0;var a=0;if(sa&&"undefined"!==typeof m.q&&0<m.q.length){var b=m.q;m.q=[];for(a=0;a<b.length;a++){var c=b[a];f(k.DEBUG,"Processing queued call",c);if("function"===typeof c)c();else if(Array.isArray(c)&&0<c.length){var g=e,l=0;m.i[c[l]]&&(g=m.i[c[l]],l++);if("function"===typeof g[c[l]])g[c[l]].apply(g,c.slice(l+1));else if(0===c[l].indexOf("userData.")){var d=c[l].replace("userData.","");"function"===typeof g.userData[d]&&g.userData[d].apply(g,c.slice(l+1))}else"function"===typeof m[c[l]]&&m[c[l]].apply(m,
c.slice(l+1))}}}R&&ma&&Y&&(a=C(),a-Z>Xa&&(e.session_duration(a-Z),Z=a));0<G.length&&(G.length<=Ga?(E({events:JSON.stringify(G)}),G=[]):(a=G.splice(0,Ga),E({events:JSON.stringify(a)})),p("cly_event",G));!S&&0<D.length&&ta&&C()>Ha&&(ta=!1,a=D[0],f(k.DEBUG,"Processing request",a),p("cly_queue",D,!0),e.tests||fa("send_request_queue",e.url+Ya,a,function(n,r){f(k.DEBUG,"Request Finished",r,n);n?(Ha=C()+Za,f(k.ERROR,"Request error: ",n)):D.shift();p("cly_queue",D,!0);ta=!0}));setTimeout(V,$a)}}function ea(){return p("cly_id")||
Oa()}function ua(){var a=JSON.parse(JSON.stringify(e.metrics||{}));a._app_version=a._app_version||e.app_version;a._ua=a._ua||navigator.userAgent;if(screen.width){var b=screen.width?parseInt(screen.width):0,c=screen.height?parseInt(screen.height):0;if(0!==b&&0!==c){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)b=Math.round(b*window.devicePixelRatio),c=Math.round(c*window.devicePixelRatio);else if(90===Math.abs(window.orientation)){var g=b;b=c;c=g}a._resolution=
a._resolution||""+b+"x"+c}}window.devicePixelRatio&&(a._density=a._density||window.devicePixelRatio);b=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof b&&(a._locale=a._locale||b);if("undefined"!==typeof document.referrer&&document.referrer.length&&(b=Va.exec(document.referrer))&&b[11]&&b[11]!==window.location.hostname){b=!1;if(W&&W.length)for(c=0;c<W.length;c++)try{if((new RegExp(W[c])).test(document.referrer)){f(k.DEBUG,"Ignored:",
document.referrer);b=!0;break}}catch(l){f(k.ERROR,"Problem with regex",W[c])}b||(a._store=a._store||document.referrer)}f(k.DEBUG,"Got metrics",a);return a}function f(a,b){if(e.debug&&"undefined"!==typeof console){arguments[2]&&"object"===typeof arguments[2]&&(arguments[2]=JSON.stringify(arguments[2]));sa||(b="["+e.app_key+"] "+b);a||(a=k.DEBUG);for(var c="",g=2;g<arguments.length;g++)c+=arguments[g];c=a+b+c;a===k.ERROR?console.error(c):a===k.WARNING?console.warn(c):a===k.INFO?console.info(c):a===
k.VERBOSE?console.log(c):console.debug(c)}}function fa(a,b,c,g,l){l=l||!1;try{f(k.DEBUG,"Sending XML HTTP request");var d=null;window.XMLHttpRequest?d=new window.XMLHttpRequest:window.ActiveXObject&&(d=new window.ActiveXObject("Microsoft.XMLHTTP"));c=c||{};var n=Pa(c),r="GET";if(e.force_post||2E3<=n.length)r="POST";"GET"===r?d.open("GET",b+"?"+n,!0):(d.open("POST",b,!0),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"));for(var u in e.headers)d.setRequestHeader(u,e.headers[u]);
d.onreadystatechange=function(){4===this.readyState&&(f(k.DEBUG,a+" HTTP request completed ["+this.status+"]["+this.responseText+"]"),("initializeRatingWidgets"===a||"presentRatingWidgetWithID"===a?ab(this.status,this.responseText,l):bb(this.status,this.responseText,l))?"function"===typeof g&&g(!1,c,this.responseText):(f(k.ERROR,a+" Failed Server XML HTTP request, ",this.status),"function"===typeof g&&g(!0,c)))};"GET"===r?d.send():d.send(n)}catch(B){f(k.ERROR,a+" Failed XML HTTP request",B),"function"===
typeof g&&g(!0,c)}}function bb(a,b,c){if(!(200<=a&&300>a))return f(k.ERROR,"Http response status code is not within the expected range: ",a),!1;try{var g=JSON.parse(b);return"[object Object]"!==Object.prototype.toString.call(g)?(f(k.ERROR,"Http response is not JSON Object"),!1):c?!0:!!g.result}catch(l){return f(k.ERROR,"Http response is in the wrong format.",l),!1}}function ab(a,b,c){if(!(200<=a&&300>a))return f(k.ERROR,"Http response status code is not within the expected range: ",a),!1;try{var g=
JSON.parse(b);return"[object Object]"===Object.prototype.toString.call(g)||Array.isArray(g)?c?!0:!!g.result:(f(k.ERROR,"Http response is not JSON Object nor JSON Array"),!1)}catch(l){return f(k.ERROR,"Http response is in the wrong format.",l),!1}}function cb(a){p("cly_token",a)}function p(a,b,c,g){function l(r,u,B){var L=new Date;L.setTime(L.getTime()+864E5*B);B="; expires="+L.toGMTString();document.cookie=r+"="+u+B+"; path=/"}function d(r){r+="=";for(var u=document.cookie.split(";"),B=0,L=u.length;B<
L;B++){for(var F=u[B];" "===F.charAt(0);)F=F.substring(1,F.length);if(0===F.indexOf(r))return F.substring(r.length,F.length)}return null}if("none"!==e.storage){g||(a=e.app_key+"/"+a,e.namespace&&(a=Ca(e.namespace)+"/"+a));c=c||"localstorage"===e.storage;var n;"undefined"!==typeof b&&null!==b&&(b=e.serialize(b),aa?localStorage.setItem(a,b):c||l(a,b,30));if("undefined"===typeof b)return aa?n=localStorage.getItem(a):c||(n=d(a)),e.deserialize(n);null===b&&(aa?localStorage.removeItem(a):c||l(a,"",-1))}}
function hb(){if(p(e.namespace+"cly_id",void 0,!1,!0)){p("cly_id",p(e.namespace+"cly_id",void 0,!1,!0));p("cly_event",p(e.namespace+"cly_event",void 0,!1,!0));p("cly_session",p(e.namespace+"cly_session",void 0,!1,!0));var a=p(e.namespace+"cly_queue",void 0,!1,!0);Array.isArray(a)&&(a=a.filter(function(b){return b.app_key===e.app_key}),p("cly_queue",a));p(e.namespace+"cly_cmp_id",void 0,!1,!0)&&(p("cly_cmp_id",p(e.namespace+"cly_cmp_id",void 0,!1,!0)),p("cly_cmp_uid",p(e.namespace+"cly_cmp_uid",void 0,
!1,!0)));p(e.namespace+"cly_ignore",void 0,!1,!0)&&p("cly_ignore",p(e.namespace+"cly_ignore",void 0,!1,!0));p("cly_id",null,!1,!0);p("cly_event",null,!1,!0);p("cly_session",null,!1,!0);p("cly_queue",null,!1,!0);p("cly_cmp_id",null,!1,!0);p("cly_cmp_uid",null,!1,!0);p("cly_ignore",null,!1,!0)}}var e=this,sa=!m.i,R=!1,Ya="/i",Ia="/o/sdk",$a=v("interval",h,500),Wa=v("queue_size",h,1E3),D=[],G=[],J={},ba=[],ca={},W=v("ignore_referrers",h,[]),Ja=null,ma=!0,Z,Ka=0,X=null,ja=0,ka=0,Ha=0,Za=v("fail_timeout",
h,60),La=v("inactivity_time",h,20),na=0,Xa=v("session_update",h,60),Ga=v("max_events",h,100),va=v("max_logs",h,null),la=v("use_session_cookie",h,!0),Fa=v("session_cookie_timeout",h,30),ta=!0,ra=!1,S=v("offline_mode",h,!1),T={},Y=!0,db=C(),aa=!0,ha=null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(a){aa=!1}for(var A={},Ma=0;Ma<m.features.length;Ma++)A[m.features[Ma]]={};this.initialize=function(){this.serialize=h.serialize||m.serialize;this.deserialize=
h.deserialize||m.deserialize;this.getViewName=h.getViewName||m.getViewName;this.getViewUrl=h.getViewUrl||m.getViewUrl;this.namespace=v("namespace",h,"");this.app_key=v("app_key",h,null);this.onload=v("onload",h,[]);this.utm=v("utm",h,{source:!0,medium:!0,campaign:!0,term:!0,content:!0});this.ignore_prefetch=v("ignore_prefetch",h,!0);this.debug=v("debug",h,!1);this.test_mode=v("test_mode",h,!1);this.tests=v("tests",h,!1);this.metrics=v("metrics",h,{});this.headers=v("headers",h,{});this.url=Ca(v("url",
h,""));this.app_version=v("app_version",h,"0.0");this.country_code=v("country_code",h,null);this.city=v("city",h,null);this.ip_address=v("ip_address",h,null);this.ignore_bots=v("ignore_bots",h,!0);this.force_post=v("force_post",h,!1);this.remote_config=v("remote_config",h,!1);this.ignore_visitor=v("ignore_visitor",h,!1);this.require_consent=v("require_consent",h,!1);this.track_domains=v("track_domains",h,!0);this.storage=v("storage",h,"default");this.enableOrientationTracking=v("enable_orientation_tracking",
h,!0);this.maxKeyLength=v("max_key_length",h,128);this.maxValueSize=v("max_value_size",h,256);this.maxSegmentationValues=v("max_segmentation_values",h,30);this.maxBreadcrumbCount=v("max_breadcrumb_count",h,null);this.maxStackTraceLinesPerThread=v("max_stack_trace_lines_per_thread",h,30);this.maxStackTraceLineLength=v("max_stack_trace_line_length",h,200);va&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=va,f(k.WARNING,"initialize, 'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):
va||this.maxBreadcrumbCount||(this.maxBreadcrumbCount=100);"cookie"===this.storage&&(aa=!1);Array.isArray(W)||(W=[]);""===this.url&&(f(k.ERROR,"initialize, Please provide server URL"),this.ignore_visitor=!0);p("cly_ignore")&&(this.ignore_visitor=!0);hb();S?this.device_id||(this.device_id="[CLY]_temp_id"):this.device_id=v("device_id",h,ea());D=p("cly_queue")||[];G=p("cly_event")||[];J=p("cly_remote_configs")||{};t();if(window.name&&0===window.name.indexOf("cly:"))try{this.passed_data=JSON.parse(window.name.replace("cly:",
""))}catch(n){f(k.ERROR,"initialize, Could not parse name",window.name)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{this.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(n){f(k.ERROR,"initialize, Could not parse hash",location.hash)}(this.passed_data&&this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&sa)&&this.passed_data.token&&this.passed_data.purpose&&(this.passed_data.token!==p("cly_old_token")&&(cb(this.passed_data.token),
p("cly_old_token",this.passed_data.token)),this.passed_data.url=this.passed_data.url||this.url,"heatmap"===this.passed_data.purpose&&(this.ignore_visitor=!0,Ta(),Sa(this.passed_data.url+"/views/heatmap.js",Ua)));if(!this.ignore_visitor){f(k.INFO,"initialize, Countly initialized");if(location.search){for(var a=location.search.substring(1).split("&"),b={},c=!1,g=0;g<a.length;g++){var l=a[g].split("=");"cly_id"===l[0]?p("cly_cmp_id",l[1]):"cly_uid"===l[0]?p("cly_cmp_uid",l[1]):"cly_device_id"===l[0]?
this.device_id=l[1]:0===(l[0]+"").indexOf("utm_")&&this.utm[l[0].replace("utm_","")]&&(b[l[0].replace("utm_","")]=l[1],c=!0)}if(c){for(var d in this.utm)b[d]?this.userData.set("utm_"+d,b[d]):this.userData.unset("utm_"+d);this.userData.save()}}S||this.device_id!==p("cly_id")&&p("cly_id",this.device_id);H();setTimeout(function(){V();e.remote_config&&e.fetch_remote_config(e.remote_config)},1)}document.documentElement.setAttribute("data-countly-useragent",navigator.userAgent)};this.halt=function(){f(k.WARNING,
"halt, Resetting Countly");m.i=void 0;sa=!m.i;R=!1;Ya="/i";Ia="/o/sdk";$a=500;Wa=1E3;D=[];G=[];J={};ba=[];ca={};W=[];Ja=null;ma=!0;Ka=0;X=null;Ha=ka=ja=0;Za=60;La=20;na=0;Xa=60;Ga=100;va=null;la=!0;Fa=30;ta=!0;S=ra=!1;T={};Y=!0;db=C();aa=!0;ha=null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(b){aa=!1}m.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm feedback remote-config".split(" ");A={};for(var a=
0;a<m.features.length;a++)A[m.features[a]]={};e.app_key=void 0;e.device_id=void 0;e.onload=void 0;e.utm=void 0;e.ignore_prefetch=void 0;e.debug=void 0;e.test_mode=void 0;e.tests=void 0;e.metrics=void 0;e.headers=void 0;e.url=void 0;e.app_version=void 0;e.country_code=void 0;e.city=void 0;e.ip_address=void 0;e.ignore_bots=void 0;e.force_post=void 0;e.remote_config=void 0;e.ignore_visitor=void 0;e.require_consent=void 0;e.track_domains=void 0;e.storage=void 0;e.enableOrientationTracking=void 0;e.maxKeyLength=
void 0;e.maxValueSize=void 0;e.maxSegmentationValues=void 0;e.maxBreadcrumbCount=void 0;e.maxStackTraceLinesPerThread=void 0;e.maxStackTraceLineLength=void 0};this.group_features=function(a){f(k.INFO,"group_features, Grouping features");if(a)for(var b in a)A[b]?f(k.WARNING,"group_features, Feature name ["+b+"] is already reserved"):"string"===typeof a[b]?A[b]={features:[a[b]]}:a[b]&&Array.isArray(a[b])&&a[b].length?A[b]={features:a[b]}:f(k.ERROR,"group_features, Incorrect feature list for ["+b+"] value: ["+
a[b]+"]");else f(k.ERROR,"group_features, Incorrect features:["+a+"]")};this.check_consent=function(a){f(k.INFO,"check_consent, Checking if consent is given for specific feature");if(!this.require_consent)return f(k.INFO,"check_consent, require_consent is off, no consent is necessary"),!0;if(A[a])return!(!A[a]||!A[a].optin);f(k.ERROR,"check_consent, No feature available for ["+a+"]");return!1};this.check_any_consent=function(){f(k.INFO,"check_any_consent, Checking if any consent is given");if(!this.require_consent)return f(k.INFO,
"check_any_consent, require_consent is off, no consent is necessary"),!0;for(var a in A)if(A[a]&&A[a].optin)return!0;f(k.INFO,"check_any_consent, No consents given");return!1};this.add_consent=function(a){f(k.INFO,"add_consent, Adding consent for ["+a+"]");if(Array.isArray(a))for(var b=0;b<a.length;b++)this.add_consent(a[b]);else A[a]?A[a].features?(A[a].optin=!0,this.add_consent(A[a].features)):!0!==A[a].optin&&(A[a].optin=!0,eb(),setTimeout(function(){"sessions"===a&&T.begin_session?(e.begin_session.apply(e,
T.begin_session),T.begin_session=null):"views"===a&&T.track_pageview&&(X=null,e.track_pageview.apply(e,T.track_pageview),T.track_pageview=null)},1)):f(k.ERROR,"add_consent, No feature available for ["+a+"]")};this.remove_consent=function(a){f(k.INFO,"remove_consent, Removing consent for ["+a+"]");this.remove_consent_internal(a,!0)};this.remove_consent_internal=function(a,b){b=b||!1;if(Array.isArray(a))for(var c=0;c<a.length;c++)this.remove_consent_internal(a[c],b);else A[a]?A[a].features?this.remove_consent_internal(A[a].features,
b):(A[a].optin=!1,b&&!1!==A[a].optin&&eb()):f(k.ERROR,"remove_consent, No feature available for ["+a+"]")};var wa,eb=function(){wa&&(clearTimeout(wa),wa=null);wa=setTimeout(function(){for(var a={},b=0;b<m.features.length;b++)a[m.features[b]]=!0===A[m.features[b]].optin?!0:!1;E({consent:JSON.stringify(a)});f(k.DEBUG,"Consent update request has been sent to the queue.")},1E3)};this.enable_offline_mode=function(){f(k.INFO,"enable_offline_mode, Enabling offline mode");this.remove_consent_internal(m.features,
!1);S=!0;this.device_id="[CLY]_temp_id"};this.disable_offline_mode=function(a){f(k.INFO,"disable_offline_mode, Disabling offline mode");S=!1;a&&this.device_id!==a?(this.device_id=a,p("cly_id",this.device_id),f(k.INFO,"disable_offline_mode, Changing id")):(this.device_id=ea(),this.device_id!==p("cly_id")&&p("cly_id",this.device_id));a=!1;if(0<D.length)for(var b=0;b<D.length;b++)"[CLY]_temp_id"===D[b].device_id&&(D[b].device_id=this.device_id,a=!0);a&&p("cly_queue",D,!0)};this.begin_session=function(a,
b){f(k.INFO,"begin_session, Starting the session");a&&f(k.INFO,"begin_session, Heartbeats are disabled");b&&f(k.INFO,"begin_session, Session starts irrespective of session cookie");if(this.check_consent("sessions")){if(!R){this.enableOrientationTracking&&(this.report_orientation(),x(window,"resize",function(){e.report_orientation()}));Z=C();R=!0;ma=!a;var c=p("cly_session");if(b||!la||!c||parseInt(c)<=C())f(k.INFO,"begin_session, Session started"),null===ha&&(ha=!0),c={begin_session:1},c.metrics=
JSON.stringify(ua()),E(c);p("cly_session",C()+60*Fa)}}else T.begin_session=arguments};this.session_duration=function(a){f(k.INFO,"session_duration, Reporting session duration");this.check_consent("sessions")&&R&&(f(k.INFO,"session_duration, Session extended",a),E({session_duration:a}),K())};this.end_session=function(a,b){f(k.INFO,"end_session, Ending the current session");this.check_consent("sessions")&&R&&(a=a||C()-Z,Q(),!la||b?(f(k.INFO,"end_session, Session ended"),E({end_session:1,session_duration:a})):
this.session_duration(a),R=!1)};this.change_id=function(a,b){f(k.INFO,"change_id, Changing the ID");b&&f(k.INFO,"change_id, Will merge the IDs");if(!a||"string"!==typeof a||0===a.length)f(k.INFO,"change_id, The provided ID: ["+a+"] is not a valid ID");else if(this.device_id!==a){b||(0<G.length&&(E({events:JSON.stringify(G)}),G=[],p("cly_event",G)),this.end_session(null,!0),ca={},this.remove_consent_internal(m.features,!1));var c=this.device_id;this.device_id=a;p("cly_id",this.device_id);f(k.INFO,
"change_id, Changing ID");b?E({old_device_id:c}):this.begin_session(!ma,!0);this.remote_config&&(J={},p("cly_remote_configs",J),this.fetch_remote_config(this.remote_config))}};this.add_event=function(a){f(k.INFO,"add_event, Adding ["+a+"] event");switch(a.key){case "[CLY]_nps":var b=this.check_consent("feedback");break;case "[CLY]_survey":b=this.check_consent("feedback");break;case "[CLY]_star_rating":b=this.check_consent("star-rating");break;case "[CLY]_view":b=this.check_consent("views");break;
case "[CLY]_orientation":b=this.check_consent("users");break;case "[CLY]_push_action":b=this.check_consent("push");break;case "[CLY]_action":b=this.check_consent("clicks")||this.check_consent("scroll");break;default:b=this.check_consent("events")}b&&q(a)};this.start_event=function(a){f(k.INFO,"start_event, Starting timed event with key: ["+a+"]");a=w(a,e.maxKeyLength,"start_event",f);ca[a]?f(k.WARNING,"start_event, Timed event with key ["+a+"] already started"):ca[a]=C()};this.end_event=function(a){f(k.INFO,
"end_event, Ending timed event");"string"===typeof a&&(a={key:a});a.key?ca[a.key]?(a.dur=C()-ca[a.key],this.add_event(a),delete ca[a.key]):f(k.ERROR,"end_event, Timed event with key ["+a.key+"] was not started"):f(k.ERROR,"end_event, Timed event must have a key property")};this.report_orientation=function(a){f(k.INFO,"report_orientation, Reporting orientation");this.check_consent("users")&&q({key:"[CLY]_orientation",segmentation:{mode:a||(window.innerWidth>window.innerHeight?"landscape":"portrait")}})};
this.report_conversion=function(a,b){f(k.WARNING,"report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!");this.recordDirectAttribution(a,b)};this.recordDirectAttribution=function(a,b){f(k.INFO,"recordDirectAttribution, Recording the attribution for campaign ID: ["+a+"] and the user ID: ["+b+"]");this.check_consent("attribution")&&(a=a||p("cly_cmp_id")||"cly_organic",b=b||p("cly_cmp_uid"),a&&b?E({campaign_id:a,campaign_user:b}):
a&&E({campaign_id:a}))};this.user_details=function(a){f(k.INFO,"user_details, Trying to add user details: ",a);this.check_consent("users")&&(a.name=w(a.name,e.maxValueSize,"user_details",f),a.username=w(a.username,e.maxValueSize,"user_details",f),a.email=w(a.email,e.maxValueSize,"user_details",f),a.organization=w(a.organization,e.maxValueSize,"user_details",f),a.phone=w(a.phone,e.maxValueSize,"user_details",f),a.picture=w(a.picture,4096,"user_details",f),a.gender=w(a.gender,e.maxValueSize,"user_details",
f),a.byear=w(a.byear,e.maxValueSize,"user_details",f),a.custom=P(a.custom,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"user_details",f),E({user_details:JSON.stringify(ia(a,"name username email organization phone picture gender byear custom".split(" ")))}))};var O={},U=function(a,b,c){e.check_consent("users")&&(O[a]||(O[a]={}),"$push"===c||"$pull"===c||"$addToSet"===c?(O[a][c]||(O[a][c]=[]),O[a][c].push(b)):O[a][c]=b)};this.userData={set:function(a,b){f(k.INFO,"set, Setting user's custom property value: ["+
b+"] under the key: ["+a+"]");a=w(a,e.maxKeyLength,"userData set",f);b=w(b,e.maxValueSize,"userData set",f);O[a]=b},unset:function(a){f(k.INFO,"unset, Resetting user's custom property with key: ["+a+"] ");O[a]=""},set_once:function(a,b){f(k.INFO,"set_once, Setting user's unique custom property value: ["+b+"] under the key: ["+a+"] ");a=w(a,e.maxKeyLength,"userData set_once",f);b=w(b,e.maxValueSize,"userData set_once",f);U(a,b,"$setOnce")},increment:function(a){f(k.INFO,"increment, Increasing user's custom property value under the key: ["+
a+"] by one");a=w(a,e.maxKeyLength,"userData increment",f);U(a,1,"$inc")},increment_by:function(a,b){f(k.INFO,"increment_by, Increasing user's custom property value under the key: ["+a+"] by: ["+b+"]");a=w(a,e.maxKeyLength,"userData increment_by",f);b=w(b,e.maxValueSize,"userData increment_by",f);U(a,b,"$inc")},multiply:function(a,b){f(k.INFO,"multiply, Multiplying user's custom property value under the key: ["+a+"] by: ["+b+"]");a=w(a,e.maxKeyLength,"userData multiply",f);b=w(b,e.maxValueSize,"userData multiply",
f);U(a,b,"$mul")},max:function(a,b){f(k.INFO,"max, Saving user's maximum custom property value compared to the value: ["+b+"] under the key: ["+a+"]");a=w(a,e.maxKeyLength,"userData max",f);b=w(b,e.maxValueSize,"userData max",f);U(a,b,"$max")},min:function(a,b){f(k.INFO,"min, Saving user's minimum custom property value compared to the value: ["+b+"] under the key: ["+a+"]");a=w(a,e.maxKeyLength,"userData min",f);b=w(b,e.maxValueSize,"userData min",f);U(a,b,"$min")},push:function(a,b){f(k.INFO,"push, Pushing a value: ["+
b+"] under the key: ["+a+"] to user's custom property array");a=w(a,e.maxKeyLength,"userData push",f);b=w(b,e.maxValueSize,"userData push",f);U(a,b,"$push")},push_unique:function(a,b){f(k.INFO,"push_unique, Pushing a unique value: ["+b+"] under the key: ["+a+"] to user's custom property array");a=w(a,e.maxKeyLength,"userData push_unique",f);b=w(b,e.maxValueSize,"userData push_unique",f);U(a,b,"$addToSet")},pull:function(a,b){f(k.INFO,"pull, Removing the value: ["+b+"] under the key: ["+a+"] from user's custom property array");
U(a,b,"$pull")},save:function(){f(k.INFO,"save, Saving changes to user's custom property");e.check_consent("users")&&E({user_details:JSON.stringify({custom:O})});O={}}};this.report_trace=function(a){f(k.INFO,"report_trace, Reporting performance trace");if(this.check_consent("apm")){for(var b="type name stz etz apm_metrics apm_attr".split(" "),c=0;c<b.length;c++)if("apm_attr"!==b[c]&&"undefined"===typeof a[b[c]]){f(k.ERROR,"report_trace, APM trace must have a",b[c]);return}a.name=w(a.name,e.maxKeyLength,
"report_trace",f);a.app_metrics=P(a.app_metrics,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"report_trace",f);b=ia(a,b);b.timestamp=a.stz;a=new Date;b.hour=a.getHours();b.dow=a.getDay();E({apm:JSON.stringify(b)});f(k.INFO,"report_trace, Successfully adding APM trace: ",b)}};this.track_errors=function(a){f(k.INFO,"track_errors, Started tracking errors");m.i[this.app_key].tracking_crashes=!0;window.cly_crashes||(window.cly_crashes=!0,Ja=a,window.onerror=function r(c,g,l,d,n){if(void 0!==n&&
null!==n)Ba(n,!1);else{d=d||window.event&&window.event.errorCharacter;n="";"undefined"!==typeof c&&(n+=c+"\n");"undefined"!==typeof g&&(n+="at "+g);"undefined"!==typeof l&&(n+=":"+l);"undefined"!==typeof d&&(n+=":"+d);n+="\n";try{c=[];for(var u=r.caller;u;)c.push(u.name),u=u.caller;n+=c.join("\n")}catch(B){}Ba(n,!1)}},window.addEventListener("unhandledrejection",function(c){Ba(Error("Unhandled rejection (reason: "+(c.reason&&c.reason.stack?c.reason.stack:c.reason)+")."),!0)}))};this.log_error=function(a,
b){f(k.INFO,"log_error, Logging errors");this.recordError(a,!0,b)};this.add_log=function(a){f(k.INFO,"add_log, Adding a new log of breadcrumbs: [ "+a+" ]");if(this.check_consent("crashes")){for(a=w(a,e.maxValueSize,"add_log",f);ba.length>=e.maxBreadcrumbCount;)ba.shift(),f(k.WARNING,"add_log, Reached maximum crashLogs size. Will erase the oldest one.");ba.push(a)}};this.fetch_remote_config=function(a,b,c){f(k.INFO,"fetch_remote_config, Fetching remote config");if(this.check_consent("remote-config")){var g=
{method:"fetch_remote_config"};this.check_consent("sessions")&&(g.metrics=JSON.stringify(ua()));a&&(c||"function"!==typeof a?Array.isArray(a)&&a.length&&(f(k.INFO,"fetch_remote_config, Keys to fetch: [ "+a+" ]"),g.keys=JSON.stringify(a)):(c=a,a=null));b&&((f(k.INFO,"fetch_remote_config, Keys to omit: [ "+b+" ]"),c||"function"!==typeof b)?Array.isArray(b)&&b.length&&(g.omit_keys=JSON.stringify(b)):(c=b,b=null));N(g);fa("fetch_remote_config",this.url+Ia,g,function(l,d,n){if(l)f(k.ERROR,"fetch_remote_config, Error occurred",
l);else{try{var r=JSON.parse(n);if(g.keys||g.omit_keys)for(var u in r)J[u]=r[u];else J=r;p("cly_remote_configs",J)}catch(B){}"function"===typeof c&&(f(k.INFO,"fetch_remote_config, Callback function is provided"),c(l,J))}},!0)}else f(k.ERROR,"fetch_remote_config, Remote config requires explicit consent"),"function"===typeof c&&c(Error("Remote config requires explicit consent"),J)};this.get_remote_config=function(a){f(k.INFO,"get_remote_config, Getting remote config");return"undefined"!==typeof a?J[a]:
J};this.stop_time=function(){f(k.INFO,"stop_time, Stopping tracking duration");Y&&(Y=!1,Ka=C()-Z,ka=C()-ja)};this.start_time=function(){f(k.INFO,"start_time, Starting tracking duration");Y||(Y=!0,Z=C()-Ka,ja=C()-ka,ka=0,K())};this.track_sessions=function(){function a(){document[c]||!document.hasFocus()?e.stop_time():e.start_time()}function b(){na>=La&&e.start_time();na=0}f(k.INFO,"track_session, Starting tracking user session");this.begin_session();this.start_time();x(window,"beforeunload",function(){e.end_session()});
var c="hidden";x(window,"focus",a);x(window,"blur",a);x(window,"pageshow",a);x(window,"pagehide",a);"onfocusin"in document&&(x(window,"focusin",a),x(window,"focusout",a));c in document?document.addEventListener("visibilitychange",a):"mozHidden"in document?(c="mozHidden",document.addEventListener("mozvisibilitychange",a)):"webkitHidden"in document?(c="webkitHidden",document.addEventListener("webkitvisibilitychange",a)):"msHidden"in document&&(c="msHidden",document.addEventListener("msvisibilitychange",
a));x(window,"mousemove",b);x(window,"click",b);x(window,"keydown",b);x(window,"scroll",b);setInterval(function(){na++;na>=La&&e.stop_time()},6E4)};this.track_pageview=function(a,b,c){f(k.INFO,"track_pageview, Starting to track page views");Q();a=w(a,e.maxKeyLength,"track_pageview",f);c=P(c,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"track_pageview",f);a&&Array.isArray(a)&&(b=a,a=null);a||(a=this.getViewName());if(void 0===a||""===a)f(k.ERROR,"track_pageview, No page name to track (it is either undefined or empty string). No page view can be tracked.");
else if(null===a)f(k.ERROR,"track_pageview, View name returned as null. Page view will be ignored.");else{if(b&&b.length)for(var g=0;g<b.length;g++)try{if((new RegExp(b[g])).test(a)){f(k.INFO,"track_pageview, Ignoring the page:",a);return}}catch(n){f(k.ERROR,"track_pageview, Problem with regex",b[g])}X=a;ja=C();g={name:a,visit:1,view:e.getViewUrl()};g=P(g,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"track_pageview",f);this.track_domains&&(g.domain=window.location.hostname);if(la)if(R)ha&&
(ha=!1,g.start=1);else{var l=p("cly_session");if(!l||parseInt(l)<=C())ha=!1,g.start=1}else"undefined"!==typeof document.referrer&&document.referrer.length&&(l=Va.exec(document.referrer))&&l[11]&&l[11]!==window.location.hostname&&(g.start=1);if(c)for(var d in c)"undefined"===typeof g[d]&&(g[d]=c[d]);this.check_consent("views")?q({key:"[CLY]_view",segmentation:g}):T.track_pageview=arguments}};this.track_view=function(a,b,c){f(k.INFO,"track_view, Initiating tracking page views");this.track_pageview(a,
b,c)};this.track_clicks=function(a){f(k.INFO,"track_clicks, Starting to track clicks");a&&f(k.INFO,"track_clicks, Tracking the specified children");a=a||document;var b=!0;x(a,"click",function(c){if(b){b=!1;Da(c);if("undefined"!==typeof c.pageX&&"undefined"!==typeof c.pageY){var g=pa(),l=Ea();e.check_consent("clicks")&&(c={type:"click",x:c.pageX,y:c.pageY,width:l,height:g,view:e.getViewUrl()},c=P(c,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"processClick",f),e.track_domains&&(c.domain=window.location.hostname),
q({key:"[CLY]_action",segmentation:c}))}setTimeout(function(){b=!0},1E3)}})};this.track_scrolls=function(a){f(k.INFO,"track_scrolls, Starting to track scrolls");a&&f(k.INFO,"track_scrolls, Tracking the specified children");a=a||window;var b=!0,c=0;x(a,"scroll",function(){c=Math.max(c,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)});x(a,"beforeunload",function(){if(b){b=!1;var g=pa(),l=Ea(),d=Qa();e.check_consent("scrolls")&&(g={type:"scroll",y:c+d,width:l,height:g,view:e.getViewUrl()},
g=P(g,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"processScrollView",f),e.track_domains&&(g.domain=window.location.hostname),q({key:"[CLY]_action",segmentation:g}))}})};this.track_links=function(a){f(k.INFO,"track_links, Starting to track clicks to links");a&&f(k.INFO,"track_links, Tracking the specified children");a=a||document;x(a,"click",function(b){a:{var c=xa(b);var g;for(g="A";c;){if(c.nodeName.toUpperCase()===g)break a;c=c.parentElement}c=void 0}c&&(Da(b),e.check_consent("clicks")&&
q({key:"linkClick",segmentation:{href:c.href,text:c.innerText,id:c.id,view:e.getViewUrl()}}))})};this.track_forms=function(a,b){function c(g){return g.name||g.id||g.type||g.nodeName}f(k.INFO,"track_forms, Starting to track form submissions. DOM object provided:["+!!a+"] Tracking hidden inputs :["+!!b+"]");a=a||document;x(a,"submit",function(g){g=xa(g);var l={id:g.attributes.id&&g.attributes.id.nodeValue,name:g.attributes.name&&g.attributes.name.nodeValue,action:g.attributes.action&&g.attributes.action.nodeValue,
method:g.attributes.method&&g.attributes.method.nodeValue,view:e.getViewUrl()},d;if("undefined"!==typeof g.elements){for(var n=0;n<g.elements.length;n++)(d=g.elements[n])&&"password"!==d.type&&-1===d.className.indexOf("cly_user_ignore")&&("undefined"===typeof l["input:"+c(d)]&&(l["input:"+c(d)]=[]),"select"===d.nodeName.toLowerCase()?"undefined"!==typeof d.multiple?l["input:"+c(d)].push(da(d)):l["input:"+c(d)].push(d.options[d.selectedIndex].value):"input"===d.nodeName.toLowerCase()?"undefined"!==
typeof d.type?"checkbox"===d.type.toLowerCase()||"radio"===d.type.toLowerCase()?d.checked&&l["input:"+c(d)].push(d.value):("hidden"!==d.type.toLowerCase()||b)&&l["input:"+c(d)].push(d.value):l["input:"+c(d)].push(d.value):"textarea"===d.nodeName.toLowerCase()?l["input:"+c(d)].push(d.value):"undefined"!==typeof d.value&&l["input:"+c(d)].push(d.value));for(var r in l)l[r]&&"function"===typeof l[r].join&&(l[r]=l[r].join(", "))}e.check_consent("forms")&&q({key:"formSubmit",segmentation:l})})};this.collect_from_forms=
function(a,b){f(k.INFO,"collect_from_forms, Starting to collect possible user data. DOM object provided:["+!!a+"] Submitting custom user property:["+!!b+"]");a=a||document;x(a,"submit",function(c){c=xa(c);var g={},l=!1,d;if("undefined"!==typeof c.elements){var n={},r=a.getElementsByTagName("LABEL"),u;for(u=0;u<r.length;u++)r[u].htmlFor&&""!==r[u].htmlFor&&(n[r[u].htmlFor]=r[u].innerText||r[u].textContent||r[u].innerHTML);for(u=0;u<c.elements.length;u++)if((d=c.elements[u])&&"password"!==d.type&&-1===
d.className.indexOf("cly_user_ignore"))if(r="","select"===d.nodeName.toLowerCase()?r="undefined"!==typeof d.multiple?da(d):d.options[d.selectedIndex].value:"input"===d.nodeName.toLowerCase()?"undefined"!==typeof d.type?"checkbox"===d.type.toLowerCase()||"radio"===d.type.toLowerCase()?d.checked&&(r=d.value):r=d.value:r=d.value:"textarea"===d.nodeName.toLowerCase()?r=d.value:"undefined"!==typeof d.value&&(r=d.value),d.className&&-1!==d.className.indexOf("cly_user_")){var B=d.className.split(" ");for(d=
0;d<B.length;d++)if(0===B[d].indexOf("cly_user_")){g[B[d].replace("cly_user_","")]=r;l=!0;break}}else if(d.type&&"email"===d.type.toLowerCase()||d.name&&-1!==d.name.toLowerCase().indexOf("email")||d.id&&-1!==d.id.toLowerCase().indexOf("email")||d.id&&n[d.id]&&-1!==n[d.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(r))g.email||(g.email=r),l=!0;else if(d.name&&-1!==d.name.toLowerCase().indexOf("username")||d.id&&-1!==d.id.toLowerCase().indexOf("username")||d.id&&n[d.id]&&-1!==n[d.id].toLowerCase().indexOf("username"))g.username||
(g.username=r),l=!0;else if(d.name&&(-1!==d.name.toLowerCase().indexOf("tel")||-1!==d.name.toLowerCase().indexOf("phone")||-1!==d.name.toLowerCase().indexOf("number"))||d.id&&(-1!==d.id.toLowerCase().indexOf("tel")||-1!==d.id.toLowerCase().indexOf("phone")||-1!==d.id.toLowerCase().indexOf("number"))||d.id&&n[d.id]&&(-1!==n[d.id].toLowerCase().indexOf("tel")||-1!==n[d.id].toLowerCase().indexOf("phone")||-1!==n[d.id].toLowerCase().indexOf("number")))g.phone||(g.phone=r),l=!0;else if(d.name&&(-1!==d.name.toLowerCase().indexOf("org")||
-1!==d.name.toLowerCase().indexOf("company"))||d.id&&(-1!==d.id.toLowerCase().indexOf("org")||-1!==d.id.toLowerCase().indexOf("company"))||d.id&&n[d.id]&&(-1!==n[d.id].toLowerCase().indexOf("org")||-1!==n[d.id].toLowerCase().indexOf("company")))g.organization||(g.organization=r),l=!0;else if(d.name&&-1!==d.name.toLowerCase().indexOf("name")||d.id&&-1!==d.id.toLowerCase().indexOf("name")||d.id&&n[d.id]&&-1!==n[d.id].toLowerCase().indexOf("name"))g.name||(g.name=""),g.name+=r+" ",l=!0}l&&(f(k.INFO,
"collect_from_forms, Gathered user data",g),b?e.user_details({custom:g}):e.user_details(g))})};this.collect_from_facebook=function(a){f(k.INFO,"collect_from_facebook, Starting to collect possible user data");FB&&FB.api&&FB.api("/me",function(b){var c={};b.name&&(c.name=b.name);b.email&&(c.email=b.email);"male"===b.gender?c.gender="M":"female"===b.gender&&(c.gender="F");if(b.birthday){var g=b.birthday.split("/").pop();g&&4===g.length&&(c.byear=g)}b.work&&b.work[0]&&b.work[0].employer&&b.work[0].employer.name&&
(c.organization=b.work[0].employer.name);if(a){c.custom={};for(var l in a){g=a[l].split(".");for(var d=b,n=0;n<g.length&&(d=d[g[n]],"undefined"!==typeof d);n++);"undefined"!==typeof d&&(c.custom[l]=d)}}e.user_details(c)})};this.opt_out=function(){f(k.INFO,"opt_out, Opting out the user");this.ignore_visitor=!0;p("cly_ignore",!0)};this.opt_in=function(){f(k.INFO,"opt_in, Opting in the user");p("cly_ignore",!1);this.ignore_visitor=!1;t();this.ignore_visitor||ra||V()};this.report_feedback=function(a){f(k.WARNING,
"report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' in place of this call. Call will be redirected now!");this.recordRatingWidgetWithID(a)};this.recordRatingWidgetWithID=function(a){f(k.INFO,"recordRatingWidgetWithID, Providing information about user with ID: [ "+a.widget_id+" ]");if(this.check_consent("star-rating"))if(a.widget_id)if(a.rating){var b={key:"[CLY]_star_rating",count:1,segmentation:{}};b.segmentation=ia(a,"widget_id contactMe platform app_version rating email comment".split(" "));
b.segmentation.app_version||(b.segmentation.app_version=this.metrics._app_version||this.app_version);f(k.INFO,"recordRatingWidgetWithID, Reporting Rating Widget: ",b);q(b)}else f(k.ERROR,"recordRatingWidgetWithID, Rating Widget must contain rating property");else f(k.ERROR,"recordRatingWidgetWithID, Rating Widget must contain widget_id property")};this.show_feedback_popup=function(a){f(k.WARNING,"show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!");
this.presentRatingWidgetWithID(a)};this.presentRatingWidgetWithID=function(a){f(k.INFO,"presentRatingWidgetWithID, Showing rating widget popup for the widget with ID: [ "+a+" ]");this.check_consent("star-rating")&&(S?f(k.ERROR,"presentRatingWidgetWithID, Cannot show ratingWidget popup in offline mode"):fa("presentRatingWidgetWithID",this.url+"/o/feedback/widget",{widget_id:a},function(b,c,g){if(b)f(k.ERROR,"presentRatingWidgetWithID, Error occurred",b);else try{var l=JSON.parse(g);z(l,!1)}catch(d){f(k.ERROR,
"presentRatingWidgetWithID, JSON parse failed: "+d)}},!0))};this.initialize_feedback_popups=function(a){f(k.WARNING,"initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!");this.initializeRatingWidgets(a)};this.initializeRatingWidgets=function(a){f(k.INFO,"initializeRatingWidgets, Initializing rating widget with provided widget IDs:[ "+a+"]");if(this.check_consent("star-rating")){a||(a=p("cly_fb_widgets"));for(var b=
document.getElementsByClassName("countly-feedback-sticker");0<b.length;)b[0].remove();fa("initializeRatingWidgets",this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a)},function(c,g,l){if(c)f(k.ERROR,"initializeRatingWidgets, Errors occurred:",c);else try{var d=JSON.parse(l);for(c=0;c<d.length;c++)if("true"===d[c].is_active&&d[c].target_devices[fb.device])if("string"===typeof d[c].hide_sticker&&(d[c].hide_sticker="true"===d[c].hide_sticker),"all"!==d[c].target_page||d[c].hide_sticker){var n=
d[c].target_pages;for(g=0;g<n.length;g++){var r=n[g].substr(0,n[g].length-1)===window.location.pathname.substr(0,n[g].length-1),u=n[g]===window.location.pathname;(n[g].includes("*")&&r||u)&&!d[c].hide_sticker&&z(d[c],!0)}}else z(d[c],!0)}catch(B){f(k.ERROR,"initializeRatingWidgets, JSON parse error: "+B)}},!0)}};this.enable_feedback=function(a){f(k.WARNING,"enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!");this.enableRatingWidgets(a)};
this.enableRatingWidgets=function(a){f(k.INFO,"enableRatingWidgets, Enabling rating widget with params:",a);this.check_consent("star-rating")&&(S?f(k.ERROR,"enableRatingWidgets, Cannot enable rating widgets in offline mode"):(p("cly_fb_widgets",a.popups||a.widgets),qa(this.url+"/star-rating/stylesheets/countly-feedback-web.css"),a=a.popups||a.widgets,0<a.length?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),this.initializeRatingWidgets(a)):f(k.ERROR,"enableRatingWidgets, You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")))};
this.get_available_feedback_widgets=function(a){f(k.INFO,"get_available_feedback_widgets, Initializing feedbacks, callback function is provided:["+!!a+"]");this.check_consent("feedback")?S?f(k.ERROR,"get_available_feedback_widgets, Cannot enable feedback in offline mode."):fa("get_available_feedback_widgets",this.url+Ia,{method:"feedback",device_id:this.device_id,app_key:this.app_key},function(b,c,g){if(b)f(k.ERROR,"get_available_feedback_widgets, Error occurred while fetching feedbacks",b),a&&a(null,
b);else try{var l=JSON.parse(g).result||[];a&&a(l,null)}catch(d){f(k.ERROR,"get_available_feedback_widgets, Error while processing feedbacks",d),a&&a(null,d)}}):a&&a(null,Error("Consent for feedback not provided."))};this.present_feedback_widget=function(a,b,c){function g(y){document.getElementById("countly-surveys-wrapper-"+y._id).style.display="block";document.getElementById("csbg").style.display="block"}function l(y){if(!y.appearance.hideS){var M=document.createElement("div");M.innerText=y.appearance.text;
M.style.color=7>y.appearance.text_color?"#"+y.appearance.text_color:y.appearance.text_color;M.style.backgroundColor=7>y.appearance.bg_color.length?"#"+y.appearance.bg_color:y.appearance.bg_color;M.className="countly-feedback-sticker  "+y.appearance.position+"-"+y.appearance.size;M.id="countly-feedback-sticker-"+y._id;document.body.appendChild(M);x(document.getElementById("countly-feedback-sticker-"+y._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+y._id).style.display="flex";
document.getElementById("csbg").style.display="block"})}x(document.getElementById("countly-feedback-close-icon-"+y._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+y._id).style.display="none";document.getElementById("csbg").style.display="none"})}f(k.INFO,"present_feedback_widget, Presenting the feedback widget by appending to the element with ID: [ "+b+" ] and className: [ "+c+" ]");if(this.check_consent("feedback"))if(!a||"object"!==typeof a||Array.isArray(a))f(k.ERROR,
"present_feedback_widget, Please provide at least one feedback widget object.");else try{var d=this.url;if("nps"===a.type)d+="/feedback/nps";else if("survey"===a.type)d+="/feedback/survey";else if("rating"===a.type)d+="/feedback/rating";else{f(k.ERROR,"present_feedback_widget, Feedback widget only accepts nps, rating and survey types.");return}var n=window.origin||window.location.origin;if("rating"===a.type){var r="ratings";qa(this.url+"/star-rating/stylesheets/countly-feedback-web.css")}else qa(this.url+
"/surveys/stylesheets/countly-surveys.css"),r="surveys";d+="?widget_id="+a._id;d+="&app_key="+this.app_key;d+="&device_id="+this.device_id;d+="&sdk_name=javascript_native_web";d+="&platform="+this.platform;d+="&app_version="+this.app_version;d+="&sdk_version=21.11.4";d+="&origin="+n;d+="&widget_v=web";var u=document.createElement("iframe");u.src=d;u.name="countly-"+r+"-iframe";u.id="countly-"+r+"-iframe";var B=!1;u.onload=function(){B&&(document.getElementById("countly-"+r+"-wrapper-"+a._id).style.display=
"none",document.getElementById("csbg").style.display="none");B=!0};for(var L=document.getElementById("csbg");L;)L.remove(),L=document.getElementById("csbg");var F=document.getElementsByClassName("countly-"+r+"-wrapper");for(d=0;d<F.length;d++)F[d].remove();F=document.createElement("div");F.className="countly-"+r+"-wrapper";F.id="countly-"+r+"-wrapper-"+a._id;"survey"===a.type&&(F.className=F.className+" "+a.appearance.position);var ya=document.body;d=!1;b&&(document.getElementById(b)?(ya=document.getElementById(b),
d=!0):f(k.ERROR,"present_feedback_widget, Provided ID not found."));d||c&&(document.getElementsByClassName(c)[0]?ya=document.getElementsByClassName(c)[0]:f(k.ERROR,"present_feedback_widget, Provided class not found."));ya.insertAdjacentHTML("beforeend",'<div id="csbg"></div>');ya.appendChild(F);if("rating"===a.type){var Na=document.createElement("div");Na.className="countly-ratings-overlay";Na.id="countly-ratings-overlay-"+a._id;F.appendChild(Na);x(document.getElementById("countly-ratings-overlay-"+
a._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+a._id).style.display="none"})}F.appendChild(u);x(window,"message",function(y){var M={};try{M=JSON.parse(y.data)}catch(ib){f(k.ERROR,"present_feedback_widget, Error while parsing message body "+ib)}M.close&&(document.getElementById("countly-"+r+"-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none")});if("survey"===a.type){var I=!1;switch(a.showPolicy){case "afterPageLoad":"complete"===
document.readyState?I||(I=!0,g(a)):x(document,"readystatechange",function(y){"complete"!==y.target.readyState||I||(I=!0,g(a))});break;case "afterConstantDelay":setTimeout(function(){I||(I=!0,g(a))},1E4);break;case "onAbandon":"complete"===document.readyState?x(document,"mouseleave",function(){I||(I=!0,g(a))}):x(document,"readystatechange",function(y){"complete"===y.target.readyState&&x(document,"mouseleave",function(){I||(I=!0,g(a))})});break;case "onScrollHalfwayDown":x(window,"scroll",function(){if(!I){var y=
Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),M=pa();y>=M/2&&(I=!0,g(a))}});break;default:I||(I=!0,g(a))}}else if("nps"===a.type)document.getElementById("countly-"+r+"-wrapper-"+a._id).style.display="block",document.getElementById("csbg").style.display="block";else if("rating"===a.type){var za=!1;"complete"===document.readyState?za||(za=!0,l(a)):x(document,"readystatechange",function(y){"complete"!==y.target.readyState||za||(za=!0,l(a))})}}catch(y){f(k.ERROR,
"present_feedback_widget, Somethings went wrong while presenting the feedback",y)}};this.recordError=function(a,b,c){f(k.INFO,"recordError, Recording error");if(this.check_consent("crashes")&&a){c=c||Ja;var g="";"object"===typeof a?"undefined"!==typeof a.stack?g=a.stack:("undefined"!==typeof a.name&&(g+=a.name+":"),"undefined"!==typeof a.message&&(g+=a.message+"\n"),"undefined"!==typeof a.fileName&&(g+="in "+a.fileName+"\n"),"undefined"!==typeof a.lineNumber&&(g+="on "+a.lineNumber),"undefined"!==
typeof a.columnNumber&&(g+=":"+a.columnNumber)):g=a+"";c=P(c,e.maxKeyLength,e.maxValueSize,e.maxSegmentationValues,"record_error",f);if(g.length>e.maxStackTraceLineLength*e.maxStackTraceLinesPerThread){f(k.DEBUG,"record_error, Error stack is too long will be truncated");g=g.split("\n");g.length>e.maxStackTraceLinesPerThread&&(g=g.splice(0,e.maxStackTraceLinesPerThread));a=0;for(var l=g.length;a<l;a++)g[a].length>e.maxStackTraceLineLength&&(g[a]=g[a].substring(0,e.maxStackTraceLineLength));g=g.join("\n")}b=
!!b;a=ua();g={_resolution:a._resolution,_error:g,_app_version:a._app_version,_run:C()-db,_not_os_specific:!0,_javascript:!0};if(a=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)g._bat=Math.floor(100*a.level);"undefined"!==typeof navigator.onLine&&(g._online=!!navigator.onLine);g._background=!document.hasFocus();0<ba.length&&(g._logs=ba.join("\n"));ba=[];g._nonfatal=b;g._view=this.getViewName();"undefined"!==typeof c&&(g._custom=c);try{var d=document.createElement("canvas").getContext("experimental-webgl");
g._opengl=d.getParameter(d.VERSION)}catch(n){}E({crash:JSON.stringify(g)})}};this.onStorageChange=function(a,b){f(k.INFO,"onStorageChange, Applying storage changes");switch(a){case "cly_queue":D=e.deserialize(b||"[]");break;case "cly_event":G=e.deserialize(b||"[]");break;case "cly_remote_configs":J=e.deserialize(b||"{}");break;case "cly_ignore":e.ignore_visitor=e.deserialize(b);break;case "cly_id":e.device_id=e.deserialize(b)}};this._internals={store:p,getDocWidth:Ea,getDocHeight:pa,getViewportHeight:Qa,
get_page_coord:Da,get_event_target:xa,add_event:x,getProperties:ia,truncateObject:P,truncateSingleValue:w,stripTrailingSlash:Ca,prepareParams:Pa,sendXmlHttpRequest:fa,isResponseValid:bb,getMsTimestamp:Aa,getTimestamp:C,isResponseValidBroad:ab,log:f,getMetrics:ua,generateUUID:Oa,isUUID:function(){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(e.device_id)},getId:ea,heartBeat:V,toRequestQueue:E,reportViewDuration:Q,loadJS:Sa,loadCSS:qa,getLastView:function(){return X},
setToken:cb,getToken:function(){var a=p("cly_token");p("cly_token",null);return a},showLoader:Ta,hideLoader:Ua,add_cly_events:q,detect_device:fb,getRequestQueue:function(){return D},getEventQueue:function(){return G},clearQueue:function(){D=[];p("cly_queue",[]);G=[];p("cly_event",[])}};this.initialize()};m.init=function(h){h=h||{};var q=h.app_key||m.app_key;if(!m.i||!m.i[q]){h=new m.CountlyClass(h);if(!m.i){m.i={};for(var t in h)m[t]=h[t]}m.i[q]=h}return m.i[q]};var oa=0,x=function(h,q,t){"undefined"!==
typeof h.addEventListener?h.addEventListener(q,t,!1):h.attachEvent("on"+q,t)},xa=function(h){return h?"undefined"!==typeof h.target?h.target:h.srcElement:window.event.srcElement},fb=function(){var h=navigator.userAgent.toLowerCase(),q=function(t){t&&(h=(t+"").toLowerCase());t=/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/;var z="desktop";/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(h)?
z="tablet":t.test(h)&&(z="phone");return z};return{device:q(),detect:q,isMobile:"desktop"!==q()?!0:!1,userAgent:h}}();window.addEventListener("storage",function(h){var q=(h.key+"").split("/"),t=q.pop();q=q.pop();if(m.i&&m.i[q])m.i[q].onStorageChange(t,h.newValue)});m.serialize=function(h){"object"===typeof h&&(h=JSON.stringify(h));return h};m.deserialize=function(h){try{h=JSON.parse(h)}catch(q){}return h};m.getViewName=function(){return window.location.pathname};m.getViewUrl=function(){return window.location.pathname};
return m}});
