(function(n,da){"function"===typeof define&&define.amd?define([],function(){return da(n.Countly)}):"object"===typeof module&&module.exports?module.exports=da(n.Countly):n.Countly=da(n.Countly)})("undefined"!==typeof window?window:this,function(n){function da(h){var q=[];if("undefined"!==typeof h.options)for(var t=0;t<h.options.length;t++)h.options[t].selected&&q.push(h.options[t].value);return q.join(", ")}function Oa(){var h=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(q){var t=(h+16*Math.random())%16|0;h=Math.floor(h/16);return("x"===q?t:t&3|8).toString(16)})}function C(){return Math.floor((new Date).getTime()/1E3)}function Aa(){var h=(new Date).getTime();oa>=h?oa++:oa=h;return oa}function v(h,q,t){if(q&&Object.keys(q).length){if("undefined"!==typeof q[h])return q[h]}else if("undefined"!==typeof n[h])return n[h];return t}function Ba(h,q,t){for(var z in n.i)n.i[z].tracking_crashes&&n.i[z].recordError(h,q,t)}function Pa(h){var q=[],t;for(t in h)q.push(t+
"="+encodeURIComponent(h[t]));return q.join("&")}function Ca(h){return"/"===h.substr(h.length-1)?h.substr(0,h.length-1):h}function ia(h,q){for(var t={},z,H=0;H<q.length;H++)z=q[H],"undefined"!==typeof h[z]&&(t[z]=h[z]);return t}function P(h,q,t,z,H,Q){var L={};if(h){if(Object.keys(h).length>z){var N={},E=0,V;for(V in h)E<z&&(N[V]=h[V],E++);h=N}for(var ea in h)z=w(ea,q,H,Q),N=w(h[ea],t,H,Q),L[z]=N}return L}function w(h,q,t,z){var H=h;"number"===typeof h&&(h=h.toString());"string"===typeof h&&h.length>
q&&(H=h.substring(0,q),z(g.DEBUG,t+", Key: [ "+h+" ] is longer than accepted length. It will be truncated."));return H}function Da(h){"undefined"===typeof h.pageY&&"number"===typeof h.clientX&&document.documentElement&&(h.pageX=h.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,h.pageY=h.clientY+document.body.scrollTop+document.documentElement.scrollTop);return h}function pa(){var h=document;return Math.max(Math.max(h.body.scrollHeight,h.documentElement.scrollHeight),Math.max(h.body.offsetHeight,
h.documentElement.offsetHeight),Math.max(h.body.clientHeight,h.documentElement.clientHeight))}function Ea(){var h=document;return Math.max(Math.max(h.body.scrollWidth,h.documentElement.scrollWidth),Math.max(h.body.offsetWidth,h.documentElement.offsetWidth),Math.max(h.body.clientWidth,h.documentElement.clientWidth))}function Qa(){var h=document;return Math.min(Math.min(h.body.clientHeight,h.documentElement.clientHeight),Math.min(h.body.offsetHeight,h.documentElement.offsetHeight),window.innerHeight)}
function Ra(h,q,t,z,H,Q){var L=document.createElement(h),N;L.setAttribute(q,t);L.setAttribute(z,H);Q&&(L.onreadystatechange=function(){L.onload=function(){N||Q();N=!0}});document.getElementsByTagName("head")[0].appendChild(L)}function Sa(h,q){Ra("script","type","text/javascript","src",h,q)}function qa(h,q){Ra("link","rel","stylesheet","href",h,q)}function Ta(){var h=document.getElementById("cly-loader");if(!h){var q=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");
t.type="text/css";t.styleSheet?t.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
t.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
q.appendChild(t);h=document.createElement("div");h.setAttribute("id","cly-loader");document.body.onload=function(){if(n.showLoaderProtection)console.warn("Loader is already on");else try{document.body.appendChild(h)}catch(z){console.error("Body is not loaded for loader to append: "+z)}}}h.style.display="block"}function Ua(){n.showLoaderProtection=!0;var h=document.getElementById("cly-loader");h&&(h.style.display="none")}if("undefined"===typeof window)console.error("Not running in browser");else{n=
n||{};n.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm feedback remote-config".split(" ");n.utm={source:!0,medium:!0,campaign:!0,term:!0,content:!0};var g={ERROR:"[ERROR] ",WARNING:"[WARNING] ",INFO:"[INFO] ",DEBUG:"[DEBUG] ",VERBOSE:"[VERBOSE] "};n.q=n.q||[];n.onload=n.onload||[];var Va=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?::([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?::([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
gb=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/;
n.CountlyClass=function(h){function q(a){if(f.ignore_visitor)d(g.ERROR,"Adding event failed. Ignoring bots");else if(a.key){a.count||(a.count=1);a.key=w(a.key,f.maxKeyLength,"add_cly_event",d);a.segmentation=P(a.segmentation,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"add_cly_event",d);var b=ia(a,["key","count","sum","dur","segmentation"]);b.timestamp=Aa();var c=new Date;b.hour=c.getHours();b.dow=c.getDay();G.push(b);p("cly_event",G);d(g.INFO,"Successfully adding event: ",a)}else d(g.ERROR,
"Adding event failed. Event must have a key property")}function t(){f.ignore_prefetch&&"undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState&&(f.ignore_visitor=!0);f.ignore_bots&&gb.test(navigator.userAgent)&&(f.ignore_visitor=!0)}function z(a,b){if(document.getElementById("countly-feedback-sticker-"+a._id))d(g.ERROR,"Widget with same ID exists");else try{var c=document.createElement("div");c.className="countly-iframe-wrapper";c.id="countly-iframe-wrapper-"+a._id;var k=
document.createElement("span");k.className="countly-feedback-close-icon";k.id="countly-feedback-close-icon-"+a._id;k.innerText="x";var l=document.createElement("iframe");l.name="countly-feedback-iframe";l.id="countly-feedback-iframe";l.src=f.url+"/feedback?widget_id="+a._id+"&app_key="+f.app_key+"&device_id="+f.device_id+"&sdk_version=21.11.4";document.body.appendChild(c);c.appendChild(k);c.appendChild(l);x(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+
a._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(b){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.id="feedback-sticker-svg";e.setAttribute("aria-hidden","true");e.setAttribute("data-prefix","far");e.setAttribute("data-icon","grin");e.setAttribute("class","svg-inline--fa fa-grin fa-w-16");e.setAttribute("role","img");e.setAttribute("xmlns","http://www.w3.org/2000/svg");e.setAttribute("viewBox","0 0 496 512");var m=document.createElementNS("http://www.w3.org/2000/svg",
"path");m.id="smileyPathInStickerSvg";m.setAttribute("fill","white");m.setAttribute("d","M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z");
var r=document.createElement("span");r.innerText=a.trigger_button_text;var u=document.createElement("div");u.style.color=7>a.trigger_font_color.length?"#"+a.trigger_font_color:a.trigger_font_color;u.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;u.className="countly-feedback-sticker  "+a.trigger_position+"-"+a.trigger_size;u.id="countly-feedback-sticker-"+a._id;e.appendChild(m);u.appendChild(e);u.appendChild(r);document.body.appendChild(u);var A=document.getElementById("smileyPathInStickerSvg");
A&&(A.style.fill=7>a.trigger_font_color.length?"#"+a.trigger_font_color:a.trigger_font_color);x(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display="block"}catch(M){d(g.ERROR,"Somethings went wrong while element injecting process: "+
M)}}function H(){var a;if("undefined"!==typeof f.onload&&0<f.onload.length){for(a=0;a<f.onload.length;a++)if("function"===typeof f.onload[a])f.onload[a](f);f.onload=[]}}function Q(){if(X){var a={name:X};f.check_consent("views")&&q({key:"[CLY]_view",dur:Y?C()-ja:ka,segmentation:a});X=null}}function L(){if(la){var a=p("cly_session");if(!a||parseInt(a)<=C())R=!1,f.begin_session(!ma);p("cly_session",C()+60*Fa)}}function N(a){a.app_key=f.app_key;a.device_id=f.device_id;a.sdk_name="javascript_native_web";
a.sdk_version="21.11.4";f.check_consent("location")?(f.country_code&&(a.country_code=f.country_code),f.city&&(a.city=f.city),null!==f.ip_address&&(a.ip_address=f.ip_address)):a.location="";a.timestamp=Aa();var b=new Date;a.hour=b.getHours();a.dow=b.getDay()}function E(a){f.ignore_visitor?d(g.WARNING,"User is opt_out will ignore the request: "+a):f.app_key&&f.device_id?(N(a),D.length>Wa&&D.shift(),D.push(a),p("cly_queue",D,!0)):d(g.ERROR,"app_key or device_id is missing ",f.app_key,f.device_id)}function V(){H();
if(f.test_mode||f.ignore_visitor)ra=!1,d(g.WARNING,"User opt_out, no heartbeat");else{ra=!0;var a=0;if(sa&&"undefined"!==typeof n.q&&0<n.q.length){var b=n.q;n.q=[];for(a=0;a<b.length;a++){var c=b[a];d(g.DEBUG,"Processing queued call",c);if("function"===typeof c)c();else if(Array.isArray(c)&&0<c.length){var k=f,l=0;n.i[c[l]]&&(k=n.i[c[l]],l++);if("function"===typeof k[c[l]])k[c[l]].apply(k,c.slice(l+1));else if(0===c[l].indexOf("userData.")){var e=c[l].replace("userData.","");"function"===typeof k.userData[e]&&
k.userData[e].apply(k,c.slice(l+1))}else"function"===typeof n[c[l]]&&n[c[l]].apply(n,c.slice(l+1))}}}R&&ma&&Y&&(a=C(),a-Z>Xa&&(f.session_duration(a-Z),Z=a));0<G.length&&(G.length<=Ga?(E({events:JSON.stringify(G)}),G=[]):(a=G.splice(0,Ga),E({events:JSON.stringify(a)})),p("cly_event",G));!S&&0<D.length&&ta&&C()>Ha&&(ta=!1,a=D[0],d(g.DEBUG,"Processing request",a),p("cly_queue",D,!0),f.tests||fa("send_request_queue",f.url+Ya,a,function(m,r){d(g.DEBUG,"Request Finished",r,m);m?(Ha=C()+Za,d(g.ERROR,"Request error: ",
m)):D.shift();p("cly_queue",D,!0);ta=!0},!1));setTimeout(V,$a)}}function ea(){return p("cly_id")||Oa()}function ua(){var a=JSON.parse(JSON.stringify(f.metrics||{}));a._app_version=a._app_version||f.app_version;a._ua=a._ua||navigator.userAgent;if(screen.width){var b=screen.width?parseInt(screen.width):0,c=screen.height?parseInt(screen.height):0;if(0!==b&&0!==c){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)b=Math.round(b*window.devicePixelRatio),c=Math.round(c*
window.devicePixelRatio);else if(90===Math.abs(window.orientation)){var k=b;b=c;c=k}a._resolution=a._resolution||""+b+"x"+c}}window.devicePixelRatio&&(a._density=a._density||window.devicePixelRatio);b=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof b&&(a._locale=a._locale||b);if("undefined"!==typeof document.referrer&&document.referrer.length&&(b=Va.exec(document.referrer))&&b[11]&&b[11]!==window.location.hostname){b=!1;if(W&&W.length)for(c=
0;c<W.length;c++)try{if((new RegExp(W[c])).test(document.referrer)){d(g.DEBUG,"Ignored:",document.referrer);b=!0;break}}catch(l){d(g.ERROR,"Problem with regex: "+W[c],", error: "+l)}b||(a._store=a._store||document.referrer)}d(g.DEBUG,"Got metrics",a);return a}function d(a,b){if(f.debug&&"undefined"!==typeof console){arguments[2]&&"object"===typeof arguments[2]&&(arguments[2]=JSON.stringify(arguments[2]));sa||(b="["+f.app_key+"] "+b);a||(a=g.DEBUG);for(var c="",k=2;k<arguments.length;k++)c+=arguments[k];
c=a+b+c;a===g.ERROR?console.error(c):a===g.WARNING?console.warn(c):a===g.INFO?console.info(c):a===g.VERBOSE?console.log(c):console.debug(c)}}function fa(a,b,c,k,l){l=l||!1;try{d(g.DEBUG,"Sending XML HTTP request");var e=null;window.XMLHttpRequest?e=new window.XMLHttpRequest:window.ActiveXObject&&(e=new window.ActiveXObject("Microsoft.XMLHTTP"));c=c||{};var m=Pa(c),r="GET";if(f.force_post||2E3<=m.length)r="POST";"GET"===r?e.open("GET",b+"?"+m,!0):(e.open("POST",b,!0),e.setRequestHeader("Content-type",
"application/x-www-form-urlencoded"));for(var u in f.headers)e.setRequestHeader(u,f.headers[u]);e.onreadystatechange=function(){4===this.readyState&&(d(g.DEBUG,a+" HTTP request completed ["+this.status+"]["+this.responseText+"]"),(l?ab(this.status,this.responseText,l):bb(this.status,this.responseText,l))?"function"===typeof k&&k(!1,c,this.responseText):(d(g.ERROR,a+" Failed Server XML HTTP request, ",this.status),"function"===typeof k&&k(!0,c)))};"GET"===r?e.send():e.send(m)}catch(A){d(g.ERROR,a+
" Failed XML HTTP request"+A),"function"===typeof k&&k(!0,c)}}function bb(a,b){if(!(200<=a&&300>a))return d(g.ERROR,"Http response status code is not within the expected range: ",a),!1;try{var c=JSON.parse(b);return"[object Object]"!==Object.prototype.toString.call(c)?(d(g.ERROR,"Http response is not JSON Object"),!1):!0}catch(k){return d(g.ERROR,"Http response is in the wrong format: "+k),!1}}function ab(a,b){if(!(200<=a&&300>a))return d(g.ERROR,"Http response status code is not within the expected range: ",
a),!1;try{var c=JSON.parse(b);return"[object Object]"===Object.prototype.toString.call(c)||Array.isArray(c)?!0:(d(g.ERROR,"Http response is not JSON Object nor JSON Array"),!1)}catch(k){return d(g.ERROR,"Http response is in the wrong format"+k),!1}}function cb(a){p("cly_token",a)}function p(a,b,c,k){function l(r,u,A){var M=new Date;M.setTime(M.getTime()+864E5*A);A="; expires="+M.toGMTString();document.cookie=r+"="+u+A+"; path=/"}function e(r){r+="=";for(var u=document.cookie.split(";"),A=0,M=u.length;A<
M;A++){for(var F=u[A];" "===F.charAt(0);)F=F.substring(1,F.length);if(0===F.indexOf(r))return F.substring(r.length,F.length)}return null}if("none"===f.storage)d(g.WARNING,"Storage is disabled. Value with key: "+a+" won't be stored or retrieved");else{k||(a=f.app_key+"/"+a,f.namespace&&(a=Ca(f.namespace)+"/"+a));c=c||"localstorage"===f.storage;"undefined"!==typeof b&&null!==b&&(b=f.serialize(b),aa?localStorage.setItem(a,b):c||l(a,b,30));if("undefined"===typeof b){if(aa){console.info("Checking local storage for the key: "+
a);var m=localStorage.getItem(a)}else c||(console.info("Checking cookies for the key: "+a),m=e(a));return f.deserialize(m)}null===b&&(aa?localStorage.removeItem(a):c||l(a,"",-1))}}function hb(){if(p(f.namespace+"cly_id",void 0,!1,!0)){p("cly_id",p(f.namespace+"cly_id",void 0,!1,!0));p("cly_event",p(f.namespace+"cly_event",void 0,!1,!0));p("cly_session",p(f.namespace+"cly_session",void 0,!1,!0));var a=p(f.namespace+"cly_queue",void 0,!1,!0);Array.isArray(a)&&(a=a.filter(function(b){return b.app_key===
f.app_key}),p("cly_queue",a));p(f.namespace+"cly_cmp_id",void 0,!1,!0)&&(p("cly_cmp_id",p(f.namespace+"cly_cmp_id",void 0,!1,!0)),p("cly_cmp_uid",p(f.namespace+"cly_cmp_uid",void 0,!1,!0)));p(f.namespace+"cly_ignore",void 0,!1,!0)&&p("cly_ignore",p(f.namespace+"cly_ignore",void 0,!1,!0));p("cly_id",null,!1,!0);p("cly_event",null,!1,!0);p("cly_session",null,!1,!0);p("cly_queue",null,!1,!0);p("cly_cmp_id",null,!1,!0);p("cly_cmp_uid",null,!1,!0);p("cly_ignore",null,!1,!0)}}var f=this,sa=!n.i,R=!1,Ya=
"/i",Ia="/o/sdk",$a=v("interval",h,500),Wa=v("queue_size",h,1E3),D=[],G=[],J={},ba=[],ca={},W=v("ignore_referrers",h,[]),Ja=null,ma=!0,Z,Ka=0,X=null,ja=0,ka=0,Ha=0,Za=v("fail_timeout",h,60),La=v("inactivity_time",h,20),na=0,Xa=v("session_update",h,60),Ga=v("max_events",h,100),va=v("max_logs",h,null),la=v("use_session_cookie",h,!0),Fa=v("session_cookie_timeout",h,30),ta=!0,ra=!1,S=v("offline_mode",h,!1),T={},Y=!0,db=C(),aa=!0,ha=null;try{localStorage.setItem("cly_testLocal",!0),localStorage.removeItem("cly_testLocal")}catch(a){d(g.ERROR,
"Local storage test failed, Halting local storage support: "+a),aa=!1}for(var B={},Ma=0;Ma<n.features.length;Ma++)B[n.features[Ma]]={};this.initialize=function(){this.serialize=h.serialize||n.serialize;this.deserialize=h.deserialize||n.deserialize;this.getViewName=h.getViewName||n.getViewName;this.getViewUrl=h.getViewUrl||n.getViewUrl;this.namespace=v("namespace",h,"");this.app_key=v("app_key",h,null);this.onload=v("onload",h,[]);this.utm=v("utm",h,{source:!0,medium:!0,campaign:!0,term:!0,content:!0});
this.ignore_prefetch=v("ignore_prefetch",h,!0);this.debug=v("debug",h,!1);this.test_mode=v("test_mode",h,!1);this.tests=v("tests",h,!1);this.metrics=v("metrics",h,{});this.headers=v("headers",h,{});this.url=Ca(v("url",h,""));this.app_version=v("app_version",h,"0.0");this.country_code=v("country_code",h,null);this.city=v("city",h,null);this.ip_address=v("ip_address",h,null);this.ignore_bots=v("ignore_bots",h,!0);this.force_post=v("force_post",h,!1);this.remote_config=v("remote_config",h,!1);this.ignore_visitor=
v("ignore_visitor",h,!1);this.require_consent=v("require_consent",h,!1);this.track_domains=v("track_domains",h,!0);this.storage=v("storage",h,"default");this.enableOrientationTracking=v("enable_orientation_tracking",h,!0);this.maxKeyLength=v("max_key_length",h,128);this.maxValueSize=v("max_value_size",h,256);this.maxSegmentationValues=v("max_segmentation_values",h,30);this.maxBreadcrumbCount=v("max_breadcrumb_count",h,null);this.maxStackTraceLinesPerThread=v("max_stack_trace_lines_per_thread",h,30);
this.maxStackTraceLineLength=v("max_stack_trace_line_length",h,200);va&&!this.maxBreadcrumbCount?(this.maxBreadcrumbCount=va,d(g.WARNING,"initialize, 'maxCrashLogs' is deprecated. Use 'maxBreadcrumbCount' instead!")):va||this.maxBreadcrumbCount||(this.maxBreadcrumbCount=100);"cookie"===this.storage&&(aa=!1);Array.isArray(W)||(W=[]);""===this.url&&(d(g.ERROR,"initialize, Please provide server URL"),this.ignore_visitor=!0);p("cly_ignore")&&(this.ignore_visitor=!0);hb();S?this.device_id||(this.device_id=
"[CLY]_temp_id"):this.device_id=v("device_id",h,ea());D=p("cly_queue")||[];G=p("cly_event")||[];J=p("cly_remote_configs")||{};t();if(window.name&&0===window.name.indexOf("cly:"))try{this.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(m){d(g.ERROR,"initialize, Could not parse name: "+m,window.name)}else if(location.hash&&0===location.hash.indexOf("#cly:"))try{this.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(m){d(g.ERROR,"initialize, Could not parse hash: "+m,location.hash)}(this.passed_data&&
this.passed_data.app_key&&this.passed_data.app_key===this.app_key||this.passed_data&&!this.passed_data.app_key&&sa)&&this.passed_data.token&&this.passed_data.purpose&&(this.passed_data.token!==p("cly_old_token")&&(cb(this.passed_data.token),p("cly_old_token",this.passed_data.token)),this.passed_data.url=this.passed_data.url||this.url,"heatmap"===this.passed_data.purpose&&(this.ignore_visitor=!0,Ta(),Sa(this.passed_data.url+"/views/heatmap.js",Ua)));if(!this.ignore_visitor){d(g.INFO,"initialize, Countly initialized");
if(location.search){for(var a=location.search.substring(1).split("&"),b={},c=!1,k=0;k<a.length;k++){var l=a[k].split("=");"cly_id"===l[0]?p("cly_cmp_id",l[1]):"cly_uid"===l[0]?p("cly_cmp_uid",l[1]):"cly_device_id"===l[0]?this.device_id=l[1]:0===(l[0]+"").indexOf("utm_")&&this.utm[l[0].replace("utm_","")]&&(b[l[0].replace("utm_","")]=l[1],c=!0)}if(c){for(var e in this.utm)b[e]?this.userData.set("utm_"+e,b[e]):this.userData.unset("utm_"+e);this.userData.save()}}S||this.device_id!==p("cly_id")&&p("cly_id",
this.device_id);H();setTimeout(function(){V();f.remote_config&&f.fetch_remote_config(f.remote_config)},1)}document.documentElement.setAttribute("data-countly-useragent",navigator.userAgent)};this.halt=function(){d(g.WARNING,"halt, Resetting Countly");n.i=void 0;sa=!n.i;R=!1;Ya="/i";Ia="/o/sdk";$a=500;Wa=1E3;D=[];G=[];J={};ba=[];ca={};W=[];Ja=null;ma=!0;Ka=0;X=null;Ha=ka=ja=0;Za=60;La=20;na=0;Xa=60;Ga=100;va=null;la=!0;Fa=30;ta=!0;S=ra=!1;T={};Y=!0;db=C();aa=!0;ha=null;try{localStorage.setItem("cly_testLocal",
!0),localStorage.removeItem("cly_testLocal")}catch(b){aa=!1}n.features="sessions events views scrolls clicks forms crashes attribution users star-rating location apm feedback remote-config".split(" ");B={};for(var a=0;a<n.features.length;a++)B[n.features[a]]={};f.app_key=void 0;f.device_id=void 0;f.onload=void 0;f.utm=void 0;f.ignore_prefetch=void 0;f.debug=void 0;f.test_mode=void 0;f.tests=void 0;f.metrics=void 0;f.headers=void 0;f.url=void 0;f.app_version=void 0;f.country_code=void 0;f.city=void 0;
f.ip_address=void 0;f.ignore_bots=void 0;f.force_post=void 0;f.remote_config=void 0;f.ignore_visitor=void 0;f.require_consent=void 0;f.track_domains=void 0;f.storage=void 0;f.enableOrientationTracking=void 0;f.maxKeyLength=void 0;f.maxValueSize=void 0;f.maxSegmentationValues=void 0;f.maxBreadcrumbCount=void 0;f.maxStackTraceLinesPerThread=void 0;f.maxStackTraceLineLength=void 0};this.group_features=function(a){d(g.INFO,"group_features, Grouping features");if(a)for(var b in a)B[b]?d(g.WARNING,"group_features, Feature name ["+
b+"] is already reserved"):"string"===typeof a[b]?B[b]={features:[a[b]]}:a[b]&&Array.isArray(a[b])&&a[b].length?B[b]={features:a[b]}:d(g.ERROR,"group_features, Incorrect feature list for ["+b+"] value: ["+a[b]+"]");else d(g.ERROR,"group_features, Incorrect features:["+a+"]")};this.check_consent=function(a){d(g.INFO,"check_consent, Checking if consent is given for specific feature");if(!this.require_consent)return d(g.INFO,"check_consent, require_consent is off, no consent is necessary"),!0;if(B[a])return!(!B[a]||
!B[a].optin);d(g.ERROR,"check_consent, No feature available for ["+a+"]");return!1};this.check_any_consent=function(){d(g.INFO,"check_any_consent, Checking if any consent is given");if(!this.require_consent)return d(g.INFO,"check_any_consent, require_consent is off, no consent is necessary"),!0;for(var a in B)if(B[a]&&B[a].optin)return!0;d(g.INFO,"check_any_consent, No consents given");return!1};this.add_consent=function(a){d(g.INFO,"add_consent, Adding consent for ["+a+"]");if(Array.isArray(a))for(var b=
0;b<a.length;b++)this.add_consent(a[b]);else B[a]?B[a].features?(B[a].optin=!0,this.add_consent(B[a].features)):!0!==B[a].optin&&(B[a].optin=!0,eb(),setTimeout(function(){"sessions"===a&&T.begin_session?(f.begin_session.apply(f,T.begin_session),T.begin_session=null):"views"===a&&T.track_pageview&&(X=null,f.track_pageview.apply(f,T.track_pageview),T.track_pageview=null)},1)):d(g.ERROR,"add_consent, No feature available for ["+a+"]")};this.remove_consent=function(a){d(g.INFO,"remove_consent, Removing consent for ["+
a+"]");this.remove_consent_internal(a,!0)};this.remove_consent_internal=function(a,b){b=b||!1;if(Array.isArray(a))for(var c=0;c<a.length;c++)this.remove_consent_internal(a[c],b);else B[a]?B[a].features?this.remove_consent_internal(B[a].features,b):(B[a].optin=!1,b&&!1!==B[a].optin&&eb()):d(g.ERROR,"remove_consent, No feature available for ["+a+"]")};var wa,eb=function(){wa&&(clearTimeout(wa),wa=null);wa=setTimeout(function(){for(var a={},b=0;b<n.features.length;b++)a[n.features[b]]=!0===B[n.features[b]].optin?
!0:!1;E({consent:JSON.stringify(a)});d(g.DEBUG,"Consent update request has been sent to the queue.")},1E3)};this.enable_offline_mode=function(){d(g.INFO,"enable_offline_mode, Enabling offline mode");this.remove_consent_internal(n.features,!1);S=!0;this.device_id="[CLY]_temp_id"};this.disable_offline_mode=function(a){d(g.INFO,"disable_offline_mode, Disabling offline mode");S=!1;a&&this.device_id!==a?(this.device_id=a,p("cly_id",this.device_id),d(g.INFO,"disable_offline_mode, Changing id")):(this.device_id=
ea(),this.device_id!==p("cly_id")&&p("cly_id",this.device_id));a=!1;if(0<D.length)for(var b=0;b<D.length;b++)"[CLY]_temp_id"===D[b].device_id&&(D[b].device_id=this.device_id,a=!0);a&&p("cly_queue",D,!0)};this.begin_session=function(a,b){d(g.INFO,"begin_session, Starting the session");a&&d(g.INFO,"begin_session, Heartbeats are disabled");b&&d(g.INFO,"begin_session, Session starts irrespective of session cookie");if(this.check_consent("sessions")){if(!R){this.enableOrientationTracking&&(this.report_orientation(),
x(window,"resize",function(){f.report_orientation()}));Z=C();R=!0;ma=!a;var c=p("cly_session");if(b||!la||!c||parseInt(c)<=C())d(g.INFO,"begin_session, Session started"),null===ha&&(ha=!0),c={begin_session:1},c.metrics=JSON.stringify(ua()),E(c);p("cly_session",C()+60*Fa)}}else T.begin_session=arguments};this.session_duration=function(a){d(g.INFO,"session_duration, Reporting session duration");this.check_consent("sessions")&&R&&(d(g.INFO,"session_duration, Session extended",a),E({session_duration:a}),
L())};this.end_session=function(a,b){d(g.INFO,"end_session, Ending the current session");this.check_consent("sessions")&&R&&(a=a||C()-Z,Q(),!la||b?(d(g.INFO,"end_session, Session ended"),E({end_session:1,session_duration:a})):this.session_duration(a),R=!1)};this.change_id=function(a,b){d(g.INFO,"change_id, Changing the ID");b&&d(g.INFO,"change_id, Will merge the IDs");if(!a||"string"!==typeof a||0===a.length)d(g.ERROR,"change_id, The provided ID: ["+a+"] is not a valid ID");else if(this.device_id!==
a){b||(0<G.length&&(E({events:JSON.stringify(G)}),G=[],p("cly_event",G)),this.end_session(null,!0),ca={},this.remove_consent_internal(n.features,!1));var c=this.device_id;this.device_id=a;p("cly_id",this.device_id);d(g.INFO,"change_id, Changing ID");b?E({old_device_id:c}):this.begin_session(!ma,!0);this.remote_config&&(J={},p("cly_remote_configs",J),this.fetch_remote_config(this.remote_config))}};this.add_event=function(a){d(g.INFO,"add_event, Adding ["+a+"] event");switch(a.key){case "[CLY]_nps":var b=
this.check_consent("feedback");break;case "[CLY]_survey":b=this.check_consent("feedback");break;case "[CLY]_star_rating":b=this.check_consent("star-rating");break;case "[CLY]_view":b=this.check_consent("views");break;case "[CLY]_orientation":b=this.check_consent("users");break;case "[CLY]_push_action":b=this.check_consent("push");break;case "[CLY]_action":b=this.check_consent("clicks")||this.check_consent("scroll");break;default:b=this.check_consent("events")}b&&q(a)};this.start_event=function(a){d(g.INFO,
"start_event, Starting timed event with key: ["+a+"]");a=w(a,f.maxKeyLength,"start_event",d);ca[a]?d(g.WARNING,"start_event, Timed event with key ["+a+"] already started"):ca[a]=C()};this.end_event=function(a){d(g.INFO,"end_event, Ending timed event");"string"===typeof a&&(a={key:a});a.key?ca[a.key]?(a.dur=C()-ca[a.key],this.add_event(a),delete ca[a.key]):d(g.ERROR,"end_event, Timed event with key ["+a.key+"] was not started"):d(g.ERROR,"end_event, Timed event must have a key property")};this.report_orientation=
function(a){d(g.INFO,"report_orientation, Reporting orientation");this.check_consent("users")&&q({key:"[CLY]_orientation",segmentation:{mode:a||(window.innerWidth>window.innerHeight?"landscape":"portrait")}})};this.report_conversion=function(a,b){d(g.WARNING,"report_conversion, Deprecated function call! Use 'recordDirectAttribution' in place of this call. Call will be redirected now!");this.recordDirectAttribution(a,b)};this.recordDirectAttribution=function(a,b){d(g.INFO,"recordDirectAttribution, Recording the attribution for campaign ID: ["+
a+"] and the user ID: ["+b+"]");this.check_consent("attribution")&&(a=a||p("cly_cmp_id")||"cly_organic",b=b||p("cly_cmp_uid"),a&&b?E({campaign_id:a,campaign_user:b}):a&&E({campaign_id:a}))};this.user_details=function(a){d(g.INFO,"user_details, Trying to add user details: ",a);this.check_consent("users")&&(a.name=w(a.name,f.maxValueSize,"user_details",d),a.username=w(a.username,f.maxValueSize,"user_details",d),a.email=w(a.email,f.maxValueSize,"user_details",d),a.organization=w(a.organization,f.maxValueSize,
"user_details",d),a.phone=w(a.phone,f.maxValueSize,"user_details",d),a.picture=w(a.picture,4096,"user_details",d),a.gender=w(a.gender,f.maxValueSize,"user_details",d),a.byear=w(a.byear,f.maxValueSize,"user_details",d),a.custom=P(a.custom,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"user_details",d),E({user_details:JSON.stringify(ia(a,"name username email organization phone picture gender byear custom".split(" ")))}))};var O={},U=function(a,b,c){f.check_consent("users")&&(O[a]||(O[a]={}),
"$push"===c||"$pull"===c||"$addToSet"===c?(O[a][c]||(O[a][c]=[]),O[a][c].push(b)):O[a][c]=b)};this.userData={set:function(a,b){d(g.INFO,"set, Setting user's custom property value: ["+b+"] under the key: ["+a+"]");a=w(a,f.maxKeyLength,"userData set",d);b=w(b,f.maxValueSize,"userData set",d);O[a]=b},unset:function(a){d(g.INFO,"unset, Resetting user's custom property with key: ["+a+"] ");O[a]=""},set_once:function(a,b){d(g.INFO,"set_once, Setting user's unique custom property value: ["+b+"] under the key: ["+
a+"] ");a=w(a,f.maxKeyLength,"userData set_once",d);b=w(b,f.maxValueSize,"userData set_once",d);U(a,b,"$setOnce")},increment:function(a){d(g.INFO,"increment, Increasing user's custom property value under the key: ["+a+"] by one");a=w(a,f.maxKeyLength,"userData increment",d);U(a,1,"$inc")},increment_by:function(a,b){d(g.INFO,"increment_by, Increasing user's custom property value under the key: ["+a+"] by: ["+b+"]");a=w(a,f.maxKeyLength,"userData increment_by",d);b=w(b,f.maxValueSize,"userData increment_by",
d);U(a,b,"$inc")},multiply:function(a,b){d(g.INFO,"multiply, Multiplying user's custom property value under the key: ["+a+"] by: ["+b+"]");a=w(a,f.maxKeyLength,"userData multiply",d);b=w(b,f.maxValueSize,"userData multiply",d);U(a,b,"$mul")},max:function(a,b){d(g.INFO,"max, Saving user's maximum custom property value compared to the value: ["+b+"] under the key: ["+a+"]");a=w(a,f.maxKeyLength,"userData max",d);b=w(b,f.maxValueSize,"userData max",d);U(a,b,"$max")},min:function(a,b){d(g.INFO,"min, Saving user's minimum custom property value compared to the value: ["+
b+"] under the key: ["+a+"]");a=w(a,f.maxKeyLength,"userData min",d);b=w(b,f.maxValueSize,"userData min",d);U(a,b,"$min")},push:function(a,b){d(g.INFO,"push, Pushing a value: ["+b+"] under the key: ["+a+"] to user's custom property array");a=w(a,f.maxKeyLength,"userData push",d);b=w(b,f.maxValueSize,"userData push",d);U(a,b,"$push")},push_unique:function(a,b){d(g.INFO,"push_unique, Pushing a unique value: ["+b+"] under the key: ["+a+"] to user's custom property array");a=w(a,f.maxKeyLength,"userData push_unique",
d);b=w(b,f.maxValueSize,"userData push_unique",d);U(a,b,"$addToSet")},pull:function(a,b){d(g.INFO,"pull, Removing the value: ["+b+"] under the key: ["+a+"] from user's custom property array");U(a,b,"$pull")},save:function(){d(g.INFO,"save, Saving changes to user's custom property");f.check_consent("users")&&E({user_details:JSON.stringify({custom:O})});O={}}};this.report_trace=function(a){d(g.INFO,"report_trace, Reporting performance trace");if(this.check_consent("apm")){for(var b="type name stz etz apm_metrics apm_attr".split(" "),
c=0;c<b.length;c++)if("apm_attr"!==b[c]&&"undefined"===typeof a[b[c]]){d(g.WARNING,"report_trace, APM trace don't have the property: "+b[c]);return}a.name=w(a.name,f.maxKeyLength,"report_trace",d);a.app_metrics=P(a.app_metrics,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"report_trace",d);b=ia(a,b);b.timestamp=a.stz;a=new Date;b.hour=a.getHours();b.dow=a.getDay();E({apm:JSON.stringify(b)});d(g.INFO,"report_trace, Successfully adding APM trace: ",b)}};this.track_errors=function(a){d(g.INFO,
"track_errors, Started tracking errors");n.i[this.app_key].tracking_crashes=!0;window.cly_crashes||(window.cly_crashes=!0,Ja=a,window.onerror=function r(c,k,l,e,m){if(void 0!==m&&null!==m)Ba(m,!1);else{e=e||window.event&&window.event.errorCharacter;m="";"undefined"!==typeof c&&(m+=c+"\n");"undefined"!==typeof k&&(m+="at "+k);"undefined"!==typeof l&&(m+=":"+l);"undefined"!==typeof e&&(m+=":"+e);m+="\n";try{c=[];for(var u=r.caller;u;)c.push(u.name),u=u.caller;m+=c.join("\n")}catch(A){d(g.ERROR,"Call stack generation experienced a problem: "+
A)}Ba(m,!1)}},window.addEventListener("unhandledrejection",function(c){Ba(Error("Unhandled rejection (reason: "+(c.reason&&c.reason.stack?c.reason.stack:c.reason)+")."),!0)}))};this.log_error=function(a,b){d(g.INFO,"log_error, Logging errors");this.recordError(a,!0,b)};this.add_log=function(a){d(g.INFO,"add_log, Adding a new log of breadcrumbs: [ "+a+" ]");if(this.check_consent("crashes")){for(a=w(a,f.maxValueSize,"add_log",d);ba.length>=f.maxBreadcrumbCount;)ba.shift(),d(g.WARNING,"add_log, Reached maximum crashLogs size. Will erase the oldest one.");
ba.push(a)}};this.fetch_remote_config=function(a,b,c){d(g.INFO,"fetch_remote_config, Fetching remote config");if(this.check_consent("remote-config")){var k={method:"fetch_remote_config"};this.check_consent("sessions")&&(k.metrics=JSON.stringify(ua()));a&&(c||"function"!==typeof a?Array.isArray(a)&&a.length&&(d(g.INFO,"fetch_remote_config, Keys to fetch: [ "+a+" ]"),k.keys=JSON.stringify(a)):(c=a,a=null));b&&((d(g.INFO,"fetch_remote_config, Keys to omit: [ "+b+" ]"),c||"function"!==typeof b)?Array.isArray(b)&&
b.length&&(k.omit_keys=JSON.stringify(b)):(c=b,b=null));N(k);fa("fetch_remote_config",this.url+Ia,k,function(l,e,m){if(l)d(g.ERROR,"fetch_remote_config, Error occurred: "+l);else{try{var r=JSON.parse(m);if(k.keys||k.omit_keys)for(var u in r)J[u]=r[u];else J=r;p("cly_remote_configs",J)}catch(A){d(g.ERROR,"fetch_remote_config, Had an issue while parsing the response: "+A)}"function"===typeof c&&(d(g.INFO,"fetch_remote_config, Callback function is provided"),c(l,J))}},!0)}else d(g.ERROR,"fetch_remote_config, Remote config requires explicit consent"),
"function"===typeof c&&c(Error("Remote config requires explicit consent"),J)};this.get_remote_config=function(a){d(g.INFO,"get_remote_config, Getting remote config");return"undefined"!==typeof a?J[a]:J};this.stop_time=function(){d(g.INFO,"stop_time, Stopping tracking duration");Y&&(Y=!1,Ka=C()-Z,ka=C()-ja)};this.start_time=function(){d(g.INFO,"start_time, Starting tracking duration");Y||(Y=!0,Z=C()-Ka,ja=C()-ka,ka=0,L())};this.track_sessions=function(){function a(){document[c]||!document.hasFocus()?
f.stop_time():f.start_time()}function b(){na>=La&&f.start_time();na=0}d(g.INFO,"track_session, Starting tracking user session");this.begin_session();this.start_time();x(window,"beforeunload",function(){f.end_session()});var c="hidden";x(window,"focus",a);x(window,"blur",a);x(window,"pageshow",a);x(window,"pagehide",a);"onfocusin"in document&&(x(window,"focusin",a),x(window,"focusout",a));c in document?document.addEventListener("visibilitychange",a):"mozHidden"in document?(c="mozHidden",document.addEventListener("mozvisibilitychange",
a)):"webkitHidden"in document?(c="webkitHidden",document.addEventListener("webkitvisibilitychange",a)):"msHidden"in document&&(c="msHidden",document.addEventListener("msvisibilitychange",a));x(window,"mousemove",b);x(window,"click",b);x(window,"keydown",b);x(window,"scroll",b);setInterval(function(){na++;na>=La&&f.stop_time()},6E4)};this.track_pageview=function(a,b,c){d(g.INFO,"track_pageview, Starting to track page views");Q();a=w(a,f.maxKeyLength,"track_pageview",d);c=P(c,f.maxKeyLength,f.maxValueSize,
f.maxSegmentationValues,"track_pageview",d);a&&Array.isArray(a)&&(b=a,a=null);a||(a=this.getViewName());if(void 0===a||""===a)d(g.ERROR,"track_pageview, No page name to track (it is either undefined or empty string). No page view can be tracked.");else if(null===a)d(g.ERROR,"track_pageview, View name returned as null. Page view will be ignored.");else{if(b&&b.length)for(var k=0;k<b.length;k++)try{if((new RegExp(b[k])).test(a)){d(g.INFO,"track_pageview, Ignoring the page: "+a);return}}catch(m){d(g.ERROR,
"track_pageview, Problem with regex: "+b[k]+", error: "+m)}X=a;ja=C();k={name:a,visit:1,view:f.getViewUrl()};k=P(k,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"track_pageview",d);this.track_domains&&(k.domain=window.location.hostname);if(la)if(R)ha&&(ha=!1,k.start=1);else{var l=p("cly_session");if(!l||parseInt(l)<=C())ha=!1,k.start=1}else"undefined"!==typeof document.referrer&&document.referrer.length&&(l=Va.exec(document.referrer))&&l[11]&&l[11]!==window.location.hostname&&(k.start=1);
if(c)for(var e in c)"undefined"===typeof k[e]&&(k[e]=c[e]);this.check_consent("views")?q({key:"[CLY]_view",segmentation:k}):T.track_pageview=arguments}};this.track_view=function(a,b,c){d(g.INFO,"track_view, Initiating tracking page views");this.track_pageview(a,b,c)};this.track_clicks=function(a){d(g.INFO,"track_clicks, Starting to track clicks");a&&d(g.INFO,"track_clicks, Tracking the specified children");a=a||document;var b=!0;x(a,"click",function(c){if(b){b=!1;Da(c);if("undefined"!==typeof c.pageX&&
"undefined"!==typeof c.pageY){var k=pa(),l=Ea();f.check_consent("clicks")&&(c={type:"click",x:c.pageX,y:c.pageY,width:l,height:k,view:f.getViewUrl()},c=P(c,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"processClick",d),f.track_domains&&(c.domain=window.location.hostname),q({key:"[CLY]_action",segmentation:c}))}setTimeout(function(){b=!0},1E3)}})};this.track_scrolls=function(a){d(g.INFO,"track_scrolls, Starting to track scrolls");a&&d(g.INFO,"track_scrolls, Tracking the specified children");
a=a||window;var b=!0,c=0;x(a,"scroll",function(){c=Math.max(c,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)});x(a,"beforeunload",function(){if(b){b=!1;var k=pa(),l=Ea(),e=Qa();f.check_consent("scrolls")&&(k={type:"scroll",y:c+e,width:l,height:k,view:f.getViewUrl()},k=P(k,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"processScrollView",d),f.track_domains&&(k.domain=window.location.hostname),q({key:"[CLY]_action",segmentation:k}))}})};this.track_links=function(a){d(g.INFO,
"track_links, Starting to track clicks to links");a&&d(g.INFO,"track_links, Tracking the specified children");a=a||document;x(a,"click",function(b){a:{var c=xa(b);var k;for(k="A";c;){if(c.nodeName.toUpperCase()===k)break a;c=c.parentElement}c=void 0}c&&(Da(b),f.check_consent("clicks")&&q({key:"linkClick",segmentation:{href:c.href,text:c.innerText,id:c.id,view:f.getViewUrl()}}))})};this.track_forms=function(a,b){function c(k){return k.name||k.id||k.type||k.nodeName}d(g.INFO,"track_forms, Starting to track form submissions. DOM object provided:["+
!!a+"] Tracking hidden inputs :["+!!b+"]");a=a||document;x(a,"submit",function(k){k=xa(k);var l={id:k.attributes.id&&k.attributes.id.nodeValue,name:k.attributes.name&&k.attributes.name.nodeValue,action:k.attributes.action&&k.attributes.action.nodeValue,method:k.attributes.method&&k.attributes.method.nodeValue,view:f.getViewUrl()},e;if("undefined"!==typeof k.elements){for(var m=0;m<k.elements.length;m++)(e=k.elements[m])&&"password"!==e.type&&-1===e.className.indexOf("cly_user_ignore")&&("undefined"===
typeof l["input:"+c(e)]&&(l["input:"+c(e)]=[]),"select"===e.nodeName.toLowerCase()?"undefined"!==typeof e.multiple?l["input:"+c(e)].push(da(e)):l["input:"+c(e)].push(e.options[e.selectedIndex].value):"input"===e.nodeName.toLowerCase()?"undefined"!==typeof e.type?"checkbox"===e.type.toLowerCase()||"radio"===e.type.toLowerCase()?e.checked&&l["input:"+c(e)].push(e.value):("hidden"!==e.type.toLowerCase()||b)&&l["input:"+c(e)].push(e.value):l["input:"+c(e)].push(e.value):"textarea"===e.nodeName.toLowerCase()?
l["input:"+c(e)].push(e.value):"undefined"!==typeof e.value&&l["input:"+c(e)].push(e.value));for(var r in l)l[r]&&"function"===typeof l[r].join&&(l[r]=l[r].join(", "))}f.check_consent("forms")&&q({key:"formSubmit",segmentation:l})})};this.collect_from_forms=function(a,b){d(g.INFO,"collect_from_forms, Starting to collect possible user data. DOM object provided:["+!!a+"] Submitting custom user property:["+!!b+"]");a=a||document;x(a,"submit",function(c){c=xa(c);var k={},l=!1,e;if("undefined"!==typeof c.elements){var m=
{},r=a.getElementsByTagName("LABEL"),u;for(u=0;u<r.length;u++)r[u].htmlFor&&""!==r[u].htmlFor&&(m[r[u].htmlFor]=r[u].innerText||r[u].textContent||r[u].innerHTML);for(u=0;u<c.elements.length;u++)if((e=c.elements[u])&&"password"!==e.type&&-1===e.className.indexOf("cly_user_ignore"))if(r="","select"===e.nodeName.toLowerCase()?r="undefined"!==typeof e.multiple?da(e):e.options[e.selectedIndex].value:"input"===e.nodeName.toLowerCase()?"undefined"!==typeof e.type?"checkbox"===e.type.toLowerCase()||"radio"===
e.type.toLowerCase()?e.checked&&(r=e.value):r=e.value:r=e.value:"textarea"===e.nodeName.toLowerCase()?r=e.value:"undefined"!==typeof e.value&&(r=e.value),e.className&&-1!==e.className.indexOf("cly_user_")){var A=e.className.split(" ");for(e=0;e<A.length;e++)if(0===A[e].indexOf("cly_user_")){k[A[e].replace("cly_user_","")]=r;l=!0;break}}else if(e.type&&"email"===e.type.toLowerCase()||e.name&&-1!==e.name.toLowerCase().indexOf("email")||e.id&&-1!==e.id.toLowerCase().indexOf("email")||e.id&&m[e.id]&&
-1!==m[e.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(r))k.email||(k.email=r),l=!0;else if(e.name&&-1!==e.name.toLowerCase().indexOf("username")||e.id&&-1!==e.id.toLowerCase().indexOf("username")||e.id&&m[e.id]&&-1!==m[e.id].toLowerCase().indexOf("username"))k.username||(k.username=r),l=!0;else if(e.name&&(-1!==e.name.toLowerCase().indexOf("tel")||-1!==e.name.toLowerCase().indexOf("phone")||-1!==e.name.toLowerCase().indexOf("number"))||e.id&&(-1!==e.id.toLowerCase().indexOf("tel")||
-1!==e.id.toLowerCase().indexOf("phone")||-1!==e.id.toLowerCase().indexOf("number"))||e.id&&m[e.id]&&(-1!==m[e.id].toLowerCase().indexOf("tel")||-1!==m[e.id].toLowerCase().indexOf("phone")||-1!==m[e.id].toLowerCase().indexOf("number")))k.phone||(k.phone=r),l=!0;else if(e.name&&(-1!==e.name.toLowerCase().indexOf("org")||-1!==e.name.toLowerCase().indexOf("company"))||e.id&&(-1!==e.id.toLowerCase().indexOf("org")||-1!==e.id.toLowerCase().indexOf("company"))||e.id&&m[e.id]&&(-1!==m[e.id].toLowerCase().indexOf("org")||
-1!==m[e.id].toLowerCase().indexOf("company")))k.organization||(k.organization=r),l=!0;else if(e.name&&-1!==e.name.toLowerCase().indexOf("name")||e.id&&-1!==e.id.toLowerCase().indexOf("name")||e.id&&m[e.id]&&-1!==m[e.id].toLowerCase().indexOf("name"))k.name||(k.name=""),k.name+=r+" ",l=!0}l&&(d(g.INFO,"collect_from_forms, Gathered user data",k),b?f.user_details({custom:k}):f.user_details(k))})};this.collect_from_facebook=function(a){d(g.INFO,"collect_from_facebook, Starting to collect possible user data");
FB&&FB.api&&FB.api("/me",function(b){var c={};b.name&&(c.name=b.name);b.email&&(c.email=b.email);"male"===b.gender?c.gender="M":"female"===b.gender&&(c.gender="F");if(b.birthday){var k=b.birthday.split("/").pop();k&&4===k.length&&(c.byear=k)}b.work&&b.work[0]&&b.work[0].employer&&b.work[0].employer.name&&(c.organization=b.work[0].employer.name);if(a){c.custom={};for(var l in a){k=a[l].split(".");for(var e=b,m=0;m<k.length&&(e=e[k[m]],"undefined"!==typeof e);m++);"undefined"!==typeof e&&(c.custom[l]=
e)}}f.user_details(c)})};this.opt_out=function(){d(g.INFO,"opt_out, Opting out the user");this.ignore_visitor=!0;p("cly_ignore",!0)};this.opt_in=function(){d(g.INFO,"opt_in, Opting in the user");p("cly_ignore",!1);this.ignore_visitor=!1;t();this.ignore_visitor||ra||V()};this.report_feedback=function(a){d(g.WARNING,"report_feedback, Deprecated function call! Use 'recordRatingWidgetWithID' in place of this call. Call will be redirected now!");this.recordRatingWidgetWithID(a)};this.recordRatingWidgetWithID=
function(a){d(g.INFO,"recordRatingWidgetWithID, Providing information about user with ID: [ "+a.widget_id+" ]");if(this.check_consent("star-rating"))if(a.widget_id)if(a.rating){var b={key:"[CLY]_star_rating",count:1,segmentation:{}};b.segmentation=ia(a,"widget_id contactMe platform app_version rating email comment".split(" "));b.segmentation.app_version||(b.segmentation.app_version=this.metrics._app_version||this.app_version);d(g.INFO,"recordRatingWidgetWithID, Reporting Rating Widget: ",b);q(b)}else d(g.ERROR,
"recordRatingWidgetWithID, Rating Widget must contain rating property");else d(g.ERROR,"recordRatingWidgetWithID, Rating Widget must contain widget_id property")};this.show_feedback_popup=function(a){d(g.WARNING,"show_feedback_popup, Deprecated function call! Use 'presentRatingWidgetWithID' in place of this call. Call will be redirected now!");this.presentRatingWidgetWithID(a)};this.presentRatingWidgetWithID=function(a){d(g.INFO,"presentRatingWidgetWithID, Showing rating widget popup for the widget with ID: [ "+
a+" ]");this.check_consent("star-rating")&&(S?d(g.ERROR,"presentRatingWidgetWithID, Cannot show ratingWidget popup in offline mode"):fa("presentRatingWidgetWithID",this.url+"/o/feedback/widget",{widget_id:a},function(b,c,k){if(b)d(g.ERROR,"presentRatingWidgetWithID, An error occurred: "+b);else try{var l=JSON.parse(k);z(l,!1)}catch(e){d(g.ERROR,"presentRatingWidgetWithID, JSON parse failed: "+e)}},!0))};this.initialize_feedback_popups=function(a){d(g.WARNING,"initialize_feedback_popups, Deprecated function call! Use 'initializeRatingWidgets' in place of this call. Call will be redirected now!");
this.initializeRatingWidgets(a)};this.initializeRatingWidgets=function(a){d(g.INFO,"initializeRatingWidgets, Initializing rating widget with provided widget IDs:[ "+a+"]");if(this.check_consent("star-rating")){a||(a=p("cly_fb_widgets"));for(var b=document.getElementsByClassName("countly-feedback-sticker");0<b.length;)b[0].remove();fa("initializeRatingWidgets",this.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a)},function(c,k,l){if(c)d(g.ERROR,"initializeRatingWidgets, An error occurred: "+
c);else try{var e=JSON.parse(l);for(c=0;c<e.length;c++)if("true"===e[c].is_active&&e[c].target_devices[fb.device])if("string"===typeof e[c].hide_sticker&&(e[c].hide_sticker="true"===e[c].hide_sticker),"all"!==e[c].target_page||e[c].hide_sticker){var m=e[c].target_pages;for(k=0;k<m.length;k++){var r=m[k].substr(0,m[k].length-1)===window.location.pathname.substr(0,m[k].length-1),u=m[k]===window.location.pathname;(m[k].includes("*")&&r||u)&&!e[c].hide_sticker&&z(e[c],!0)}}else z(e[c],!0)}catch(A){d(g.ERROR,
"initializeRatingWidgets, JSON parse error: "+A)}},!0)}};this.enable_feedback=function(a){d(g.WARNING,"enable_feedback, Deprecated function call! Use 'enableRatingWidgets' in place of this call. Call will be redirected now!");this.enableRatingWidgets(a)};this.enableRatingWidgets=function(a){d(g.INFO,"enableRatingWidgets, Enabling rating widget with params:",a);this.check_consent("star-rating")&&(S?d(g.ERROR,"enableRatingWidgets, Cannot enable rating widgets in offline mode"):(p("cly_fb_widgets",a.popups||
a.widgets),qa(this.url+"/star-rating/stylesheets/countly-feedback-web.css"),a=a.popups||a.widgets,0<a.length?(document.body.insertAdjacentHTML("beforeend",'<div id="cfbg"></div>'),this.initializeRatingWidgets(a)):d(g.ERROR,"enableRatingWidgets, You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")))};this.get_available_feedback_widgets=function(a){d(g.INFO,"get_available_feedback_widgets, Initializing feedbacks, callback function is provided:["+
!!a+"]");this.check_consent("feedback")?S?d(g.ERROR,"get_available_feedback_widgets, Cannot enable feedback widgets in offline mode."):fa("get_available_feedback_widgets",this.url+Ia,{method:"feedback",device_id:this.device_id,app_key:this.app_key},function(b,c,k){if(b)d(g.ERROR,"get_available_feedback_widgets, Error occurred while fetching feedbacks: "+b),a&&a(null,b);else try{var l=JSON.parse(k).result||[];a&&a(l,null)}catch(e){d(g.ERROR,"get_available_feedback_widgets, Error while parsing feedback widgets list: "+
e),a&&a(null,e)}},!1):a&&a(null,Error("Consent for feedback not provided."))};this.present_feedback_widget=function(a,b,c){function k(y){document.getElementById("countly-surveys-wrapper-"+y._id).style.display="block";document.getElementById("csbg").style.display="block"}function l(y){if(!y.appearance.hideS){d(g.DEBUG,"present_feedback_widget, handling the sticker as it was not set to hidden");var K=document.createElement("div");K.innerText=y.appearance.text;K.style.color=7>y.appearance.text_color.length?
"#"+y.appearance.text_color:y.appearance.text_color;K.style.backgroundColor=7>y.appearance.bg_color.length?"#"+y.appearance.bg_color:y.appearance.bg_color;K.className="countly-feedback-sticker  "+y.appearance.position+"-"+y.appearance.size;K.id="countly-feedback-sticker-"+y._id;document.body.appendChild(K);x(document.getElementById("countly-feedback-sticker-"+y._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+y._id).style.display="flex";document.getElementById("csbg").style.display=
"block"})}x(document.getElementById("countly-feedback-close-icon-"+y._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+y._id).style.display="none";document.getElementById("csbg").style.display="none"})}d(g.INFO,"present_feedback_widget, Presenting the feedback widget by appending to the element with ID: [ "+b+" ] and className: [ "+c+" ]");if(this.check_consent("feedback"))if(!a||"object"!==typeof a||Array.isArray(a))d(g.ERROR,"present_feedback_widget, Please provide at least one feedback widget object.");
else try{var e=this.url;if("nps"===a.type)d(g.DEBUG,"present_feedback_widget, Widget type: nps."),e+="/feedback/nps";else if("survey"===a.type)d(g.DEBUG,"present_feedback_widget, Widget type: survey."),e+="/feedback/survey";else if("rating"===a.type)d(g.DEBUG,"present_feedback_widget, Widget type: rating."),e+="/feedback/rating";else{d(g.ERROR,"present_feedback_widget, Feedback widget only accepts nps, rating and survey types.");return}var m=window.origin||window.location.origin;if("rating"===a.type){d(g.DEBUG,
"present_feedback_widget, Loading css for rating widget.");var r="ratings";qa(this.url+"/star-rating/stylesheets/countly-feedback-web.css")}else d(g.DEBUG,"present_feedback_widget, Loading css for survey or nps."),qa(this.url+"/surveys/stylesheets/countly-surveys.css"),r="surveys";e+="?widget_id="+a._id;e+="&app_key="+this.app_key;e+="&device_id="+this.device_id;e+="&sdk_name=javascript_native_web";e+="&platform="+this.platform;e+="&app_version="+this.app_version;e+="&sdk_version=21.11.4";e+="&origin="+
m;e+="&widget_v=web";var u=document.createElement("iframe");u.src=e;u.name="countly-"+r+"-iframe";u.id="countly-"+r+"-iframe";var A=!1;u.onload=function(){A&&(document.getElementById("countly-"+r+"-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none");A=!0;d(g.DEBUG,"present_feedback_widget, Loaded iframe.")};for(var M=document.getElementById("csbg");M;)M.remove(),M=document.getElementById("csbg"),d(g.DEBUG,"present_feedback_widget, Removing past overlay.");var F=
document.getElementsByClassName("countly-"+r+"-wrapper");for(e=0;e<F.length;e++)F[e].remove(),d(g.DEBUG,"present_feedback_widget, Removed a wrapper.");F=document.createElement("div");F.className="countly-"+r+"-wrapper";F.id="countly-"+r+"-wrapper-"+a._id;"survey"===a.type&&(F.className=F.className+" "+a.appearance.position);var ya=document.body;e=!1;b&&(document.getElementById(b)?(ya=document.getElementById(b),e=!0):d(g.ERROR,"present_feedback_widget, Provided ID not found."));e||c&&(document.getElementsByClassName(c)[0]?
ya=document.getElementsByClassName(c)[0]:d(g.ERROR,"present_feedback_widget, Provided class not found."));ya.insertAdjacentHTML("beforeend",'<div id="csbg"></div>');ya.appendChild(F);if("rating"===a.type){var Na=document.createElement("div");Na.className="countly-ratings-overlay";Na.id="countly-ratings-overlay-"+a._id;F.appendChild(Na);d(g.DEBUG,"present_feedback_widget, appended the rating overlay to wrapper");x(document.getElementById("countly-ratings-overlay-"+a._id),"click",function(){document.getElementById("countly-ratings-wrapper-"+
a._id).style.display="none"})}F.appendChild(u);d(g.DEBUG,"present_feedback_widget, appended the iframe to wrapper");x(window,"message",function(y){var K={};try{K=JSON.parse(y.data),d(g.INFO,"present_feedback_widget, Parsed response message "+K)}catch(ib){d(g.ERROR,"present_feedback_widget, Error while parsing message body "+ib)}K.close?(document.getElementById("countly-"+r+"-wrapper-"+a._id).style.display="none",document.getElementById("csbg").style.display="none"):d(g.DEBUG,"present_feedback_widget, Closing signal not sent yet")});
if("survey"===a.type){var I=!1;switch(a.showPolicy){case "afterPageLoad":"complete"===document.readyState?I||(I=!0,k(a)):x(document,"readystatechange",function(y){"complete"!==y.target.readyState||I||(I=!0,k(a))});break;case "afterConstantDelay":setTimeout(function(){I||(I=!0,k(a))},1E4);break;case "onAbandon":"complete"===document.readyState?x(document,"mouseleave",function(){I||(I=!0,k(a))}):x(document,"readystatechange",function(y){"complete"===y.target.readyState&&x(document,"mouseleave",function(){I||
(I=!0,k(a))})});break;case "onScrollHalfwayDown":x(window,"scroll",function(){if(!I){var y=Math.max(window.scrollY,document.body.scrollTop,document.documentElement.scrollTop),K=pa();y>=K/2&&(I=!0,k(a))}});break;default:I||(I=!0,k(a))}}else if("nps"===a.type)document.getElementById("countly-"+r+"-wrapper-"+a._id).style.display="block",document.getElementById("csbg").style.display="block";else if("rating"===a.type){var za=!1;"complete"===document.readyState?za||(za=!0,l(a)):x(document,"readystatechange",
function(y){"complete"!==y.target.readyState||za||(za=!0,l(a))})}}catch(y){d(g.ERROR,"present_feedback_widget, Something went wrong while presenting the feedback: "+y)}};this.recordError=function(a,b,c){d(g.INFO,"recordError, Recording error");if(this.check_consent("crashes")&&a){c=c||Ja;var k="";"object"===typeof a?"undefined"!==typeof a.stack?k=a.stack:("undefined"!==typeof a.name&&(k+=a.name+":"),"undefined"!==typeof a.message&&(k+=a.message+"\n"),"undefined"!==typeof a.fileName&&(k+="in "+a.fileName+
"\n"),"undefined"!==typeof a.lineNumber&&(k+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(k+=":"+a.columnNumber)):k=a+"";c=P(c,f.maxKeyLength,f.maxValueSize,f.maxSegmentationValues,"record_error",d);if(k.length>f.maxStackTraceLineLength*f.maxStackTraceLinesPerThread){d(g.DEBUG,"record_error, Error stack is too long will be truncated");k=k.split("\n");k.length>f.maxStackTraceLinesPerThread&&(k=k.splice(0,f.maxStackTraceLinesPerThread));a=0;for(var l=k.length;a<l;a++)k[a].length>f.maxStackTraceLineLength&&
(k[a]=k[a].substring(0,f.maxStackTraceLineLength));k=k.join("\n")}b=!!b;a=ua();k={_resolution:a._resolution,_error:k,_app_version:a._app_version,_run:C()-db,_not_os_specific:!0,_javascript:!0};if(a=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)k._bat=Math.floor(100*a.level);"undefined"!==typeof navigator.onLine&&(k._online=!!navigator.onLine);k._background=!document.hasFocus();0<ba.length&&(k._logs=ba.join("\n"));ba=[];k._nonfatal=b;k._view=this.getViewName();
"undefined"!==typeof c&&(k._custom=c);try{var e=document.createElement("canvas").getContext("experimental-webgl");k._opengl=e.getParameter(e.VERSION)}catch(m){d(g.ERROR,"Could not get the experimental-webgl context: "+m)}E({crash:JSON.stringify(k)})}};this.onStorageChange=function(a,b){d(g.INFO,"onStorageChange, Applying storage changes");switch(a){case "cly_queue":D=f.deserialize(b||"[]");break;case "cly_event":G=f.deserialize(b||"[]");break;case "cly_remote_configs":J=f.deserialize(b||"{}");break;
case "cly_ignore":f.ignore_visitor=f.deserialize(b);break;case "cly_id":f.device_id=f.deserialize(b)}};this._internals={store:p,getDocWidth:Ea,getDocHeight:pa,getViewportHeight:Qa,get_page_coord:Da,get_event_target:xa,add_event:x,getProperties:ia,truncateObject:P,truncateSingleValue:w,stripTrailingSlash:Ca,prepareParams:Pa,sendXmlHttpRequest:fa,isResponseValid:bb,getMsTimestamp:Aa,getTimestamp:C,isResponseValidBroad:ab,log:d,getMetrics:ua,generateUUID:Oa,isUUID:function(){return/[0-9a-fA-F]{8}\-[0-9a-fA-F]{4}\-4[0-9a-fA-F]{3}\-[0-9a-fA-F]{4}\-[0-9a-fA-F]{12}/.test(f.device_id)},
getId:ea,heartBeat:V,toRequestQueue:E,reportViewDuration:Q,loadJS:Sa,loadCSS:qa,getLastView:function(){return X},setToken:cb,getToken:function(){var a=p("cly_token");p("cly_token",null);return a},showLoader:Ta,hideLoader:Ua,add_cly_events:q,detect_device:fb,getRequestQueue:function(){return D},getEventQueue:function(){return G},clearQueue:function(){D=[];p("cly_queue",[]);G=[];p("cly_event",[])}};this.initialize()};n.init=function(h){h=h||{};var q=h.app_key||n.app_key;if(!n.i||!n.i[q]){h=new n.CountlyClass(h);
if(!n.i){n.i={};for(var t in h)n[t]=h[t]}n.i[q]=h}return n.i[q]};var oa=0,x=function(h,q,t){"undefined"!==typeof h.addEventListener?h.addEventListener(q,t,!1):h.attachEvent("on"+q,t)},xa=function(h){return h?"undefined"!==typeof h.target?h.target:h.srcElement:window.event.srcElement},fb=function(){var h=navigator.userAgent.toLowerCase(),q=function(t){t&&(h=(t+"").toLowerCase());t=/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/;
var z="desktop";/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(h)?z="tablet":t.test(h)&&(z="phone");return z};return{device:q(),detect:q,isMobile:"desktop"!==q()?!0:!1,userAgent:h}}();window.addEventListener("storage",function(h){var q=(h.key+"").split("/"),t=q.pop();q=q.pop();if(n.i&&n.i[q])n.i[q].onStorageChange(t,h.newValue)});n.serialize=function(h){"object"===typeof h&&(h=JSON.stringify(h));return h};n.deserialize=function(h){try{h=
JSON.parse(h)}catch(q){}return h};n.getViewName=function(){return window.location.pathname};n.getViewUrl=function(){return window.location.pathname};return n}});
