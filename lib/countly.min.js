(function(b,r){"function"===typeof define&&define.amd?define([],function(){return r(b.Countly)}):"object"===typeof module&&module.exports?module.exports=r(b.Countly):b.Countly=r(b.Countly)})("undefined"!==typeof window?window:this,function(b){function r(a){if(!b.ignore_visitor)if(a.key){a.count||(a.count=1);var d=V(a,["key","count","sum","dur","segmentation"]);d.timestamp=W();var e=new Date;d.hour=e.getHours();d.dow=e.getDay();p.push(d);i("cly_event",p);j("Adding event: ",a)}else j("Event must have key property")}
function ka(){b.ignore_prefetch&&("undefined"!==typeof document.visibilityState&&"prerender"===document.visibilityState)&&(b.ignore_visitor=!0);b.ignore_bots&&Ka.test(navigator.userAgent)&&(b.ignore_visitor=!0)}function la(a){var d=[];if("undefined"!==typeof a.options)for(var b=0;b<a.options.length;b++)a.options[b].selected&&d.push(a.options[b].value);return d.join(", ")}function ma(){var a;if("undefined"!==typeof b.onload&&0<b.onload.length){for(a=0;a<b.onload.length;a++)if("function"===typeof b.onload[a])b.onload[a]();
b.onload=[]}}function na(a,d){try{var e=document.createElement("div");e.className="countly-iframe-wrapper";e.id="countly-iframe-wrapper-"+a._id;var f=document.createElement("span");f.className="countly-feedback-close-icon";f.id="countly-feedback-close-icon-"+a._id;f.innerHTML="x";var g=document.createElement("iframe");g.name="countly-feedback-iframe";g.id="countly-feedback-iframe";g.src=b.url+"/feedback?widget_id="+a._id+"&app_key="+b.app_key+"&device_id="+b.device_id+"&sdk_version="+oa;document.body.appendChild(e);
e.appendChild(f);e.appendChild(g);l(document.getElementById("countly-feedback-close-icon-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="none";document.getElementById("cfbg").style.display="none"});if(d){var c=document.createElement("div");c.style.color=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color;c.style.backgroundColor=7>a.trigger_bg_color.length?"#"+a.trigger_bg_color:a.trigger_bg_color;c.className="countly-feedback-sticker "+
a.trigger_position;c.id="countly-feedback-sticker-"+a._id;c.innerHTML='<svg id="feedback-sticker-svg" aria-hidden="true" data-prefix="far" data-icon="grin" class="svg-inline--fa fa-grin fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path id="smileyPathInStickerSvg" fill="white" d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm0 448c-110.3 0-200-89.7-200-200S137.7 56 248 56s200 89.7 200 200-89.7 200-200 200zm105.6-151.4c-25.9 8.3-64.4 13.1-105.6 13.1s-79.6-4.8-105.6-13.1c-9.9-3.1-19.4 5.4-17.7 15.3 7.9 47.1 71.3 80 123.3 80s115.3-32.9 123.3-80c1.6-9.8-7.7-18.4-17.7-15.3zM168 240c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32zm160 0c17.7 0 32-14.3 32-32s-14.3-32-32-32-32 14.3-32 32 14.3 32 32 32z"></path></svg> '+
a.trigger_button_text;document.body.appendChild(c);var h=document.getElementById("smileyPathInStickerSvg");h&&(h.style.fill=7>a.trigger_font_color?"#"+a.trigger_font_color:a.trigger_font_color);l(document.getElementById("countly-feedback-sticker-"+a._id),"click",function(){document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block";document.getElementById("cfbg").style.display="block"})}else document.getElementById("countly-iframe-wrapper-"+a._id).style.display="block",document.getElementById("cfbg").style.display=
"block"}catch(D){j("Somethings went wrong while element injecting process: "+D)}}function X(){if(E){var a={name:E,segment:La};b.check_consent("views")&&r({key:"[CLY]_view",dur:F?n()-L:M,segmentation:a});E=null}}function pa(){I&&i("cly_session",n()+60*Y)}function qa(a){a.app_key=b.app_key;a.device_id=b.device_id;a.sdk_name=Ma;a.sdk_version=oa;b.check_consent("location")?(b.country_code&&(a.country_code=b.country_code),b.city&&(a.city=b.city),null!==b.ip_address&&(a.ip_address=b.ip_address)):a.location=
"";a.timestamp=W();var d=new Date;a.hour=d.getHours();a.dow=d.getDay()}function q(a){b.ignore_visitor||(!b.app_key||!b.device_id?j("app_key or device_id is missing"):(qa(a),t.length>Z&&t.shift(),t.push(a),i("cly_queue",t,!0)))}function N(){if(b.test_mode||b.ignore_visitor)$=!1;else{$=!0;ma();var a=0;if("undefined"!==typeof b.q&&0<b.q.length){var d,e=b.q;b.q=[];for(a=0;a<e.length;a++)if(d=e[a],j("Processing queued call",d),"function"===typeof d)d();else if(Array.isArray(d)&&0<d.length)if("undefined"!==
typeof b[d[0]])b[d[0]].apply(null,d.slice(1));else{var f=d[0].replace("userData.","");"undefined"!==typeof b.userData[f]&&b.userData[f].apply(null,d.slice(1))}}G&&(aa&&F)&&(a=n(),a-y>ba&&(b.session_duration(a-y),y=a));0<p.length&&(p.length<=O?(q({events:JSON.stringify(p)}),p=[]):(a=p.splice(0,O),q({events:JSON.stringify(a)})),i("cly_event",p));0<t.length&&(ca&&n()>ra)&&(ca=!1,a=t.shift(),sa(x)&&(z&&(clearTimeout(z),z=null),a.consent=JSON.stringify(x),x={}),j("Processing request",a),J(b.url+Na,a,function(a,
d){j("Request Finished",d,a);a&&(t.unshift(d),ra=n()+da);i("cly_queue",t,!0);ca=!0}));setTimeout(N,ea)}}function ta(){return i("cly_id")||ua()}function ua(){var a=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"===d?b:b&3|8).toString(16)})}function P(){var a={};a._app_version=b.app_version;a._ua=navigator.userAgent;if(screen.width){var d=screen.width?parseInt(screen.width):0,e=screen.height?
parseInt(screen.height):0;if(0!==d&&0!==e){if(navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)&&window.devicePixelRatio)d=Math.round(d*window.devicePixelRatio),e=Math.round(e*window.devicePixelRatio);else if(90===Math.abs(window.orientation))var f=d,d=e,e=f;a._resolution=""+d+"x"+e}}window.devicePixelRatio&&(a._density=window.devicePixelRatio);d=navigator.language||navigator.browserLanguage||navigator.systemLanguage||navigator.userLanguage;"undefined"!==typeof d&&(a._locale=d);if("undefined"!==
typeof document.referrer&&document.referrer.length&&(d=va.exec(document.referrer))&&d[11]&&d[11]!==window.location.hostname){d=!1;if(A&&A.length)for(e=0;e<A.length;e++)try{if(RegExp(A[e]).test(document.referrer)){j("Ignored:",document.referrer);d=!0;break}}catch(g){j("Problem with regex",A[e])}d||(a._store=document.referrer)}j("Got metrics",a);return a}function j(){b.debug&&"undefined"!==typeof console&&(arguments[1]&&"object"==typeof arguments[1]&&(arguments[1]=JSON.stringify(arguments[1])),console.log(Array.prototype.slice.call(arguments).join("\n")))}
function n(){return Math.floor((new Date).getTime()/1E3)}function W(){var a=(new Date).getTime();Q>=a?Q++:Q=a;return Q}function k(a,d,e){return"undefined"!==typeof d[a]?d[a]:"undefined"!==typeof b[a]?b[a]:e}function K(a,d,e){if(b.check_consent("crashes")&&a){var e=e||wa,f="";"object"===typeof a?"undefined"!==typeof a.stack?f=a.stack:("undefined"!==typeof a.name&&(f+=a.name+":"),"undefined"!==typeof a.message&&(f+=a.message+"\n"),"undefined"!==typeof a.fileName&&(f+="in "+a.fileName+"\n"),"undefined"!==
typeof a.lineNumber&&(f+="on "+a.lineNumber),"undefined"!==typeof a.columnNumber&&(f+=":"+a.columnNumber)):f=a+"";d=d?!0:!1;a=P();f={_resolution:a._resolution,_error:f,_app_version:a._app_version,_run:n()-xa,_not_os_specific:!0};if(a=navigator.battery||navigator.webkitBattery||navigator.mozBattery||navigator.msBattery)f._bat=Math.floor(100*a.level);"undefined"!==typeof navigator.onLine&&(f._online=navigator.onLine?!0:!1);f._background=document.hasFocus()?!1:!0;0<H.length&&(f._logs=H.join("\n"));H=
[];f._nonfatal=d;f._view=(window.location.pathname||"")+(window.location.search||"")+(window.location.hash||"");"undefined"!==typeof e&&(f._custom=e);try{var g=document.createElement("canvas").getContext("experimental-webgl");f._opengl=g.getParameter(g.VERSION)}catch(c){}q({crash:JSON.stringify(f)})}}function J(a,d,e){try{j("Sending XML HTTP request");var f=window.XMLHttpRequest?new window.XMLHttpRequest:window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLHTTP"):null,d=d||{},g=ya(d),c="GET";
if(b.force_post||2E3<=g.length)c="POST";"GET"===c?f.open("GET",a+"?"+g,!0):(f.open("POST",a,!0),f.setRequestHeader("Content-type","application/x-www-form-urlencoded"));f.onreadystatechange=function(){4===this.readyState&&200<=this.status&&300>this.status?"function"===typeof e&&e(!1,d,this.responseText):4===this.readyState&&(j("Failed Server XML HTTP request",this.status),"function"===typeof e&&e(!0,d))};"GET"===c?f.send():f.send(g)}catch(h){j("Failed XML HTTP request",h),"function"===typeof e&&e(!0,
d)}}function ya(a){var d=[],b;for(b in a)d.push(b+"="+encodeURIComponent(a[b]));return d.join("&")}function za(a){return"/"===a.substr(a.length-1)?a.substr(0,a.length-1):a}function V(a,b){for(var e={},f,g=0;g<b.length;g++)f=b[g],"undefined"!==typeof a[f]&&(e[f]=a[f]);return e}function fa(a){"undefined"==typeof a.pageY&&("number"==typeof a.clientX&&document.documentElement)&&(a.pageX=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,a.pageY=a.clientY+document.body.scrollTop+document.documentElement.scrollTop);
return a}function ga(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function ha(){var a=document;return Math.max(Math.max(a.body.scrollWidth,a.documentElement.scrollWidth),Math.max(a.body.offsetWidth,a.documentElement.offsetWidth),Math.max(a.body.clientWidth,a.documentElement.clientWidth))}function Aa(){var a=document;return Math.min(Math.min(a.body.clientHeight,
a.documentElement.clientHeight),Math.min(a.body.offsetHeight,a.documentElement.offsetHeight),window.innerHeight)}function Ba(a){i("cly_token",a)}function sa(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return!0;return!1}function Ca(a,b,e,f,g,c){var a=document.createElement(a),h;a.setAttribute(b,e);a.setAttribute(f,g);c&&(a.onreadystatechange=a.onload=function(){h||c();h=!0});document.getElementsByTagName("head")[0].appendChild(a)}function Da(a,b){Ca("script","type","text/javascript","src",a,b)}function Ea(a,
b){Ca("link","rel","stylesheet","href",a,b)}function Fa(){var a=document.getElementById("cly-loader");if(!a){j("setting up loader");var a=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css";b.styleSheet?b.styleSheet.cssText="#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}":
b.appendChild(document.createTextNode("#cly-loader {height: 4px; width: 100%; position: absolute; z-index: 99999; overflow: hidden; background-color: #fff; top:0px; left:0px;}#cly-loader:before{display: block; position: absolute; content: ''; left: -200px; width: 200px; height: 4px; background-color: #2EB52B; animation: cly-loading 2s linear infinite;}@keyframes cly-loading { from {left: -200px; width: 30%;} 50% {width: 30%;} 70% {width: 70%;} 80% { left: 50%;} 95% {left: 120%;} to {left: 100%;}}"));
a.appendChild(b);a=document.createElement("div");a.setAttribute("id","cly-loader");document.body.appendChild(a)}a.style.display="block"}function Ga(){var a=document.getElementById("cly-loader");a&&(a.style.display="none")}var b=b||{},oa="19.02",Ma="javascript_native_web",Ha=!1,G=!1,Na="/i",ea=500,Z=1E3,t=[],p=[],v={},H=[],B={},A=[],wa=null,aa=!0,y,Ia=0,E=null,L=0,M=0,ra=0,da=60,R=20,S=0,ba=60,O=10,ia=100,I=!0,Y=30,Q=0,ca=!0,La,$=!1,x={},s={},va=/^(((([^:\/#\?]+:)?(?:(\/\/)((?:(([^:@\/#\?]+)(?:\:([^:@\/#\?]+))?)@)?(([^:\/#\?\]\[]+|\[[^\/\]@#?]+\])(?:\:([0-9]+))?))?)?)?((\/?(?:[^\/\?#]+\/+)*)([^\?#]*)))?(\?[^#]+)?)(#.*)?/,
Ka=/(CountlySiteBot|nuhk|Googlebot|GoogleSecurityScanner|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver|bingbot|Google Web Preview|Mediapartners-Google|AdsBot-Google|Baiduspider|Ezooms|YahooSeeker|AltaVista|AVSearch|Mercator|Scooter|InfoSeek|Ultraseek|Lycos|Wget|YandexBot|Yandex|YaDirectFetcher|SiteBot|Exabot|AhrefsBot|MJ12bot|TurnitinBot|magpie-crawler|Nutch Crawler|CMS Crawler|rogerbot|Domnutch|ssearch_bot|XoviBot|netseer|digincore|fr-crawler|wesee|AliasIO|contxbot|PingdomBot|BingPreview|HeadlessChrome)/,
F=!0,xa;b.features="sessions events views scrolls clicks forms crashes attribution users star-rating location".split(" ");for(var m={},C=0;C<b.features.length;C++)m[b.features[C]]={};b.init=function(a){if(!Ha){xa=n();Ha=!0;t=i("cly_queue")||[];B={};p=i("cly_event")||[];v=i("cly_remote_configs")||{};a=a||{};ea=k("interval",a,ea);Z=k("queue_size",a,Z);da=k("fail_timeout",a,da);R=k("inactivity_time",a,R);ba=k("session_update",a,ba);O=k("max_events",a,O);ia=k("max_logs",a,ia);I=k("use_session_cookie",
a,I);Y=k("session_cookie_timeout",a,Y);b.ignore_prefetch=k("ignore_prefetch",a,!0);b.debug=k("debug",a,!1);b.app_key=k("app_key",a,null);b.test_mode=k("test_mode",a,!1);b.device_id=k("device_id",a,ta());b.url=za(k("url",a,""));b.app_version=k("app_version",a,"0.0");b.country_code=k("country_code",a,null);b.city=k("city",a,null);b.ip_address=k("ip_address",a,null);b.ignore_bots=k("ignore_bots",a,!0);b.force_post=k("force_post",a,!1);b.remote_config=k("remote_config",a,!1);b.q=b.q||[];b.onload=b.onload||
[];b.ignore_visitor=k("ignore_visitor",a,!1);b.require_consent=k("require_consent",a,!1);a.ignore_referrers&&Array.isArray(a.ignore_referrers)?A=a.ignore_referrers:b.ignore_referrers&&Array.isArray(b.ignore_referrers)&&(A=b.ignore_referrers);""===b.url&&(j("Please provide server URL"),b.ignore_visitor=!0);i("cly_ignore")&&(b.ignore_visitor=!0);ka();if(window.name&&0===window.name.indexOf("cly:"))try{b.passed_data=JSON.parse(window.name.replace("cly:",""))}catch(d){j("Could not parse name",window.name)}else if(location.hash&&
0===location.hash.indexOf("#cly:"))try{b.passed_data=JSON.parse(location.hash.replace("#cly:",""))}catch(e){j("Could not parse hash",location.hash)}b.passed_data&&(b.passed_data.token&&b.passed_data.purpose)&&(b.passed_data.token!==i("cly_old_token")&&(Ba(b.passed_data.token),i("cly_old_token",b.passed_data.token)),"heatmap"===b.passed_data.purpose&&(b.ignore_visitor=!0,Fa(),Da(b.url+"/views/heatmap.js",Ga)));if(!b.ignore_visitor){j("Countly initialized");b.onload.constructor!==Array&&(b.onload=[]);
b.q.constructor!==Array&&(b.q=[]);N();i("cly_id",b.device_id);a=0;b.utm=b.utm||{source:!0,medium:!0,campaign:!0,term:!0,content:!0};if(location.search){for(var f=location.search.substring(1).split("&"),g={},c=!1,a=0;a<f.length;a++){var h=f[a].split("=");"cly_id"===h[0]?i("cly_cmp_id",h[1]):"cly_uid"===h[0]?i("cly_cmp_uid",h[1]):0===(h[0]+"").indexOf("utm_")&&b.utm[h[0].replace("utm_","")]&&(g[h[0].replace("utm_","")]=h[1],c=!0)}if(c){for(var D in b.utm)g[D]?b.userData.set("utm_"+D,g[D]):b.userData.unset("utm_"+
D);b.userData.save()}}ma();b.remote_config&&b.fetch_remote_config(b.remote_config)}}};b.group_features=function(a){if(a)for(var b in a)m[b]?j("Feature name "+b+" is already reserved"):"string"===typeof a[b]?m[b]={features:[a[b]]}:a[b]&&Array.isArray(a[b])&&a[b].length?m[b]={features:a[b]}:j("Incorrect feature list for "+b+" value: "+a[b]);else j("Incorrect features: "+a)};b.check_consent=function(a){if(!b.require_consent)return!0;if(m[a])return m[a]&&m[a].optin?!0:!1;j("No feature available for "+
a);return!1};b.check_any_consent=function(){if(!b.require_consent)return!0;for(var a in m)if(m[a]&&m[a].optin)return!0;return!1};b.add_consent=function(a){j("Adding consent for "+a);if(Array.isArray(a))for(var d=0;d<a.length;d++)b.add_consent(a[d]);else m[a]?m[a].features?(m[a].optin=!0,b.add_consent(m[a].features)):!0!==m[a].optin&&(x[a]=!0,m[a].optin=!0,Ja(),setTimeout(function(){"sessions"===a&&s.begin_session?(b.begin_session.apply(b,s.begin_session),s.begin_session=null):"views"===a&&s.track_pageview&&
(E=null,b.track_pageview.apply(b,s.track_pageview),s.track_pageview=null);s.change_id&&(b.change_id.apply(b,s.change_id),s.change_id=null)},1)):j("No feature available for "+a)};b.remove_consent=function(a){j("Removing consent for "+a);if(Array.isArray(a))for(var d=0;d<a.length;d++)b.remove_consent(a[d]);else m[a]?(m[a].features?b.remove_consent(m[a].features):!1!==m[a].optin&&(x[a]=!1,Ja()),m[a].optin=!1):j("No feature available for "+a)};var z,Ja=function(){z&&(clearTimeout(z),z=null);z=setTimeout(function(){sa(x)&&
(q({consent:JSON.stringify(x)}),x={})},1E3)};b.begin_session=function(a,d){if(b.check_consent("sessions")){if(!G){y=n();G=!0;aa=a?!1:!0;var e=i("cly_session");if(d||!I||!e||parseInt(e)<=n())j("Session started"),e={begin_session:1},e.metrics=JSON.stringify(P()),q(e);pa()}}else s.begin_session=arguments};b.session_duration=function(a){b.check_consent("sessions")&&G&&(j("Session extended",a),q({session_duration:a}),pa())};b.end_session=function(a,d){b.check_consent("sessions")&&G&&(a=a||n()-y,X(),!I||
d?(j("Ending session"),q({end_session:1,session_duration:a})):b.session_duration(a),G=!1)};b.change_id=function(a,d){if(b.device_id!==a){d||(0<p.length&&(q({events:JSON.stringify(p)}),p=[],i("cly_event",p)),b.end_session(null,!0),B={});var e=b.device_id;b.device_id=a;i("cly_id",b.device_id);j("Changing id");d?b.check_any_consent()?q({old_device_id:e}):s.change_id=arguments:b.begin_session(!aa,!0);b.remote_config&&(v={},i("cly_remote_configs",v),b.fetch_remote_config(b.remote_config))}};b.add_event=
function(a){b.check_consent("events")&&r(a)};b.start_event=function(a){B[a]?j("Timed event with key "+a+" already started"):B[a]=n()};b.end_event=function(a){"string"==typeof a&&(a={key:a});a.key?B[a.key]?(a.dur=n()-B[a.key],b.add_event(a),delete B[a.key]):j("Timed event with key "+a.key+" was not started"):j("Event must have key property")};b.user_details=function(a){b.check_consent("users")&&(j("Adding userdetails: ",a),q({user_details:JSON.stringify(V(a,"name username email organization phone picture gender byear custom".split(" ")))}))};
b.report_conversion=function(a,d){b.check_consent("attribution")&&(a=a||i("cly_cmp_id")||"cly_organic",d=d||i("cly_cmp_uid"),a&&d?q({campaign_id:a,campaign_user:d}):a&&q({campaign_id:a}))};var u={},w=function(a,d,e){b.check_consent("users")&&(u[a]||(u[a]={}),"$push"===e||"$pull"===e||"$addToSet"===e?(u[a][e]||(u[a][e]=[]),u[a][e].push(d)):u[a][e]=d)};b.userData={set:function(a,b){u[a]=b},unset:function(a){u[a]=""},set_once:function(a,b){w(a,b,"$setOnce")},increment:function(a){w(a,1,"$inc")},increment_by:function(a,
b){w(a,b,"$inc")},multiply:function(a,b){w(a,b,"$mul")},max:function(a,b){w(a,b,"$max")},min:function(a,b){w(a,b,"$min")},push:function(a,b){w(a,b,"$push")},push_unique:function(a,b){w(a,b,"$addToSet")},pull:function(a,b){w(a,b,"$pull")},save:function(){b.check_consent("users")&&q({user_details:JSON.stringify({custom:u})});u={}}};b.track_errors=function(a){wa=a;window.onerror=function(a,b,f,g,c){if("undefined"!==typeof c)K(c,!1);else{var g=g||window.event&&window.event.errorCharacter,h="";"undefined"!==
typeof a&&(h+=a+"\n");"undefined"!==typeof b&&(h+="at "+b);"undefined"!==typeof f&&(h+=":"+f);"undefined"!==typeof g&&(h+=":"+g);h+="\n";try{for(var j=[],i=arguments.callee.caller;i;)j.push(i.name),i=i.caller;h+=j.join("\n")}catch(k){}K(h,!1)}};window.addEventListener("unhandledrejection",function(a){K(Error("Unhandled rejection (reason: "+(a.reason&&a.reason.stack?a.reason.stack:a.reason)+")."),!0)})};b.log_error=function(a,b){K(a,!0,b)};b.add_log=function(a){b.check_consent("crashes")&&(H.length>
ia&&H.shift(),H.push(a))};b.fetch_remote_config=function(a,d,e){if(b.check_any_consent()){var f={method:"fetch_remote_config"};b.check_consent("sessions")&&(f.metrics=JSON.stringify(P()));a&&(!e&&"function"===typeof a?(e=a,a=null):Array.isArray(a)&&a.length&&(f.keys=JSON.stringify(a)));d&&(!e&&"function"===typeof d?(e=d,d=null):Array.isArray(d)&&d.length&&(f.omit_keys=JSON.stringify(d)));qa(f);J(b.url+"/o/sdk",f,function(a,b,d){try{var j=JSON.parse(d);if(f.keys||f.omit_keys)for(var k in j)v[k]=j[k];
else v=j;i("cly_remote_configs",v)}catch(l){}"function"===typeof e&&e(a,v)})}};b.get_remote_config=function(a){return"undefined"!==typeof a?v[a]:v};b.stop_time=function(){F&&(F=!1,Ia=n()-y,M=n()-L)};b.start_time=function(){F||(F=!0,y=n()-Ia,L=n()-M,M=0)};b.track_sessions=function(){function a(){document[e]?b.stop_time():b.start_time()}function d(){S>=R&&b.start_time();S=0}b.begin_session();b.start_time();l(window,"beforeunload",function(){b.end_session()});l(window,"unload",function(){b.end_session()});
var e="hidden";e in document?document.addEventListener("visibilitychange",a):(e="mozHidden")in document?document.addEventListener("mozvisibilitychange",a):(e="webkitHidden")in document?document.addEventListener("webkitvisibilitychange",a):(e="msHidden")in document?document.addEventListener("msvisibilitychange",a):"onfocusin"in document?(l(window,"focusin",function(){b.start_time()}),l(window,"focusout",function(){b.stop_time()})):(l(window,"focus",function(){b.start_time()}),l(window,"blur",function(){b.stop_time()}),
l(window,"pageshow",function(){b.start_time()}),l(window,"pagehide",function(){b.stop_time()}));l(window,"mousemove",d);l(window,"click",d);l(window,"keydown",d);l(window,"scroll",d);setInterval(function(){S++;S>=R&&b.stop_time()},6E4)};b.track_pageview=function(a,d){X();a&&Array.isArray(a)&&(d=a,a=null);a||(a=b.getViewName?b.getViewName():window.location.pathname);if(d&&d.length)for(var e=0;e<d.length;e++)try{if(RegExp(d[e]).test(a)){j("Ignored:",a);return}}catch(f){j("Problem with regex",d[e])}E=
a;L=n();e={name:a,visit:1,domain:window.location.hostname,view:b.getViewUrl?b.getViewUrl():window.location.pathname};if("undefined"!==typeof document.referrer&&document.referrer.length){var g=va.exec(document.referrer);g&&(g[11]&&g[11]!==window.location.hostname)&&(e.start=1)}b.check_consent("views")?r({key:"[CLY]_view",segmentation:e}):s.track_pageview=arguments};b.track_view=function(a,d){b.track_pageview(a,d)};b.track_clicks=function(a){var a=a||document,d=!0;l(a,"click",function(a){if(d){d=!1;
fa(a);if("undefined"!==typeof a.pageX&&"undefined"!==typeof a.pageY){var f=ga(),g=ha();b.check_consent("clicks")&&r({key:"[CLY]_action",segmentation:{type:"click",x:a.pageX,y:a.pageY,width:g,height:f,domain:window.location.hostname,view:b.getViewUrl?b.getViewUrl():window.location.pathname}})}setTimeout(function(){d=!0},1E3)}})};b.track_scrolls=function(a){function d(){if(e){e=!1;var a=ga(),d=ha(),h=Aa();b.check_consent("scrolls")&&r({key:"[CLY]_action",segmentation:{type:"scroll",y:f+h,width:d,height:a,
domain:window.location.hostname,view:b.getViewUrl?b.getViewUrl():window.location.pathname}})}}var a=a||window,e=!0,f=0;l(a,"scroll",function(){f=Math.max(f,window.scrollY,document.body.scrollTop,document.documentElement.scrollTop)});l(a,"beforeunload",d);l(a,"unload",d)};b.track_links=function(a){a=a||document;l(a,"click",function(a){var e=T(a).closest("a");e&&(fa(a),b.check_consent("clicks")&&r({key:"linkClick",segmentation:{href:e.href,text:e.innerText,id:e.id,view:b.getViewUrl?b.getViewUrl():window.location.pathname}}))})};
b.track_forms=function(a,d){function e(a){return a.name||a.id||a.type||a.nodeName}a=a||document;l(a,"submit",function(a){var a=T(a),g={id:a.id,name:a.name,action:a.action,method:a.method,view:b.getViewUrl?b.getViewUrl():window.location.pathname},c;if("undefined"!==typeof a.elements){for(var h=0;h<a.elements.length;h++)if((c=a.elements[h])&&"password"!==c.type)"undefined"===typeof g["input:"+e(c)]&&(g["input:"+e(c)]=[]),"select"===c.nodeName.toLowerCase()?"undefined"!==typeof c.multiple?g["input:"+
e(c)].push(la(c)):g["input:"+e(c)].push(c.options[c.selectedIndex].value):"input"===c.nodeName.toLowerCase()?"undefined"!==typeof c.type?"checkbox"===c.type.toLowerCase()||"radio"===c.type.toLowerCase()?c.checked&&g["input:"+e(c)].push(c.value):("hidden"!==c.type.toLowerCase()||d)&&g["input:"+e(c)].push(c.value):g["input:"+e(c)].push(c.value):"textarea"===c.nodeName.toLowerCase()?g["input:"+e(c)].push(c.value):"undefined"!==typeof c.value&&g["input:"+e(c)].push(c.value);for(var j in g)"undefined"!=
typeof g[j].join&&(g[j]=g[j].join(", "))}b.check_consent("forms")&&r({key:"formSubmit",segmentation:g})})};b.collect_from_forms=function(a,d){a=a||document;l(a,"submit",function(e){var e=T(e),f={},g=!1,c;if("undefined"!==typeof e.elements){var h={},i=a.getElementsByTagName("LABEL"),k;for(k=0;k<i.length;k++)i[k].htmlFor&&""!==i[k].htmlFor&&(h[i[k].htmlFor]=i[k].innerText||i[k].textContent||i[k].innerHTML);for(k=0;k<e.elements.length;k++)if((c=e.elements[k])&&"password"!==c.type&&-1===c.className.indexOf("cly_user_ignore"))if(i=
"","select"===c.nodeName.toLowerCase()?i="undefined"!==typeof c.multiple?la(c):c.options[c.selectedIndex].value:"input"===c.nodeName.toLowerCase()?"undefined"!==typeof c.type?"checkbox"===c.type.toLowerCase()||"radio"===c.type.toLowerCase()?c.checked&&(i=c.value):i=c.value:i=c.value:"textarea"===c.nodeName.toLowerCase()?i=c.value:"undefined"!==typeof c.value&&(i=c.value),c.className&&-1!==c.className.indexOf("cly_user_")){var l=c.className.split(" ");for(c=0;c<l.length;c++)if(0===l[c].indexOf("cly_user_")){f[l[c].replace("cly_user_",
"")]=i;g=!0;break}}else if(c.type&&"email"===c.type.toLowerCase()||c.name&&-1!==c.name.toLowerCase().indexOf("email")||c.id&&-1!==c.id.toLowerCase().indexOf("email")||c.id&&h[c.id]&&-1!==h[c.id].toLowerCase().indexOf("email")||/[^@\s]+@[^@\s]+\.[^@\s]+/.test(i))f.email||(f.email=i),g=!0;else if(c.name&&-1!==c.name.toLowerCase().indexOf("username")||c.id&&-1!==c.id.toLowerCase().indexOf("username")||c.id&&h[c.id]&&-1!==h[c.id].toLowerCase().indexOf("username"))f.username||(f.username=i),g=!0;else if(c.name&&
(-1!==c.name.toLowerCase().indexOf("tel")||-1!==c.name.toLowerCase().indexOf("phone")||-1!==c.name.toLowerCase().indexOf("number"))||c.id&&(-1!==c.id.toLowerCase().indexOf("tel")||-1!==c.id.toLowerCase().indexOf("phone")||-1!==c.id.toLowerCase().indexOf("number"))||c.id&&h[c.id]&&(-1!==h[c.id].toLowerCase().indexOf("tel")||-1!==h[c.id].toLowerCase().indexOf("phone")||-1!==h[c.id].toLowerCase().indexOf("number")))f.phone||(f.phone=i),g=!0;else if(c.name&&(-1!==c.name.toLowerCase().indexOf("org")||
-1!==c.name.toLowerCase().indexOf("company"))||c.id&&(-1!==c.id.toLowerCase().indexOf("org")||-1!==c.id.toLowerCase().indexOf("company"))||c.id&&h[c.id]&&(-1!==h[c.id].toLowerCase().indexOf("org")||-1!==h[c.id].toLowerCase().indexOf("company")))f.organization||(f.organization=i),g=!0;else if(c.name&&-1!==c.name.toLowerCase().indexOf("name")||c.id&&-1!==c.id.toLowerCase().indexOf("name")||c.id&&h[c.id]&&-1!==h[c.id].toLowerCase().indexOf("name"))f.name||(f.name=""),f.name+=i+" ",g=!0}g&&(j("Gathered user data",
f),d?b.user_details({custom:f}):b.user_details(f))})};b.collect_from_facebook=function(a){FB&&FB.api&&FB.api("/me",function(d){var e={};d.name&&(e.name=d.name);d.email&&(e.email=d.email);"male"===d.gender?e.gender="M":"female"===d.gender&&(e.gender="F");if(d.birthday){var f=d.birthday.split("/").pop();f&&4===f.length&&(e.byear=f)}d.work&&(d.work[0]&&d.work[0].employer&&d.work[0].employer.name)&&(e.organization=d.work[0].employer.name);if(a){e.custom={};for(var g in a){for(var f=a[g].split("."),c=
d,h=0;h<f.length&&!(c=c[f[h]],"undefined"===typeof c);h++);"undefined"!==typeof c&&(e.custom[g]=c)}}b.user_details(e)})};b.opt_out=function(){b.ignore_visitor=!0;i("cly_ignore",!0)};b.opt_in=function(){i("cly_ignore",!1);b.ignore_visitor=!1;ka();!b.ignore_visitor&&!$&&N()};b.show_feedback_popup=function(a){J(b.url+"/o/feedback/widget",{widget_id:a},function(a,b,f){a&&j("Error occurred",a);try{var g=JSON.parse(f);na(g,!1)}catch(c){j("JSON parse failed: "+c)}})};b.enable_feedback=function(a){Ea(b.url+
"/star-rating/stylesheets/countly-feedback-web.css");a=a.popups||a.widgets;0<a.length?(document.body.innerHTML+='<div id="cfbg"></div>',J(b.url+"/o/feedback/multiple-widgets-by-id",{widgets:JSON.stringify(a)},function(a,b,f){a&&j("Errors occurred:",a);try{for(var g=JSON.parse(f),a=0;a<g.length;a++)if(g[a].target_devices[ja.device])for(var c=g[a].target_pages,b=0;b<c.length;b++)g[a].hide_sticker="true"===g[a].hide_sticker?!0:!1,c[b]===window.location.pathname&&!g[a].hide_sticker&&na(g[a],!0)}catch(h){j("JSON parse error: "+
h)}})):j("You should provide at least one widget id as param. Read documentation for more detail. https://resources.count.ly/plugins/feedback")};Element.prototype.closest||(Element.prototype.closest=function(a){for(var b=this,a=a.toUpperCase();b;){if(b.nodeName.toUpperCase()===a)return b;b=b.parentElement}});var l=function(a,b,e){"undefined"!==typeof a.addEventListener?a.addEventListener(b,e,!1):a.attachEvent("on"+b,e)},T=function(a){return a?"undefined"!==typeof a.target?a.target:a.srcElement:window.event.srcElement},
ja,U=navigator.userAgent.toLowerCase(),C=function(a){a&&(U=(a+"").toLowerCase());return/(ipad|tablet|(android(?!.*mobile))|(windows(?!.*phone)(.*touch))|kindle|playbook|silk|(puffin(?!.*(IP|AP|WP))))/.test(U)?"tablet":/(mobi|ipod|phone|blackberry|opera mini|fennec|minimo|symbian|psp|nintendo ds|archos|skyfire|puffin|blazer|bolt|gobrowser|iris|maemo|semc|teashark|uzard)/.test(U)?"phone":"desktop"};ja={device:C(),detect:C,isMobile:"desktop"!==C()?!0:!1,userAgent:U};var i=function(a,b,e){function f(a,
b,c){var d=new Date;d.setTime(d.getTime()+864E5*c);c="; expires="+d.toGMTString();document.cookie=a+"="+b+c+"; path=/"}var e=e||!1,g=!1,c,g=!0;try{"undefined"!==typeof localStorage&&localStorage.setItem("testLocal",!0)}catch(h){g=!1}"undefined"!==typeof b&&null!==b&&("object"===typeof b&&(b=JSON.stringify(b)),g?localStorage.setItem(a,b):e||f(a,b,30));if("undefined"===typeof b){if(g)c=localStorage.getItem(a);else if(!e)a:{a+="=";b=document.cookie.split(";");e=0;for(g=b.length;e<g;e++){for(c=b[e];" "===
c.charAt(0);)c=c.substring(1,c.length);if(0===c.indexOf(a)){c=c.substring(a.length,c.length);break a}}c=null}try{c=JSON.parse(c)}catch(i){}return c}null===b&&(g?localStorage.removeItem(a):e||f(a,"",-1))};b._internals={store:i,getDocWidth:ha,getDocHeight:ga,getViewportHeight:Aa,get_page_coord:fa,get_event_target:T,add_event:l,getProperties:V,stripTrailingSlash:za,prepareParams:ya,sendXmlHttpRequest:J,recordError:K,getMsTimestamp:W,getTimestamp:n,log:j,getMetrics:P,generateUUID:ua,getId:ta,heartBeat:N,
toRequestQueue:q,reportViewDuration:X,loadJS:Da,loadCSS:Ea,getLastView:function(){return E},setToken:Ba,getToken:function(){var a=i("cly_token");i("cly_token",null);return a},showLoader:Fa,hideLoader:Ga,add_cly_events:r,detect_device:ja,getRequestQueue:function(){return t},getEventQueue:function(){return p}};return b});
